(function(t,e){if("object"==typeof exports){var a=require("jquery");module.exports=e(a)}else"function"==typeof define&&define.amd&&define(["jquery"],e)})(this,function(){(function(t,e){"use strict";var a=e,n={},r=t.MT=t.MT||{};r.ChartAPI=n;n.Data={};n.Data.getData=function(t,e,n,r){var i,o,s,h;t&&t.done(function(t){i||(i="string"==typeof t?""+t:a.isArray(t)?a.map(t,function(t){return a.extend({},t)}):a.extend({},t));n(i)}).fail(function(t){o={404:"Data is not found",403:"Data is forbidden to access"};s="Some error occured in the data fetching process";h=t.status?"error-"+t.status:"error-unknown";r&&(r.$errormsg=a('<div class="error '+h+'">'+(o[t.status]||s)+"</div>").appendTo(e))}).always(function(){r&&r.$progress&&r.$progress.parent().length>0&&r.$progress.remove()}).progress(function(){!r||r.$progress&&0!==r.$progress.parent().length||(r.$progress=a('<div class="progress">fetching data...</div>').appendTo(e))})};n.Data.filterData=function(t,e,r,i,o,s){var h,l={};o=o||1;a.each(t,function(t,c){var p,u;p=n.Date.parse(c.x);if(p&&p>=r&&e>=p)if(s){u=n.Date.createId(p,"daily");l[u]=c}else{"weekly"===i&&(p=n.Date.getWeekStartday(p));u=n.Date.createId(p,i);if(l[u])for(t=0;o>t;t++){h=t?"y"+t:"y";l[u][h]=parseInt(l[u][h],10)+parseInt(c[h],10)}else l[u]=a.extend({},c)}});return l};n.Date={};n.Date.getWeekStartday=function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay())};n.Date.zeroPadArray=function(t,e){var n;({yearly:function(){n=[t.getFullYear()]},monthly:function(){n=[t.getFullYear(),t.getMonth()+1]},quarter:function(){n=[t.getFullYear(),t.getMonth()+1]},weekly:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate()-t.getDay()]},daily:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate()]},hourly:function(){n=[t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours()]}})[e]();return a.map(n,function(t){t=""+t;return 1===t.length?"0"+t:t})};n.Date.createId=function(t,e){return n.Date.zeroPadArray(t,e).join("")};n.Date.createXLabel=function(t,e){var a,r,i=n.Date.zeroPadArray(t,e);if("hourly"===e){a=i.pop();r=i.join("-")+" "+a+":00"}else r=i.join("-");return r};n.Date.parse=function(t){var e;e=!t||t instanceof Date?t||null:"number"==typeof t?new Date(t):new Date(Date.parse(""+t));if(e&&/NaN|Invalid Date/.test(""+e)){e=t.replace(/-/g,"/").split("+")[0];if(1===e.split("/").length){e=t.match(/([0-9]{4})([0-9]{1,2})([0-9]{1,2})/);e=[e[1],e[2],e[3]].join("/")}2===e.split("/").length&&(e+="/01");e=a.each(e.split("/"),function(t,e){return 1===e.length?"0"+e:e}).join("/");e=new Date(Date.parse(e))}return e};n.Date.calcDate=function(t,e,a,n){var r,i,o,s;r=t.getFullYear();i=t.getMonth();o=t.getDate();s=0;e-=1;n=n?-1:1;({yearly:function(){r+=n*e},monthly:function(){i+=n*e},quarter:function(){i+=4*n*e},weekly:function(){o=o+7*n*e-t.getDay()},daily:function(){o+=n*e},hourly:function(){s=t.getHours()+n*e}})[a]();return new Date(r,i,o,s)};n.Range={};n.Range.factory=function(t){var e;t=t||{};t.maxLength=t.maxLength||90;t.dataType=t.dataType||"timeline";t.isTimeline=n.Range.isTimeline(t.dataType);e=t.isTimeline?n.Range.calcDate:n.Range.calcNum;return e(t.start,t.end,t.length,t.maxLength,t.unit,t.dataType,t.autoSized)};n.Range.generate=n.Range.factory;n.Range.isTimeline=function(t){return!t||"timeline"===t};n.Range.calcDate=function(t,e,r,i,o,s,h){o=o||"monthly";r=r||("hourly"===o?24:10);if(h){var l=a(window).width();i=Math.min(Math.ceil(.021875*l),i);r=i}t=n.Date.parse(t);e=n.Date.parse(e);t||e||(e=n.Range.getEndDate(new Date,o));t||(t=n.Range.getStartDate(n.Date.calcDate(e,r,o,!0),o));e||(e=n.Range.getEndDate(n.Date.calcDate(t,r,o,!1),o));e>new Date&&(e=new Date);t>e&&(t=e);r=n.Range.getLength(t,e,o);if(r>i){r=i;t=n.Date.calcDate(e,r,o,!0)}return{start:t,end:e,length:r,maxLength:i,unit:o,dataType:s,max:n.Range.getEndDate(e,o),min:n.Range.getStartDate(t,o),isTimeline:!0}};n.Range.calcNum=function(t,e,n,r,i,o,s){n=n||10;if(s){var h=a(window).width();r=Math.min(Math.ceil(.021875*h),r);n=Math.min(n,r)}if(!t&&!e){t=0;e=n-1}t=parseInt(t,10)||(0===t?0:null);e=parseInt(e,10)||(0===e?0:null);if(null===t){t=e-n;0>t&&(t=0)}null===e&&(e=t+n);t>e&&(t=e);n=e-t+1;if(n>r){n=r;t=e-r}return{start:t,end:e,length:n,maxLength:r,dataType:o,unit:null,max:e,min:t,isTimeline:!1}};n.Range.getStartDate=function(t,e){var a,n=t.getFullYear(),r=t.getMonth(),i=t.getDate();({yearly:function(){a=new Date(n,0,1,0,0,0)},monthly:function(){a=new Date(n,r,1,0,0,0)},quarter:function(){a=new Date(n,r,1,0,0,0)},weekly:function(){a=new Date(n,r,i-t.getDay(),0,0,0)},daily:function(){a=new Date(n,r,i,0,0,0)},hourly:function(){a=new Date(n,r,i,t.getHours(),0,0)}})[e]();return a};n.Range.getEndDate=function(t,e){var a,n=t.getFullYear(),r=t.getMonth(),i=t.getDate();({yearly:function(){a=new Date(n,11,31,23,59,59)},monthly:function(){a=new Date(new Date(n,r+1,1,0,0,0).valueOf()-1)},quarter:function(){a=new Date(new Date(n,r+1,1,0,0,0).valueOf()-1)},weekly:function(){a=new Date(n,r,i-t.getDay()+6,23,59,59)},daily:function(){a=new Date(n,r,i,23,59,59)},hourly:function(){a=new Date(n,r,i,t.getHours(),0,0)}})[e]();return new Date>a?a:new Date};n.Range.getNextDate=function(t,e,a,n){var r,i=t.getFullYear(),o=t.getMonth(),s=t.getDate();({yearly:function(t){r=new Date(i+t,0,1)},monthly:function(t){r=new Date(i,o+t,1)},quarter:function(t){r=new Date(i,o+4*t,1)},weekly:function(e){r=new Date(i,o,s+7*e-t.getDay())},daily:function(t){r=new Date(i,o,s+t)},hourly:function(e){r=new Date(i,o,s,t.getHours()+e)}})[n](a);return e>r?r:null};n.Range.getDataRange=function(t,e){var r,i,o;if(e){r=a.map(t,function(t){return n.Date.parse(t.x).valueOf()});i=Math.max.apply(null,r);o=Math.min.apply(null,r)}else{o=0;i=t.length-1}return{max:i,min:o}};n.Range.getLength=function(t,e,a){var r;({yearly:function(){r=Math.ceil(e.getFullYear()-t.getFullYear())},monthly:function(){r=Math.ceil(12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()))},quarter:function(){r=Math.ceil((12*e.getFullYear()+e.getMonth()-(12*t.getFullYear()+t.getMonth()))/4)},weekly:function(){r=Math.ceil((n.Date.getWeekStartday(e)-n.Date.getWeekStartday(t))/6048e5)},daily:function(){r=Math.ceil((e-t)/864e5)},hourly:function(){r=Math.ceil((e-t)/36e5)}})[a]();return r>0?r+1:1};n.Graph=function(t,a){this.config=e.extend({type:"morris.bar",staticPath:"",data:"graph.json"},t);this.config.id="graph-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config.yLength=parseInt(this.config.yLength,10)||1;this.range=n.Range.generate(a);if("string"==typeof this.config.data)this.origData_=e.getJSON(this.config.staticPath+this.config.data);else{this.origData_=e.Deferred();this.origData_.resolve(this.config.data)}this.graphData={};this.graphData[this.range.unit]=e.Deferred();this.getData(e.proxy(function(t){this.graphData[this.range.unit].resolve(this.generateGraphData(t))},this));this.$graphContainer=e('<div id="'+this.config.id+'-container" class="graph-container">');this.$graphContainer.on("UPDATE",e.proxy(function(t,a,n){this.update_(a,n);return e(this.$graphContainer)},this));this.$graphContainer.on("REMOVE",e.proxy(function(){this.remove_()},this));var r=e(window).width();this.updateFunc=e.proxy(function(){if(r&&r!==e(window).width()){r=e(window).width();this.update_()}},this);t.autoResize&&e(window).on("orientationchange debouncedresize",this.updateFunc);this.$graphContainer.on("GET_DATA_RANGE",e.proxy(function(t,a){e.proxy(this.getData(e.proxy(function(t){a(n.Range.getDataRange(t,this.range.isTimeline))},this),this));return e(this.$graphContainer)},this));this.$graphContainer.on("GET_LABEL",e.proxy(function(t,a,n){e.proxy(this.getData(e.proxy(function(t){n(this.getDataLabelByIndex(a,t))},this),this));return e(this.$graphContainer)},this));this.$graphContainer.on("APPEND_TO",e.proxy(function(t,a){this.$graphContainer.appendTo(a);this.graphData[this.range.unit].done(e.proxy(function(t){var a;a=this.range.isTimeline?e.grep(t,e.proxy(function(t){return this.range.start<=t.timestamp&&t.timestamp<=this.range.end},this)):t.slice(this.range.min,this.range.max+1);this.draw_(a)},this));return e(this.$graphContainer)},this));return this.$graphContainer};n.Graph.prototype.getData=function(t){n.Data.getData(this.origData_,this.$graphContainer,t,this)};n.Graph.prototype.getDataLabelByIndex=function(t,a){var n=this.config.dataLabel||"x";return e.map(t,function(t){return a[t][n]})};n.Graph.prototype.getTotalCount_=function(t,a){var n=0,r="y"+(a||"");e.each(t,function(t,e){n+=parseInt(e[r]||e.value||0,10)});return n};n.Graph.prototype.getDelta_=function(t,e){var a,n,r,i,o=t.length;i="y"+(e||"");a=t[o-1];n=t[o-2];r=n&&a&&n[i]?a[i]-n[i]:a[i];return void 0===r?"":r};n.Graph.presetColors=function(){return["#6AAC2B","#FFBE00","#CF6DD3","#8F2CFF","#2D85FF","#5584D4","#5ED2B8","#9CCF41","#F87085","#2C8087","#8EEC6A","#FFE700","#FF5E19","#FF4040","#976BD6","#503D99","#395595"]};n.Graph.getChartColors=function(t,e){var a={reverse:function(t){return t.reverse()},shuffle:function(t){var e,a,n,r;n=t.length;for(e=0;n>e;e++){a=Math.floor(Math.random()*n);r=t[e];t[e]=t[a];t[a]=r}return t},def:function(t){return t}};return a[e||"def"](t||n.Graph.presetColors())};n.Graph.cachedChartColors={};n.Graph.getCachedChartColors=function(t,e,a){return n.Graph.cachedChartColors[t]=n.Graph.cachedChartColors[t]||n.Graph.getChartColors(e,a)};n.Graph.prototype.draw_=function(t){var a=this.config.type.split("."),r=a[0],i=a[1],o=this.config;if(o.label)if(this.labelTemplate)this.generateLabel(this.labelTemplate);else if(o.label.template){var s=o.label.template;if(window.require&&"function"==typeof require){var h=o.label.type;require([h+"!"+o.staticPath+s],e.proxy(function(t){this.labelTemplate=t;this.generateLabel(t)},this))}else{var l=e.get(o.staticPath+s,"text");n.Data.getData(l,this.$graphContainer,e.proxy(function(t){this.labelTemplate=t;this.generateLabel(t)},this))}}else{this.labelTemplate='<span class="graph-label-label"></span>';this.generateLabel(this.labelTemplate)}if(o.fallback&&o.fallback.test&&!n.Graph.test[o.fallback.test]()){a=o.fallback.type.split(".");r=a[0];i=a[1];o=e.extend(o,o.fallback)}o.chartColors&&"string"==typeof o.chartColors&&(o.chartColors=o.chartColors.split(","));this.graphObject=n.Graph[r][i](t,o,this.range,this.$graphContainer)};n.Graph.test={};n.Graph.test.canvas=function(){var t=document.createElement("canvas");return t.getContext&&t.getContext("2d")};n.Graph.test.svg=function(){var t={svg:"http://www.w3.org/2000/svg"};return!!document.createElementNS&&!!document.createElementNS(t.svg,"svg").createSVGRect};n.Graph.test.vml=function(){var t,e=n.Graph.test.svg();if(!e){var a=document.body.appendChild(document.createElement("div"));a.innerHTML='<v:shape id="vml_flag1" adj="1" />';var r=a.firstChild;r.style.behavior="url(#default#VML)";t=r?"object"==typeof r.adj:!0;a.parentNode.removeChild(a)}return e||t};n.Graph.prototype.generateLabel=function(t){var a,r=this.config.label.template&&this.config.label.data?this.config.label.data:{},i=this.config.label.yLength||this.config.yLength,o=e.proxy(function(){this.labels=new n.Graph.Labels(this.$graphContainer,i,t);this.getData(e.proxy(function(t){for(var e=0;i>e;e++){this.config.label.hideTotalCount||this.labels.getTotalObject(e).createTotalCount(this.getTotalCount_(t,e));!this.config.label.hideDeltaCount&&this.range.isTimeline&&this.labels.getTotalObject(e).createDeltaCount(this.getDelta_(t,e))}},this))},this);if(r&&"string"==typeof r)a=e.getJSON(this.config.staticPath+r);else{a=e.Deferred();a.resolve(r)}a.done(function(e){if(t&&"function"==typeof t){t=t(e);o()}else if(window._){t=_.template(t,e);o()}else{t=t;o()}})};n.Graph.prototype.update_=function(t,a){var r=this;t=t||[];this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.range=n.Range.generate({start:t[0]||this.range.start,end:t[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:a||this.range.unit,dataType:this.range.dataType,autoSized:this.range.autoSized});this.graphData[this.range.unit].done(e.proxy(function(t){var a;a=r.range.isTimeline?e.grep(t,e.proxy(function(t){return this.range.min<=t.timestamp&&t.timestamp<=this.range.max},this)):t.slice(this.range.min,this.range.max+1);this.draw_(a)},this))};n.Graph.prototype.remove_=function(){this.config.autoResize&&e(window).off("orientationchange debouncedresize",this.updateFunc);this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.$graphContainer.remove()};n.Graph.prototype.generateGraphData=function(t){var a,r,i,o,s,h,l,c=this.range,p=c.start,u=c.end,g=c.unit,d=c.length,f=[],y=this.config.yLength||1;if(this.range.isTimeline){var m=n.Range.getDataRange(t,this.range.isTimeline);p=new Date(Math.min(this.range.min,m.min));u=new Date(Math.max(this.range.max,m.max));d=n.Range.getLength(p,u,g);s=n.Data.filterData(t,m.max,m.min,g,y);for(a=0;d>a;a++){i=n.Range.getNextDate(p,u,a,g);if(!i)break;o=n.Date.createId(i,g);h={timestamp:i.valueOf(),x:n.Date.createXLabel(i,g)};for(r=0;y>r;r++){l="y"+(r||"");h[l]=s[o]?s[o][l]||0:0}f.push(h)}}else f=t;"morris.donut"===this.config.type&&e.each(f,function(t,a){e.extend(a,{label:a.xLabel||a.x,value:a.y})});return f};n.Graph.Labels=function(t,a,r){var i,o;this.$labelContainer=e('<div class = "graph-labels"></div>');r&&e('<div class="graph-label"></div>').html(r).prependTo(this.$labelContainer);this.totals={};for(i=0;a>i;i++){o="y"+(i||"");this.totals[o]=new n.Graph.Labels.Total(this.$labelContainer,i)}this.$labelContainer.appendTo(t)};n.Graph.Labels.prototype.remove=function(){this.$labelContainer.remove()};n.Graph.Labels.prototype.getTotalObject=function(t){return this.totals["y"+(t||"")]};n.Graph.Labels.Total=function(t,e){this.index=e;this.$totalContainer=a('<div class = "graph-total"></div>').appendTo(t)};n.Graph.Labels.Total.prototype.createTotalCount=function(t){a('<span class="graph-total-count graph-total-count-y"'+(this.index||"")+">"+t+"</span> ").appendTo(this.$totalContainer)};n.Graph.Labels.Total.prototype.createDeltaCount=function(t){var e=t?0>t?"minus ":"plus ":"zero ";a('<span class="graph-delta graph-delta-y"'+(this.index||"")+'><span class="'+e+'">('+t+")</span></span>").appendTo(this.$totalContainer)};n.Graph.css={};n.Graph.css.Base=function(t,a){this.len=t.length;this.$graphEl=e('<div id="'+a.id+'" class="css-graph">')};n.Graph.css.Base.prototype.remove=function(){this.$graphEl.remove()};n.Graph.css.Base.prototype.horizontalBar=function(t,a,r,i){a.width&&this.$graphEl.css({width:a.width,"max-width":"100%",margin:"0 auto"});for(var o,s,h,l,c,p,u=a.barColor||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod)[1],g=a.barBackgroundColor||"#f0f0f0",d=a.dateColor||"#999999",f=a.dateColorSaturday||d,y=a.dateColorSunday||d,m=a.labelColor||"#999999",v=parseInt(a.barWidth,10)||30,D=parseInt(a.barInterval,10)||5,C=parseInt(a.labelSize,10)||.45*v,b=function(){return e('<div class="css-graph-container"><div class="css-graph-date"></div><div class="css-graph-bar-container" style="height:'+v+"px; margin-bottom:"+D+'px"><div class="css-graph-bar"></div><div class="css-graph-bar-background"><div class="css-graph-bar-count"></div></div></div>')},x=e.map(t,function(t){return parseInt(t.y,10)}),w=e.map(t,function(t){return{value:""+parseInt(t.x.substr(t.x.lastIndexOf("-")+1),10),weekday:n.Date.parse(t.x)?n.Date.parse(t.x).getDay():null}}),T=Math.max.apply(null,x)||1,L=a.yLabel||x,$=this.len;$>0;){$-=1;o=Math.floor(100*(x[$]/T))-15;s=b();h=s.find(".css-graph-bar-background");h.css({"background-color":g});if(a.showDate){p=s.find(".css-graph-date");p.text(w[$].value).css({color:d,"font-size":C+"px","line-height":v+"px"});6===w[$].weekday?p.addClass("saturday").css({color:f}):0===w[$].weekday&&p.addClass("sunday").css({color:y});s.find(".css-graph-bar-container").css({"margin-left":v+"px"})}l=s.find(".css-graph-bar");l.css({width:o+"%","background-color":u});c=s.find(".css-graph-bar-count");c.text(L[$]).css({color:m,"font-size":C+"px","line-height":v+"px"});s.appendTo(this.$graphEl)}this.$graphEl.appendTo(i)};n.Graph.css.Base.prototype.ratioHorizontalBar=function(t,a,r,i){var o,s,h,l,c,p,u,g,d,f,y,m,v=a.yLength,D=parseInt(a.barWidth,10)||30,C=parseInt(a.barInterval,10)||5,b=parseInt(a.labelSize,10)||.45*D,x=a.dateColor||"#999999",w=a.barColors||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod),T=a.labelColors,L=a.labelClasses;for(o=0;this.len>o;o++){h=t[o];l=[];c=0;m=0;for(s=0;v>s;s++){l.push(h["y"+(s||"")]);c+=parseInt(h["y"+(s||"")],10)}p=e('<div class="css-graph-container"></div>').appendTo(this.$graphEl);if(a.showDate&&h.x){d=""+parseInt(h.x.substr(h.x.lastIndexOf("-")+1),10);f=e('<div class="css-graph-date" style="color:'+x+";font-size: "+b+"px; line-height:"+D+'px">'+d+"</div>").appendTo(p)}u=e('<div class="css-graph-bar-container" style="height:'+D+"px; margin-bottom:"+C+'px"></div>').appendTo(p);a.showDate&&u.css({"margin-left":D+"px"});for(s=0;v>s;s++){y=Math.floor(1e3*(l[s]/c))/10;if(y){v===s&&(y=100-m);m+=y;g=e('<div class="css-graph-y css-graph-y'+(s||"")+'" data-count="'+l[s]+'" style="line-height:'+D+"px; font-size:"+b+'px"></div>');g.css({width:y+"%","background-color":w[s]});a.showCount&&g.text(l[s]);L&&L[s]&&g.addClass(L[s]);T&&T[s]&&g.css({color:T[s]});g.appendTo(u)}}u.appendTo(p)}this.$graphEl.appendTo(i)};n.Graph.css.horizontalBar=n.Graph.css.ratioHorizontalBar=function(t,e,a,r){var i=new n.Graph.css.Base(t,e,a,r),o=e.type.slice(e.type.lastIndexOf(".")+1);i[o](t,e,a,r);return i};n.Graph.easel={};n.Graph.easel.Base=function(t,a,n,r){this.data=t;this.config=a;this.range=n;this.$container=r;if(window.createjs||"function"!=typeof window.require){var i=parseInt(a.width||r.width(),10);i?this.buildCanvas(createjs):setTimeout(e.proxy(function(){this.buildCanvas(createjs)},this),100)}else require(["easeljs"],e.proxy(function(){this.buildCanvas(createjs)},this))};n.Graph.easel.Base.prototype.buildCanvas=function(t){this.width=parseInt(this.config.width||this.$container.width(),10)||300;this.height=parseInt(this.config.height||this.$container.height(),10)||300;this.$canvas=e('<canvas id="'+this.config.id+'" class="graph-canvas" width="'+this.width+'" height="'+this.height+'">').appendTo(this.$container);this.canvas=this.$canvas.get(0);this.canvas.getContext("2d");this.stage=this.graph=new t.Stage(this.canvas);this.stage.update();var a=this.config.type.split(".")[1];this[a](this.data,this.config)};n.Graph.easel.Base.prototype.remove=function(){this.$canvas.remove()};n.Graph.easel.Base.prototype.bar=function(t,a){for(var r,i,o,s,h,l=t.length,c=a.chartColorsAlpha?a.chartColorsAlpha[0]:1,p=a.chartColors||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod),u=this.convertColor(p[0],c),g=parseInt(a.barMargin,10)||10,d=Math.floor(this.width/l),f=d-g,y=Math.floor((this.width-d*l)/2)+g/2,m=e.map(t,function(t){return parseInt(t.y,10)}),v=Math.max.apply(null,m)||1,D=0;l>D;D++){r=new createjs.Shape;i=r.graphics;o=D*d+y;h=Math.floor(m[D]/v*this.height);s=this.height-h;i.beginFill(u).drawRect(o,s,f,h);this.stage.addChild(r)}this.stage.update()};n.Graph.easel.Base.prototype.motionLine=function(t,a){for(var r,i=t.length,o=parseInt(a.lineWidth,10)||8,s=a.yLength||1,h=a.lineColors||a.chartColors||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod),l=a.chartColorsAlpha||[null],c=a.pointerColors||a.chartColors||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod),p=a.pointerColorsAlpha||[null],u=a.pointerRadius||10,g=o/2,d=2*(i-1),f=Math.floor(this.width/i)/2,y=(this.width-f*d)/2,m=this.height,v=this.height-o,D=[],C=function(t){return parseInt(t["y"+(b||"")],10)},b=0;s>b;b++){r=e.map(t,C);D.push(r)}var x=[];e.each(D,function(t,e){x=x.concat(e)});var w=Math.max.apply(null,x)||1,T=[],L=function(t){var a=[];e.each(t,function(e,n){if(e>0){var r=t[e-1],i=r+Math.floor((n-r)/2);i=Math.floor(i/w*v)+g;n=Math.floor(n/w*v)+g;a=a.concat([i,n])}else{n=Math.floor(n/w*v)+g;a.push(n)}});return a};e.each(D,function(t,e){T.push(L(e))});var $,G,M,_=[],E=[],S=y,A=[];for(b=0;s>b;b++){$=this.convertColor(h[b],l[b]);_[b]=new createjs.Shape;E[b]=_[b].graphics;G=m-T[b][0];E[b].setStrokeStyle(o).beginStroke($).moveTo(S,G);this.stage.addChild(_[b]);if(a.drawPointer){M=this.convertColor(c[b],p[b]);A[b]=new createjs.Shape;A[b].graphics.beginFill(M).drawCircle(0,0,u);this.stage.addChild(A[b])}}var R=this.stage,I=function(t){d-=1;0===d&&createjs.Ticker.removeEventListener("tick",I);S+=f;for(var e,n=0;s>n;n++){e=T[n];G=m-e[e.length-d-1];E[n].lineTo(S,G);if(a.drawPointer){A[n].x=S;A[n].y=Math.max(G,u)}}R.update(t)};createjs.Ticker.useRAF=!0;createjs.Ticker.setFPS(30);createjs.Ticker.addEventListener("tick",I)};n.Graph.easel.Base.prototype.convertColor=function(t,e){if(-1!==t.indexOf("#")){var a=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),r=parseInt(t.substr(5,2),16);t=e?"rgba("+[a,n,r,e].join(",")+")":"rgb("+[a,n,r].join(",")+")"}else-1!==t.indexOf("rgb")&&(t=4>t.split(",").length?"rgb("+t+")":"rgba("+t+")");return t};n.Graph.easel.Base.prototype.mix=function(t,a){var r=0,i=function(t,a){t=t||1;var n=e.map(a,function(e){for(var a,n,i={x:e.x},o=0;t>o;o++){a="y"+(o||"");n="y"+(r+o||"");i[a]=e[n]}return i});r+=t;return n},o=a.chartColors||n.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod);e.each(a.mix,e.proxy(function(n,s){var h={chartColors:o.slice(r,r+s.yLength)},l=i(s.yLength,t);s=e.extend({},a,h,s);this[s.type](l,s)},this))};n.Graph.easel.bar=n.Graph.easel.motionLine=n.Graph.easel.mix=function(t,e,a,r){if(n.Graph.test.canvas()){var i=new n.Graph.easel.Base(t,e,a,r);return i}console.warn("EaselJS graph requires for HTML5 Canvas capability");r.trigger("REMOVE")};n.Graph.morris={};n.Graph.morris.Base=function(t,a,n,r){if(window.Morris||"function"!=typeof window.require){var i=a.width||r.width();i?this.build_(Morris,t,a,n,r):setTimeout(e.proxy(function(){this.build_(Morris,t,a,n,r)},this),100)}else require(["raphael","morris"],e.proxy(function(){this.build_(Morris,t,a,n,r)},this))};n.Graph.morris.Base.prototype.build_=function(t,a,r,i,o){var s,h,l,c=r.type.split(".")[1],p=r.yLength,u=r.width||o.width()||300,g=r.height||o.height()||300;this.$graphEl=e('<div id="'+r.id+'" class="graph-element"></div>').css({height:g+"px",width:u+"px"}).prependTo(o);r=e.extend({},r,{element:r.id,data:a,xkey:"x",labels:this.getYLabels_(p,r.labels),ykeys:this.getYKeys_(p),ymax:this.getYMax_(a,c,p),ymin:r.ymin||0,lineWidth:parseInt(r.lineWidth,10)||6,pointSize:parseInt(r.pointSize,10)||6,smooth:r.smooth||!1});r.barColors=r.barColors||this.getChartColors(r);r.colors=r.colors||this.getChartColors(r);r.lineColors=r.lineColors||this.getChartColors(r);r.numLines=parseInt(r.numLines,10)||this.getNumLines_(r.ymax,g);r.pointStrokeColors=r.pointStrokeColors?r.pointStrokeColors.split(/,/):[];if(!r.pointStrokeColors.length)for(s=0;p>s;s++)r.pointStrokeColors.push("none");h={element:null,data:null,xkey:"x",labels:[],ykeys:[],dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,hideHover:!1,yLabelFormat:null,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],lineWidth:3,pointSize:4,lineColors:["#0b62a4","#7A92A3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],pointWidths:[1],pointStrokeColors:["#ffffff"],pointFillColors:[],smooth:!0,xLabels:"auto",xLabelFormat:null,xLabelMargin:50,continuousLine:!0,barSizeRatio:.75,barGap:3,barColors:["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:t.commas};l={};e.each(r,function(t,e){void 0!==h[t]&&(l[t]=e)});n.Graph.test.svg||(l.smooth=!0);if("donut"===c){var d=this.getTotalCount_(a,s);l.formatter=function(t){return t+"("+Math.ceil(1e4*(t/d))/100+"%)"}}var f={bar:t.Bar,line:t.Line,donut:t.Donut,area:t.Area}[c];this.graph=new f(l)};n.Graph.morris.Base.prototype.getYMax_=function(t,a,n){var r,i,o,s,h;if("area"!==a){o=[];e.each(t,function(t,e){for(r=0;n>r;r++){h="y"+(r||"");o.push(parseInt(e[h],10))}});i=Math.max.apply(null,o)}else i=Math.max.apply(null,e.map(t,function(t){s=0;for(r=0;n>r;r++){h="y"+(r||"");s+=parseInt(t[h],10)}return s}));i||(i=1);0!==i%2&&(i+=1);return i};n.Graph.morris.Base.prototype.getChartColors=function(t){this.chartColors||(this.chartColors=t.chartColors||n.Graph.getCachedChartColors(t.id,null,t.chartColorsMethod));return this.chartColors};n.Graph.morris.Base.prototype.getYKeys_=function(t){var e,a=[];for(e=0;t>e;e++)a.push("y"+(e||""));return a};n.Graph.morris.Base.prototype.getYLabels_=function(t,e){var a,n=[];e=e?e.split(/,/):[];for(a=0;t>a;a++)n.push(e[a]||"Count");return n};n.Graph.morris.Base.prototype.getNumLines_=function(t,e){var a;a=t>=18?9:2===t?3:t/2+1;a=Math.min(a||1,Math.floor(e/56));return a};n.Graph.morris.Base.prototype.getTotalCount_=function(t,a){var n=0,r="y"+(a||"");e.each(t,function(t,e){n+=e[r]||e.value||0});return n};n.Graph.morris.Base.prototype.remove=function(){this.$graphEl.remove()};n.Graph.morris.bar=n.Graph.morris.line=n.Graph.morris.donut=n.Graph.morris.area=function(t,e,a,r){if(n.Graph.test.vml()){var i=new n.Graph.morris.Base(t,e,a,r);return i}console.warn("Morris graph requires for SVG/VML capability");r.trigger("REMOVE")};n.Slider=function(t,a,r,i,o){if(!e.ui||!e.ui.slider)throw"ChartAPI.Slider requied jQuery UI Slider";var s=this;this.id="slider-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=t;this.range=n.Range.generate(a);this.$dataRangeTarget=r;this.$sliderContainer=e('<div id="'+this.id+'-container" class="slider-container"></div>');this.eventTargetList={update:this.initEventTarget(),amount:this.initEventTarget()};e.each(i,function(t,e){s.eventTargetList.update.add(e)});e.each(o,function(t,e){s.eventTargetList.amount.add(e)});this.$sliderContainer.on("APPEND_TO",function(t,a){s.$container=a;s.draw_(a);return e(this)});this.$sliderContainer.on("BUILD_SLIDER",function(){s.$dataRangeTarget.trigger("GET_DATA_RANGE",function(t){s.buildSlider(t.min,t.max)});return e(this)});this.$sliderContainer.on("SET_DATA_RANGE",function(t,a){s.$dataRangeTarget=a;return e(this)});this.$sliderContainer.on("ADD_EVENT_LIST",function(t,a,n){n=e.isArray(n)?n:[n];e.each(n,function(t,e){s.eventTargetList[a].add(e)});return e(this)});this.$sliderContainer.on("REMOVE_EVENT_LIST",function(t,a,n){n=e.isArray(n)?n:[n];e.each(n,function(t,e){s.eventTargetList[a].remove(e)});return e(this)});this.$sliderContainer.on("ERASE",function(){s.erase_();return e(this)});this.$sliderContainer.on("REDRAW",function(){var t=e(this);t.trigger("BUILD_SLIDER").trigger("APPEND_TO",[s.$container]);return e(this)});this.$sliderContainer.on("UPDATE",function(t,a){s.$slider("values",a);s.updateSliderAmount(a);return e(this)});return this.$sliderContainer};n.Slider.prototype.initEventTarget=function(){var t=[];return{add:function(e){t.push(e)},remove:function(a){t=e.grep(t,function(t){return t!==a})},get:function(){return t}}};n.Slider.prototype.buildSlider=function(t,a,n){var r=this;n=n||[this.range.min,this.range.max];if(this.$slider){this.$slider.destroy();this.$slider.remove()}this.$slider=e('<div class="slider"></div>').slider({range:!0,min:t,max:a,values:n,slide:function(t,e){r.updateSliderAmount(e.values,e)},stop:function(t,e){r.updateGraphAndList(e.values)}}).appendTo(r.$sliderContainer);if(!this.config.hideSliderAmount){this.$amount=e('<div class="amount"></div>');this.config.appendSliderAmountBottom?this.$amount.appendTo(this.$sliderContainer):this.$amount.prependTo(this.$sliderContainer);this.updateSliderAmount(n)}};n.Slider.prototype.draw_=function(t){this.$sliderContainer.appendTo(t)};n.Slider.prototype.erase_=function(){this.$slider&&this.$slider.destroy();this.$sliderContainer.html("")};n.Slider.prototype.updateSliderAmount=function(t,a){var r,i,o,s,h=this.range.maxLength,l=this.$amount;if(this.range.isTimeline){r=n.Date.parse(t[0]);i=n.Date.parse(t[1]);o=this.range.unit;s=n.Range.getLength(r,i,o);if(a&&s>h)if(a.value===a.values[0]){i=n.Date.calcDate(r,h,o,!1);this.$slider.slider("values",1,i.valueOf())}else{r=n.Date.calcDate(i,h,o,!0);this.$slider.slider("values",0,r.valueOf())}l&&l.text([n.Date.createXLabel(r,o),n.Date.createXLabel(i,o)].join(" - "))}else{r=t[0];i=t[1];if(i-r>h)if(a.value===a.values[0]){i=h-r;this.$slider.slider("values",1,i)}else{r=i-h;this.$slider.slider("values",0,r)}l&&e.each(this.eventTargetList.amount.get(),function(t,e){e.trigger("GET_LABEL",[[r,i],function(t){l.text([t[0],t[1]].join(" - "))}])})}};n.Slider.prototype.updateGraphAndList=function(t,a){e.each(this.eventTargetList.update.get(),function(e,n){n.trigger("UPDATE",[t,a])})};n.Slider.prototype.update_=function(t,e){this.$slider.slider("values",t,e)};n.List=function(t,a){this.id="list-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=t;this.config.staticPath=this.config.staticPath||"";if(this.config.data&&"string"==typeof this.config.data)this.origData_=e.getJSON(this.config.staticPath+this.config.data);else{this.origData_=e.Deferred();this.origData_.resolve(this.config.data)}if(this.config.template){if(window.require&&"function"==typeof require){var r=this.config.type||"text";this.template_=e.Deferred();require([r+"!"+this.config.staticPath+this.config.template],e.proxy(function(t){this.template_.resolve(t)},this))}else this.template_=e.get(this.config.staticPath+this.config.template,"text");this.range=n.Range.generate(a);this.$listContainer=e('<div id="'+this.id+'-container" class="list-container"></div>');this.$listContainer.on("UPDATE",e.proxy(function(t,e){this.update_(e)},this));this.$listContainer.on("GET_DATA_RANGE",e.proxy(function(t,a){this.getData(e.proxy(function(t){a(n.Range.getDataRange(t,this.range.isTimeline))},this));return this.$listContainer},this));this.$listContainer.on("GET_LABEL",e.proxy(function(t,a,n){this.getData(e.proxy(function(t){n(this.getDataLabelByIndex(a,t))},this));return this.$listContainer},this));this.$listContainer.on("APPEND_TO",e.proxy(function(t,a){this.$listContainer.appendTo(a);this.getData(e.proxy(function(t){this.draw_(t)},this));return this.$listContainer},this));return this.$listContainer}};n.List.prototype.getData=function(t){this.config.data?n.Data.getData(this.origData_,this.$listContainer,t,this):t()};n.List.prototype.getTemplate=function(t){n.Data.getData(this.template_,this.$listContainer,t,this)};n.List.prototype.draw_=function(t){var e=this;this.getTemplate(function(a){t=e.createListData(t);e.$listContainer.html(_.template(a,t))})};n.List.prototype.getDataLabelByIndex=function(t,a){var n=this.config.dataLabel||"x";return e.map(t,function(t){return a[t][n]})};n.List.prototype.createListData=function(t){var e="";t&&(e=this.range.isTimeline?n.Data.filterData(t,this.range.max,this.range.min,this.range.unit,1,!0):t.slice(this.range.min,this.range.max+1));return{data:e}};n.List.prototype.update_=function(t,e){var a=this;t=t||[];e=e||this.range.unit;this.range=n.Range.generate({start:t[0]||this.range.start,end:t[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:e,dataType:this.range.dataType});this.getData(function(t){a.draw_(t)})};n.Build=function(t){var a;if("string"==typeof t&&/\.json$/.test(t)){a=e('<div class="mtchart-container">');n.Data.getData(e.getJSON(t),null,function(t){t.$container=a;n.Build_(t).trigger("APPEND")})}else a=n.Build_(t).trigger("APPEND");return a};n.Build_=function(t){var a,r,i,o,s,h,l;a=t.$container||e('<div class="mtchart-container">');h=[];if(t.graph){r=new n.Graph(t.graph,t.range);h.push(r)}if(t.list){o=new n.List(t.list,t.range);t.list.data&&h.push(o)}if(t.graph&&"donut"!==t.graph.type){s=r;l=[r]}else{s=o;l=[o]}var c=function(){var t=window.navigator?window.navigator.userAgent:"";return/android|iphone|ipod|ipad/i.test(t)};!t.slider||!t.slider.force&&c()||(i=new n.Slider(t.slider,t.range,s,h,l));a.on("APPEND",function(){r&&r.trigger("APPEND_TO",[a]);
i&&i.trigger("BUILD_SLIDER").trigger("APPEND_TO",[a]);o&&o.trigger("APPEND_TO",[a])});a.on("GET_CONTAINER",function(t,e,a){a({graph:r,slider:i,list:o}[e])});return a};return n})(this,jQuery);return MT.ChartAPI});