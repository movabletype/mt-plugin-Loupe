define("js/views/card/composite",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{appendHtml:function(e,t){if(!this.loading){var s=this.getItemViewContainer(e);s.append(t.el)}},handleReadmore:function(e){this.$el.find(".readmore").hammer(this.hammerOpts).on("tap",_.bind(function(t){this.addTapClass(t.currentTarget,_.bind(function(){this.loadingReadmore=!0;this.render();this.fetch(e)},this))},this))},handleItemViewNavigate:function(){this.$el.hammer(this.hammerOpts).on("tap","a",_.bind(function(e){e.preventDefault();e.stopPropagation();var s=$(e.currentTarget).data("route")||"";this.addTapClass(e.currentTarget,function(){t.execute("router:navigate",s)});return!1},this))},fetch:function(e){e=e||{};var t={merge:!0,remove:!1,sort:!0,success:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!1;e.successCallback&&e.successCallback();this.render()},this),error:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!0;e.errorCallback&&e.errorCallback();this.render()},this)};t=_.extend(t,e);this.collection.fetch(t)}});return e.CompositeView.extend(i,{cardCompositeViewProto:i})});
define("cards/acception/models/model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,s,i){if("read"===e){var n=$.Deferred();n.done(i.success);n.fail(i.error);t.api.getEntry(i.blogId,i.entryId,function(e){e.error?n.reject(e):n.resolve(e)});return n}if("update"===e){var n=$.Deferred(),a=s.get("blog").id,r=s.get("id"),o=s.toJSON();n.done(i.success);n.fail(i.error);o.status=i.status||o.status;t.api.updateEntry(a,r,o,function(e){e.error?n.reject(e):n.resolve(e)});return n}}})});
define("cards/acception/models/collection",["backbone","moment","js/mtapi","cards/acception/models/model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e;this.isSynced=!1},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var n=$.Deferred();n.done(i.success);n.fail(i.error);var a={status:"Review"};i.limit&&(a.limit=parseInt(i.limit,10));i.offset&&(a.offset=parseInt(i.offset,10));s.api.listEntries(this.blogId,a,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("hbs!cards/acception/templates/dashboard_itemview",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n,a="";a+="\n      ";i=e.assets;n=s.eachOnly;i=n?n.call(e,i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)}):f.call(e,"eachOnly",i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function r(e){var t,i,n="";n+='\n      <span class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+') no-repeat center center / cover"><span class="circle-inner"></span></span>\n      ';return n}function o(){return'\n      <span class="item-asset no-image circle"><span class="circle-inner"></span></span>\n    '}s=s||e.helpers;var l,c,d="",h="function",p=this.escapeExpression,u=this,f=s.helperMissing;d+='<a data-route="acception/';l=t.blog;l=null==l||l===!1?l:l.id;l=typeof l===h?l():l;d+=p(l)+"/";l=t.id;l=typeof l===h?l():l;d+=p(l)+'">\n  <span class="item-content">\n    <span class="item-asset-container">\n    ';l=t.assets;l=null==l||l===!1?l:l.length;l=s["if"].call(t,l,{hash:{},inverse:u.program(4,o,n),fn:u.program(1,a,n)});(l||0===l)&&(d+=l);d+='\n    </span>\n    <span class="item-title">';c=s.title;if(c)l=c.call(t,{hash:{}});else{l=t.title;l=typeof l===h?l():l}d+=p(l)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return d});t.registerPartial("cards_acception_templates_dashboard_itemview",s);return s});
define("cards/acception/dashboard/itemview",["backbone.marionette","cards/acception/models/model","hbs!cards/acception/templates/dashboard_itemview"],function(e,t,s){return e.ItemView.extend({tagName:"li",template:function(e){return s(e)}})});
define("hbs!cards/acception/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/noItem","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var n,a="";a+="\n";n=e;n=c.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(a+=n);a+='\n<div class="content">\n  ';n=e;n=c.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=e;n=c.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=e;n=c.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",n,s,i);(n||0===n)&&(a+=n);a+='\n  <ul id="acceptions-list" class="card-item-list" ';n=e.fetchError;n=s["if"].call(e,n,{hash:{},inverse:c.noop,fn:c.program(2,r,t)});(n||0===n)&&(a+=n);a+="></ul>\n  ";n=e;n=c.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",n,s,i);(n||0===n)&&(a+=n);a+="\n</div>\n";return a}function r(){return'style="display:none"'}s=s||e.helpers;i=i||e.partials;var o,l="",c=this;o=t.perm;o=s["if"].call(t,o,{hash:{},inverse:c.noop,fn:c.program(1,a,n)});(o||0===o)&&(l+=o);l+="\n";return l});t.registerPartial("cards_acception_templates_dashboard",s);return s});
define("cards/acception/dashboard/dashboard",["backbone.marionette","js/cache","js/device","js/commands","js/trans","js/views/card/composite","cards/acception/models/collection","cards/acception/dashboard/itemview","hbs!cards/acception/templates/dashboard"],function(e,t,s,i,n,a,r,o,l){return a.extend({template:l,itemView:o,itemViewContainer:"#acceptions-list",initialize:function(){a.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userHasPermission("edit_all_posts");this.dashboardShowWithPermission(this.perm).done(_.bind(function(){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new r(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},this))},onRender:function(){if(this.perm){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(e)}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);e.items=this.collection.toJSON()}}return e}})});
define("hbs!cards/acception/templates/view",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/trans","template/helpers/ifIs","template/helpers/formatDate","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var n,a="";a+="\n    ";n=e;n=z.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n    ";n=e.acceptionFailed;n=s["if"].call(e,n,{hash:{},inverse:z.noop,fn:z.program(2,r,t)});(n||0===n)&&(a+=n);a+="\n      ";n=e.fetchError;n=s["if"].call(e,n,{hash:{},inverse:z.noop,fn:z.program(7,c,t)});(n||0===n)&&(a+=n);a+="\n    ";n=e.id;n=s["if"].call(e,n,{hash:{},inverse:z.noop,fn:z.program(10,h,t)});(n||0===n)&&(a+=n);a+="\n  ";return a}function r(e,t){var i,n,a="";a+='\n        <div class="acception-failed error"><span class="message"><span class="message-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(3,o,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(3,o,t)});(i||0===i)&&(a+=i);a+='</span></span><div class="close-me button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(5,l,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(5,l,t)});(i||0===i)&&(a+=i);a+="</div></div>\n    ";return a}function o(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===P?t():t}return C(t)}function l(){return"close"}function c(e,t){var i,n,a="";a+='\n       <div class="error">\n        <span class="message"><span class="message-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(8,d,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(8,d,t)});(i||0===i)&&(a+=i);a+="</span></span>\n        </div>\n       ";return a}function d(){return"Failed fetching data"}function h(e,t){var i,n,a,r="";r+="\n      ";i=e.status;n={};n.eq="Review";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:z.program(16,m,t),fn:z.program(11,p,t)}):D.call(e,"ifIs",i,{hash:n,inverse:z.program(16,m,t),fn:z.program(11,p,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function p(e,t){var i,n,a,r="";r+='\n        <div id="accept-button" class="contents-top-button button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:z.noop,fn:z.program(12,u,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(12,u,t)});(i||0===i)&&(r+=i);r+='</div>\n        <div class="title">';a=s.title;if(a)i=a.call(e,{hash:{}});else{i=e.title;i=typeof i===P?i():i}r+=C(i)+'</div>\n        <div class="date">';i=e.lang;n=e.date;a=s.formatDate;i=a?a.call(e,n,i,{hash:{}}):D.call(e,"formatDate",n,i,{hash:{}});r+=C(i)+'</div>\n        <div class="author">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:z.noop,fn:z.program(14,f,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(14,f,t)});(i||0===i)&&(r+=i);r+='<span class="author-name">';i=e.author;i=null==i||i===!1?i:i.displayName;i=typeof i===P?i():i;r+=C(i)+'</span></div>\n        <div class="body">';i=e.body;a=s.sanitize;i=a?a.call(e,i,{hash:{}}):D.call(e,"sanitize",i,{hash:{}});r+=C(i)+"</div>\n      ";return r}function u(){return"Accept"}function f(){return"Author"}function m(e,t){var i,n,a,r="";r+="\n        ";i=e.status;n={};n.eq="Publish";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:z.noop,fn:z.program(17,v,t)}):D.call(e,"ifIs",i,{hash:n,inverse:z.noop,fn:z.program(17,v,t)});(i||0===i)&&(r+=i);r+="\n      ";return r}function v(e,t){var i,n,a,r="";r+='\n        <div id="published-button" class="ok contents-top-button button button-with-undo">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';i=e.accepted;i=s["if"].call(e,i,{hash:{},inverse:z.program(21,_,t),fn:z.program(18,g,t)});(i||0===i)&&(r+=i);r+='\n            <span id="accept-undo" class="button-undo"><span class="button-undo-inner icon-undo-arrow"></span></span>\n          </span>\n        </div>\n        <div class="title">';a=s.title;if(a)i=a.call(e,{hash:{}});else{i=e.title;i=typeof i===P?i():i}r+=C(i)+'</div>\n        <div class="date">';i=e.lang;n=e.date;a=s.formatDate;i=a?a.call(e,n,i,{hash:{}}):D.call(e,"formatDate",n,i,{hash:{}});r+=C(i)+'</div>\n        <div class="author">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:z.noop,fn:z.program(24,y,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(24,y,t)});(i||0===i)&&(r+=i);r+='<span class="author-name">';i=e.author;i=null==i||i===!1?i:i.displayName;i=typeof i===P?i():i;r+=C(i)+'</span></div>\n        <div class="body">';i=e.body;a=s.sanitize;i=a?a.call(e,i,{hash:{}}):D.call(e,"sanitize",i,{hash:{}});r+=C(i)+"</div>\n        ";return r}function g(e,t){var i,n,a="";a+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(19,b,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(19,b,t)});(i||0===i)&&(a+=i);a+="\n            ";return a}function b(){return"Published!"}function _(e,t){var i,n,a="";a+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(22,w,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(22,w,t)});(i||0===i)&&(a+=i);a+="\n            ";return a}function w(){return"Published"}function y(){return"Author"}function j(e,t){var i,n,a="";a+='\n    <div class="error"><span class="message"><span class="message-inner">\n    ';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:z.noop,fn:z.program(27,I,t)}):D.call(e,"trans",i,{hash:{},inverse:z.noop,fn:z.program(27,I,t)});(i||0===i)&&(a+=i);a+="\n    </span></span></div>\n  ";return a}function I(){return"User has no permission for this card"}s=s||e.helpers;i=i||e.partials;var k,x="",P="function",C=this.escapeExpression,z=this,D=s.helperMissing;x+='<section id="acception-view" class="card">\n  <div class="content">\n  ';k=t.perm;k=s["if"].call(t,k,{hash:{},inverse:z.program(26,j,n),fn:z.program(1,a,n)});(k||0===k)&&(x+=k);x+="\n  </div>\n</section>\n";return x});t.registerPartial("cards_acception_templates_view",s);return s});
define("cards/acception/view/view",["js/views/card/itemview","js/cache","js/device","js/commands","js/trans","moment","moment.lang","cards/acception/models/collection","cards/acception/models/model","hbs!cards/acception/templates/view"],function(e,t,s,i,n,a,r,o,l,c){return e.extend({template:c,ui:{button:"#accept-button",undo:"#accept-undo"},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=s.routes;this.blogId=n[0];this.entryId=n[1];this.perm=this.userHasPermission("edit_all_posts");if(this.perm){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.model=this.collection.get(this.entryId);this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.model=new l;this.model.fetch({blogId:this.blogId,entryId:this.entryId,success:_.bind(function(){this.collection.add(this.model);this.loading=!1;this.render()},this),error:_.bind(function(){this.fetchError=!0;this.loading=!1;this.render()},this)})}},this));i.setHandler("card:acception:share:show",_.bind(function(){var e=this.serializeData();i.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))}else this.setTranslation()},update:function(e){this.loading=!0;this.render();var t={status:e,success:_.bind(function(t){this.loading=!1;if("Publish"===e){this.accepted=!0;this.collection.remove(this.model);this.collection.totalResults=this.collection.totalResults-1}else{this.accepted=!0;this.collection.add(this.model);this.collection.totalResults=this.collection.totalResults+1}this.model.set(this.model.parse(t));this.render()},this),error:_.bind(function(e){this.error=e.error&&e.error.message?e.error.message:"Acception failed";this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,t)},onRender:function(){if(this.perm){this.acceptionFailed&&this.$el.find(".acception-failed .close-me").hammer().on("tap",function(){$(this).parent().remove()});this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Publish")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass($("#published-button"),_.bind(function(){this.update("Review")},this))},this))}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;if(this.model){e=_.extend(e,this.model.toJSON());i.execute("header:render",e)}e.accepted=this.accepted?!0:!1;e.acceptionFailed=this.acceptionFailed?!0:!1}else e.trans=this.trans;return e}})});
define("cards/acception/view/view_header",["backbone.marionette","js/views/card/header"],function(e,t){return t.extend({serializeData:function(){var e=t.prototype.serializeData.apply(this);e.post=this.object||{};"Publish"===e.post.status&&(e.shareEnabled=!0);return e}})});
define("cards/feedbacks/models/comments_model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({initialize:function(e){this.blogId=e.blogId},sync:function(e,s,i){if("read"===e){var n=$.Deferred();n.done(i.success);n.fail(i.error);t.api.getComment(this.blogId,this.id,function(e){e.error?n.reject(e):n.resolve(e)});return n}if("update"===e){var n=$.Deferred();n.done(i.success);n.fail(i.error);var a=s.get("blog").id,r=s.get("id"),o=s.toJSON();o.status=i.status||o.status;t.api.updateComment(a,r,o,function(e){e.error?n.reject(e):n.resolve(e)});return n}}})});
define("hbs!cards/feedbacks/templates/comments_item_views",["hbs","handlebars","template/helpers/removeHtml"],function(e,t){var s=t.template(function(e,t,s){s=s||e.helpers;var i,n,a="",r="function",o=this.escapeExpression,l=s.helperMissing;a+='<a data-route="feedbacks/comments/';i=t.blog;i=null==i||i===!1?i:i.id;i=typeof i===r?i():i;a+=o(i)+"/";i=t.id;i=typeof i===r?i():i;a+=o(i)+'">\n  <span class="item-content">\n    <span class="item-asset-container">\n      <span class="item-asset icon-comment"></span>\n    </span>\n    <span class="item-title">';i=t.body;n=s.removeHtml;i=n?n.call(t,i,{hash:{}}):l.call(t,"removeHtml",i,{hash:{}});a+=o(i)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return a});t.registerPartial("cards_feedbacks_templates_comments_item_views",s);return s});
define("cards/feedbacks/dashboard/comments_itemview",["backbone.marionette","cards/feedbacks/models/comments_model","hbs!cards/feedbacks/templates/comments_item_views"],function(e,t,s){return e.ItemView.extend({tagName:"li",template:function(e){return s(e)}})});
define("cards/feedbacks/models/comments_collection",["backbone","moment","js/mtapi","cards/feedbacks/models/comments_model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var n=$.Deferred();n.done(i.success);n.fail(i.error);var a={limit:i.limit,entryStatus:"Publish"};i.offset&&(a.offset=i.offset);s.api.listComments(this.blogId,a,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("hbs!cards/feedbacks/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/noItem","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,a="",r=this;n=t;n=r.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(a+=n);a+='\n<div class="content">\n  ';n=t;n=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",n,s,i);(n||0===n)&&(a+=n);a+='\n  <ul id="feedback-comments-list" class="card-item-list"></ul>\n  ';n=t;n=r.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",n,s,i);(n||0===n)&&(a+=n);a+="\n</div>\n";return a});t.registerPartial("cards_feedbacks_templates_dashboard",s);return s});
define("cards/feedbacks/dashboard/dashboard",["js/cache","js/device","js/commands","js/trans","cards/feedbacks/models/comments_collection","hbs!cards/feedbacks/templates/dashboard","cards/feedbacks/dashboard/comments_itemview","js/views/card/composite"],function(e,t,s,i,n,a,r,o){return o.extend({template:a,itemView:r,itemViewContainer:"#feedback-comments-list",serializeData:function(){var e=this.serializeDataInitialize();e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0)}return e},initialize:function(){o.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.collection=e.get(this.blogId,"feedbacks_comments")||e.set(this.blogId,"feedbacks_comments",new n(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},onRender:function(){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(e)}})});
define("cards/feedbacks/models/trackbacks_collection",["backbone","js/mtapi","cards/feedbacks/models/comments_model"],function(e,t,s){return e.Collection.extend({model:s,initialize:function(e){this.blogId=e},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,s,i){var n=$.Deferred();n.done(i.success);n.fail(i.error);t.api.listTrackbacks(this.blogId,{limit:1},_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("cards/feedbacks/models/trackbacks_model",["backbone","js/mtapi"],function(e){return e.Model.extend({})});
define("hbs!cards/feedbacks/templates/content",["hbs","handlebars","template/helpers/formatDate","template/helpers/trans","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(){return"Author"}s=s||e.helpers;var r,o,l,c="",d=s.helperMissing,h=this.escapeExpression,p=this,u="function";c+='<div class="date">';r=t.lang;o=t.date;l=s.formatDate;r=l?l.call(t,o,r,{hash:{}}):d.call(t,"formatDate",o,r,{hash:{}});c+=h(r)+'</div>\n<div class="author">';r=t.trans;l=s.trans;r=l?l.call(t,r,{hash:{},inverse:p.noop,fn:p.program(1,a,n)}):d.call(t,"trans",r,{hash:{},inverse:p.noop,fn:p.program(1,a,n)});(r||0===r)&&(c+=r);c+='<span class="author-name">';r=t.author;r=null==r||r===!1?r:r.displayName;r=typeof r===u?r():r;c+=h(r)+'</span></div>\n<div class="body">';r=t.body;l=s.sanitize;r=l?l.call(t,r,{hash:{}}):d.call(t,"sanitize",r,{hash:{}});c+=h(r)+"</div>\n";return c});t.registerPartial("cards_feedbacks_templates_content",s);return s});
define("hbs!cards/feedbacks/templates/comment",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!cards/feedbacks/templates/content","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n,a="";a+='\n      <div class="acception-failed error"><span class="message"><span class="message-inner">';i=e.error;i=null==i||i===!1?i:i.message;i=typeof i===w?i():i;a+=y(i)+'</span></span><div class="close-me button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(2,r,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(2,r,t)});(i||0===i)&&(a+=i);a+="</div></div>\n    ";return a}function r(){return"close"}function o(e,t){var i,n,a,r="";r+="\n      ";i=e.status;n={};n.eq="Pending";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)}):I.call(e,"ifIs",i,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function l(e,t){var n,a="";a+="\n        ";n=e.commentApprovePerm;n=s["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(6,c,t)});(n||0===n)&&(a+=n);a+="\n        ";n=e;n=j.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,s,i);(n||0===n)&&(a+=n);a+="\n      ";return a}function c(e,t){var i,n,a="";a+='\n        <div id="accept-button" class="contents-top-button button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(7,d,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(7,d,t)});(i||0===i)&&(a+=i);a+="</div>\n        ";return a}function d(){return"Approve"}function h(e,t){var i,n,a,r="";r+="\n        ";i=e.status;n={};n.eq="Approved";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:j.noop,fn:j.program(10,p,t)}):I.call(e,"ifIs",i,{hash:n,inverse:j.noop,fn:j.program(10,p,t)});(i||0===i)&&(r+=i);r+="\n      ";return r}function p(e,t){var n,a="";a+='\n        <div id="approved-button" class="ok contents-top-button button button-with-undo">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';n=e.accepted;n=s["if"].call(e,n,{hash:{},inverse:j.program(14,m,t),fn:j.program(11,u,t)});(n||0===n)&&(a+=n);a+="\n          ";n=e.commentApprovePerm;n=s["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(17,g,t)});(n||0===n)&&(a+=n);a+="\n        </div>\n        ";n=e;n=j.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,s,i);(n||0===n)&&(a+=n);a+="\n        ";return a}function u(e,t){var i,n,a="";a+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(12,f,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(12,f,t)});(i||0===i)&&(a+=i);a+="\n            ";return a}function f(){return"Approved!"}function m(e,t){var i,n,a="";a+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(15,v,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(15,v,t)});(i||0===i)&&(a+=i);a+="\n            ";return a}function v(){return"Approved"}function g(){return'\n          <span id="comment-undo" class="button-undo"><span class="button-undo-inner icon-undo-arrow"></span></span>\n          </span>\n          '}s=s||e.helpers;i=i||e.partials;var b,_="",w="function",y=this.escapeExpression,j=this,I=s.helperMissing;_+='  <div class="comment-container">\n    ';b=t;b=j.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",b,s,i);(b||0===b)&&(_+=b);_+="\n    ";b=t;b=j.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",b,s,i);(b||0===b)&&(_+=b);_+="\n    ";b=t.acceptionFailed;b=s["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(1,a,n)});(b||0===b)&&(_+=b);_+="\n    ";b=t.status;b=s["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(4,o,n)});(b||0===b)&&(_+=b);_+="\n  </div>\n";return _});t.registerPartial("cards_feedbacks_templates_comment",s);return s});
define("cards/feedbacks/view/comment",["js/views/card/itemview","js/commands","hbs!cards/feedbacks/templates/comment"],function(e,t,s){return e.extend({template:s,ui:{button:"#accept-button",undo:"#comment-undo"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.fetchError=t.fetchError;if(!this.fetchError){this.collection=t.collection;this.model=t.model;this.entryModel=t.entryModel;this.commentApprovePerm=!1;var s=this.entryModel.toJSON();"Publish"===s.status&&(this.userIsSystemAdmin()||this.userHasPermission("manage_feedback")||this.userHasPermission("edit_all_posts")?this.commentApprovePerm=!0:s.author&&s.author.displayName===this.user.name&&this.userHasPermission("publish_post")&&(this.commentApprovePerm=!0))}this.loading=!1;this.setTranslation()},update:function(e){this.loading=!0;this.render();var s={status:e,success:_.bind(function(e){this.loading=!1;this.accepted=!0;this.model.set(this.model.parse(e));this.render();t.execute("card:feedbacks:reply:render")},this),error:_.bind(function(e){this.error=e.error;this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,s)},onRender:function(){this.acceptionFailed&&this.$el.find(".acception-failed .close-me").hammer().on("tap",function(){$(this).parent().remove()});this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Approved")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass($("#approved-button"),_.bind(function(){this.update("Pending")},this))},this))},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));e.accepted=this.accepted;e.acceptionFailed=this.acceptionFailed;e.error=this.error;e.commentApprovePerm=this.commentApprovePerm;return e}})});
define("hbs!cards/feedbacks/templates/entry",["hbs","handlebars","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","template/helpers/trans","template/helpers/ifIs","template/helpers/formatDate","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(){return"The comment posted"}function r(e,t){var i,n,a,r="";r+="\n    ";i=e.status;n={};n.eq="Publish";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:g.program(7,c,t),fn:g.program(4,o,t)}):v.call(e,"ifIs",i,{hash:n,inverse:g.program(7,c,t),fn:g.program(4,o,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function o(e,t){var i,n,a,r="";r+='\n      <div class="title">';a=s.title;if(a)i=a.call(e,{hash:{}});else{i=e.title;i=typeof i===f?i():i}r+=m(i)+'</div>\n      <div class="date">';i=e.lang;n=e.date;a=s.formatDate;i=a?a.call(e,n,i,{hash:{}}):v.call(e,"formatDate",n,i,{hash:{}});r+=m(i)+'</div>\n      <div class="author">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:g.noop,fn:g.program(5,l,t)}):v.call(e,"trans",i,{hash:{},inverse:g.noop,fn:g.program(5,l,t)});(i||0===i)&&(r+=i);r+='<span class="author-name">';i=e.author;i=null==i||i===!1?i:i.displayName;i=typeof i===f?i():i;r+=m(i)+'</span></div>\n      <div class="body">';i=e.body;a=s.sanitize;i=a?a.call(e,i,{hash:{}}):v.call(e,"sanitize",i,{hash:{}});r+=m(i)+"</div>\n    ";return r}function l(){return"Author"}function c(e,t){var i,n,a="";a+='\n    <div class="error">\n      <span class="message"><span class="message-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:g.noop,fn:g.program(8,d,t)}):v.call(e,"trans",i,{hash:{},inverse:g.noop,fn:g.program(8,d,t)});(i||0===i)&&(a+=i);a+="</span></span>\n    </div>\n    ";return a}function d(){return"The post is not published"}s=s||e.helpers;i=i||e.partials;var h,p,u="",f="function",m=this.escapeExpression,v=s.helperMissing,g=this;u+="<header>\n<h1>";h=t.trans;p=s.trans;h=p?p.call(t,h,{hash:{},inverse:g.noop,fn:g.program(1,a,n)}):v.call(t,"trans",h,{hash:{},inverse:g.noop,fn:g.program(1,a,n)});(h||0===h)&&(u+=h);u+='</h1>\n</header>\n  <div class="content">\n    ';h=t;h=g.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",h,s,i);(h||0===h)&&(u+=h);u+="\n    ";h=t;h=g.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",h,s,i);(h||0===h)&&(u+=h);u+="\n    ";h=t.id;h=s["if"].call(t,h,{hash:{},inverse:g.noop,fn:g.program(3,r,n)});(h||0===h)&&(u+=h);u+="\n  </div>\n";return u});t.registerPartial("cards_feedbacks_templates_entry",s);return s});
define("cards/feedbacks/view/entry",["js/views/card/itemview","hbs!cards/feedbacks/templates/entry"],function(e,t){return e.extend({template:t,initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.fetchError=t.fetchError||!1;this.fetchError||(this.model=t.entryModel);this.loading=!1;this.setTranslation()},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));return e}})});
define("js/views/card/itemview_layout",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{});return e.Layout.extend(i,{cardItemViewLayoutProto:i})});
define("js/models/entry",["backbone","js/mtapi"],function(e,t){return e.Model.extend({initialize:function(e){this.blogId=e.blogId},sync:function(e,s,i){if("read"===e){var n=$.Deferred();n.done(i.success);n.fail(i.error);t.api.getEntry(this.blogId,this.id,function(e){e.error?n.reject(e):n.resolve(e)});return n}}})});
define("js/collections/entries",["backbone","js/models/entry"],function(e,t){return e.Collection.extend({model:t,initialize:function(e){this.blogId=e}})});
define("hbs!cards/feedbacks/templates/layout",["hbs","handlebars","hbs!js/views/card/partials/loading"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,a="",r=this;a+='<section id="feedbacks-comment-view" class="card">\n  <div class="content">\n    ';n=t;n=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+='\n    <div id="comment"></div>\n    <div id="reply"></div>\n</section>\n<section id="feedbacks-comment-entry" class="card">\n  <div class="content">\n    ';n=t;n=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n  </div>\n</section>\n\n";return a});t.registerPartial("cards_feedbacks_templates_layout",s);return s});
define("hbs!cards/feedbacks/templates/reply",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n="";n+="\n";i=e.commentIsApproved;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(2,r,t)});(i||0===i)&&(n+=i);n+="\n";return n}function r(e,t){var n,a="";a+="\n  ";n=e;n=w.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=e.initial;n=s["if"].call(e,n,{hash:{},inverse:w.program(6,c,t),fn:w.program(3,o,t)});(n||0===n)&&(a+=n);a+="\n";return a}function o(e,t){var i,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div id="reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(4,l,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(4,l,t)});(i||0===i)&&(a+=i);a+="</div>\n    </div>\n  </div>\n  ";return a}function l(){return"Reply"}function c(e,t){var i,n="";n+="\n  ";i=e.replied;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(7,d,t)});(i||0===i)&&(n+=i);n+="\n  ";i=e.form;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(12,u,t)});(i||0===i)&&(n+=i);n+="\n  ";return n}function d(e,t){var i,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div id="reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(8,h,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(8,h,t)});(i||0===i)&&(a+=i);a+='</div>\n    </div>\n  </div>\n  <div id="reply-textarea-container">\n    <div id="reply-complete" class="ok contents-top-button button">\n      <span class="button-icon icon-check"></span>\n      <span id="accepted" class="button-label">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(10,p,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(10,p,t)});(i||0===i)&&(a+=i);a+="</span>\n    </div>\n    <div>";n=s.body;if(n)i=n.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}a+=I(i)+"</div>\n  </div>\n  ";return a}function h(){return"Another comment"}function p(){return"Posted comment successfully"}function u(e,t){var i,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div id="reply-disabled-button" class="button button-disabled">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(13,f,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(13,f,t)});(i||0===i)&&(a+=i);a+='</div>\n    </div>\n  </div>\n  <div id="reply-textarea-container">\n    ';i=e.error;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(15,m,t)});(i||0===i)&&(a+=i);a+='\n    <textarea id="reply-textarea">';n=s.body;if(n)i=n.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}a+=I(i)+'</textarea>\n    <div id="do-reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(18,g,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(18,g,t)});(i||0===i)&&(a+=i);a+="</div>\n  </div>\n  ";return a}function f(){return"Reply"}function m(e,t){var i,n,a="";a+='\n    <div class="error">\n      <span class="message"><span class="message-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(16,v,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(16,v,t)});(i||0===i)&&(a+=i);a+="</span></span>\n    </div>\n    ";return a}function v(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===j?t():t}return I(t)}function g(){return"Post the reply"}s=s||e.helpers;i=i||e.partials;var b,_="",w=this,y=s.helperMissing,j="function",I=this.escapeExpression;b=t.entryIsPublished;b=s["if"].call(t,b,{hash:{},inverse:w.noop,fn:w.program(1,a,n)});(b||0===b)&&(_+=b);_+="\n";return _});t.registerPartial("cards_feedbacks_templates_reply",s);return s});
define("cards/feedbacks/view/reply",["js/views/card/itemview","js/mtapi","js/commands","moment","moment.lang","cards/feedbacks/models/comments_model","hbs!cards/feedbacks/templates/reply"],function(e,t,s,i,n,a,r){return e.extend({template:r,ui:{replyButton:"#reply-button",doReplyButton:"#do-reply-button",replyTextarea:"#reply-textarea"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.blogId=t.blogId;this.commentId=t.commentId;this.model=t.model;this.collection=t.collection;this.entryModel=t.entryModel;this.initial=!0;this.loading=!1;this.setTranslation();s.setHandler("card:feedbacks:reply:render",this.render)},commentIsApproved:function(){var e=this.model.toJSON();return"Approved"===e.status},entryIsPublished:function(){var e=this.entryModel.toJSON();return"Publish"===e.status},onRender:function(){if(this.entryIsPublished()&&this.commentIsApproved()){this.ui.replyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.initial=!1;this.form=!0;this.body=!1;this.replied=!1;this.loading=!1;this.render()},this))},this));this.ui.doReplyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){var e=this.ui.replyTextarea.val(),s=this.model.toJSON();if(e.length){var n={author:this.user,entry:s.entry,blog:s.blog,parent:this.commentId,date:i().format(),body:e};this.body=e;this.loading=!0;this.render();t.api.createReplyComment(this.blogId,s.entry.id,this.commentId,n,_.bind(function(t){if(t.error){this.form=!0;this.replied=!1;this.body=e;this.loading=!1;this.error=t.error&&t.error.message?t.error.message:"request failed";this.render()}else{this.form=!1;this.replied=!0;this.body=e;this.loading=!1;var s=new a({blogId:this.blogId});s.set(t);this.collection.unshift(s);this.render()}},this))}},this))},this))}},serializeData:function(){var e=this.serializeDataInitialize();e=_.extend(e,this.model.toJSON());e.commentIsApproved=this.commentIsApproved();e.entryIsPublished=this.entryIsPublished();e.error=this.error;e.initial=this.initial;e.form=this.form;e.replied=this.replied;e.body=this.body||"";return e}})});
define("cards/feedbacks/view/layout",["js/views/card/itemview_layout","js/cache","cards/feedbacks/models/comments_collection","cards/feedbacks/models/comments_model","js/collections/entries","js/models/entry","hbs!cards/feedbacks/templates/layout","cards/feedbacks/view/comment","cards/feedbacks/view/reply","cards/feedbacks/view/entry"],function(e,t,s,i,n,a,r,o,l,c){return e.extend({template:r,regions:{comment:"#comment",reply:"#reply",entry:"#feedbacks-comment-entry"},initialize:function(n){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var a=n.routes;this.options=n;this.type=a[0];this.blogId=a[1];this.commentId=a[2];this.collection=t.get(this.blogId,"feedbacks_comments")||t.set(this.blogId,"feedbacks_comments",new s(this.blogId));this.model=this.collection.get(this.commentId);this.setTranslation(_.bind(function(){if(this.model)this.fetchEntry();else{this.render();this.model=new i({blogId:this.blogId,id:this.commentId});this.fetch()}},this))},fetch:function(){e.prototype.fetch.call(this,{successCallback:_.bind(function(){this.collection.add(this.model);this.loading=!0;this.fetchEntry()},this)})},fetchEntry:function(){var e=this.model.toJSON(),s=e.entry?e.entry.id:null;this.entryCollection=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));this.entryModel=this.entryCollection.get(s);if(this.entryModel){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.build()},this),0)}else{this.entryModel=new a({blogId:this.blogId,id:s});var i={success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.entryCollection.add(this.entryModel);this.build()},this),0)},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)};this.entryModel.fetch(i)}},build:function(){this.model.toJSON();var e=_.extend(this.options,{model:this.model,collection:this.collection,type:this.type,blogId:this.blogId,commentId:this.commentId,entryModel:this.entryModel});this.comment.show(new o(e));this.reply.show(new l(e));this.entry.show(new c(e))},onRender:function(){if(this.fetchError){this.handleRefetch();var e=_.extend(this.options,{fetchError:this.fetchError});this.comment.show(new o(e));this.entry.show(new c(e))}},serializeData:function(){var e=this.serializeDataInitialize();return e}})});
define("js/mtapi/stats_provider",["js/cache","js/mtapi"],function(e,t){return function(s){var i=$.Deferred(),n=e.get(s,"statsProvider")||null;n?i.resolve({id:n}):t.api.getStatsProvider(s,{bustCache:(new Date).valueOf()},function(t){if(t&&!t.error){e.set(s,"statsProvider",t);i.resolve(t)}else i.reject(t)});return i}});
define("cards/stats/models/latest_page_views",["backbone","moment","js/mtapi"],function(e,t,s){return e.Model.extend({isSynced:!1,initialize:function(e){this.blogId=e},sync:function(e,i,n){if("read"===e){var a=$.Deferred(),r=$.Deferred(),o={startDate:t().subtract("days",6).format(),endDate:t().format()};s.api.listStatsPageviewsForDate(this.blogId,o,_.bind(function(e){e.error?a.reject(e):a.resolve(e)},this));s.api.listStatsVisitsForDate(this.blogId,o,_.bind(function(e){if(e.error)r.reject(e);else{this.isSynced=!0;r.resolve(e)}},this));$.when(a,r).then(_.bind(function(e,t){this.isSynced=!0;n.success({pageviews:e,visits:t},n)},this),n.error);return[a,r]}}})});
define("hbs!cards/stats/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","template/helpers/formatDate","template/helpers/todaysPageViews"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e){var t,i,n,a="";a+='<div class="today">';t=e.lang;i=e.today;n=s.formatDate;t=n?n.call(e,i,t,{hash:{}}):d.call(e,"formatDate",i,t,{hash:{}});a+=h(t)+"</div>";return a}function r(e,t){var i,n="";n+="\n    ";i=e.pageviews;i=null==i||i===!1?i:i.items;i=s["if"].call(e,i,{hash:{},inverse:u.noop,fn:u.program(4,o,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function o(e){var t,i,n="";n+='\n    <div class="todays-pageviews">';t=e.pageviews;t=null==t||t===!1?t:t.items;i=s.todaysPageViews;t=i?i.call(e,t,{hash:{}}):d.call(e,"todaysPageViews",t,{hash:{}});n+=h(t)+'\n      <span class="diff-icon ';i=s.diffIcon;if(i)t=i.call(e,{hash:{}});else{t=e.diffIcon;t=typeof t===p?t():t}n+=h(t)+'"></span>\n    </div>\n    ';return n}s=s||e.helpers;i=i||e.partials;var l,c="",d=s.helperMissing,h=this.escapeExpression,p="function",u=this;l=t;l=u.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",l,s,i);(l||0===l)&&(c+=l);c+='\n<div class="content">\n  ';l=t;l=u.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t.today;l=s["if"].call(t,l,{hash:{},inverse:u.noop,fn:u.program(1,a,n)});(l||0===l)&&(c+=l);c+="\n\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(c+=l);c+='\n\n  <div class="stats-dashboard-graph-container">\n    ';l=t.pageviews;l=s["if"].call(t,l,{hash:{},inverse:u.noop,fn:u.program(3,r,n)});(l||0===l)&&(c+=l);c+='\n    <div id="stats-dashboard-graph"></div>\n  </div>\n</div>\n';return c});t.registerPartial("cards_stats_templates_dashboard",s);return s});
define("cards/stats/dashboard/dashboard",["js/cache","js/commands","js/device","js/mtapi/stats_provider","js/views/card/itemview","cards/stats/models/latest_page_views","hbs!cards/stats/templates/dashboard","mtchart"],function(e,t,s,i,n,a,r,o){return n.extend({template:r,serializeData:function(){var e=this.serializeDataInitialize();e.title="Today's page views";if(!this.loading){e=_.extend({},e,this.model.toJSON());if(e.pageviews&&e.pageviews.items){var t=e.pageviews.items.length;if(t>1){var s=parseInt(e.pageviews.items[t-2].pageviews,10),i=parseInt(e.pageviews.items[t-1].pageviews,10);this.diff=i-s;e.diffIcon=this.diff<0?"icon-arrow-down-right":this.diff>0?"icon-arrow-up-right":"icon-arrow-right"}}e.today=(new Date).valueOf()}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e},fetch:function(){n.prototype.fetch.call(this,{successCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")},this),errorCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).off("tap",this.navigatePage);this.$el.removeClass("tap-enabled")},this)})},navigatePage:function(){t.execute("router:navigate","stats")},initialize:function(){n.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=e.get(this.blogId,"stats_latest_page_views")||e.set(this.blogId,"stats_latest_page_views",new a(this.blogId));this.setTranslation();if(this.model.isSynced){this.loading=!1;this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")}else{var t=_.isFunction(i)?i(this.blogId):i;t.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));t.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},onRender:function(){this.handleRefetch();if(this.model.isSynced){for(var e,t,i=this.model.toJSON(),n=i.pageviews.items,a=i.visits.items,r=[],l=0,c=n.length;c>l;l++){e=n[l];t=a[l];r.push({x:e.date,y:t.visits,y1:e.pageviews})}console.log(r);var d={type:"easel.mix",data:r,yLength:2,mix:[{type:"bar",yLength:1,chartColors:["#cccccc"],chartColorsAlpha:[.5]},{type:"motionLine",yLength:1,lineWidth:8,chartColors:["#55a038"],drawPointer:s.isAndroid?!1:!0,pointerColors:["#ea4b29"]}],fallback:{test:"canvas",type:"morris.bar",data:r,yLength:1,chartColors:["#55a038"],gridLineColor:"#f3f3f5",gridTextColor:"#f3f3f5",hideHover:"always"},height:170},h={length:7,unit:"daily"};new o.Graph(d,h).trigger("APPEND_TO",this.$el.find("#stats-dashboard-graph"))}}})});
define("cards/stats/models/top_articles",["backbone","js/mtapi","moment"],function(e,t){return e.Model.extend({isSynced:!1,sync:function(e,s,i){if("read"===e){var n=$.Deferred(),a={startDate:i.startDate,endDate:i.endDate,limit:i.limit};i.path&&(a.path=i.path);n.done(i.success);n.fail(i.error);t.api.listStatsPageviewsForPath(i.blogId,a,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}}})});
define("cards/stats/models/top_articles_itemview",["backbone","js/cache","js/mtapi","js/models/entry","js/collections/entries"],function(e,t,s,i,n){return e.Model.extend({initialize:function(e){this.blogId=e.blogId;this.num=e.num;this.pageviews=e.pageviews;this.unit=e.unit},sync:function(e,s,a){if("read"===e){var r=$.Deferred();r.done(a.success);r.fail(a.error);var o=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));if(o.get(this.id))r.resolve(o.get(this.id).toJSON());else{var l=new i({id:this.id,blogId:this.blogId});l.fetch({success:function(){o.add(l);r.resolve(l.toJSON())},error:function(){r.reject(l.toJSON())}})}return r}}})});
define("cards/stats/models/top_articles_itemview_collection",["backbone","js/mtapi","cards/stats/models/top_articles_itemview"],function(e,t,s){return e.Collection.extend({model:s,comparator:function(e){return-1*parseInt(e.get("pageviews"),10)}})});
define("hbs!cards/stats/templates/layout",["hbs","handlebars"],function(e,t){var s=t.template(function(e,t,s){s=s||e.helpers;return'<section id="recent-access" class="card"></section>\n<section id="top-articles" class="top-articles card">\n</section>\n<section id="top-articles-weekly" class="top-articles card">\n</section>\n'});t.registerPartial("cards_stats_templates_layout",s);return s});
define("hbs!cards/stats/templates/recent_access",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,a="",r=this;n=t;n=r.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(a+=n);a+='\n<div class="content">\n  ';n=t;n=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",n,s,i);(n||0===n)&&(a+=n);a+="\n</div>\n";return a});t.registerPartial("cards_stats_templates_recent_access",s);return s});
define("cards/stats/view/recent_access",["js/views/card/itemview","js/cache","js/commands","js/device","js/mtapi/stats_provider","cards/stats/models/latest_page_views","js/trans","hbs!cards/stats/templates/recent_access","mtchart"],function(e,t,s,i,n,a,r,o,l){return e.extend({template:o,serializeData:function(){var e=this.serializeDataInitialize();e.title="Access in last week";this.loading||(e=_.extend(e,this.model.toJSON()));e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=t.get(this.blogId,"stats_latest_page_views")||t.set(this.blogId,"stats_latest_page_views",new a(this.blogId));this.setTranslation();if(this.model.isSynced)this.loading=!1;else{var s=_.isFunction(n)?n(this.blogId):n;s.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));s.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},onRender:function(){this.handleRefetch();if(this.model.isSynced){var e=this.$el.find(".content"),t=this.model.toJSON().pageviews.items,s=_.map(t,function(e){return{x:e.date,y:e.pageviews}}),i=_.map(t,function(e){var t=e.pageviews;e.pageviews>=1e6?t=Math.round(e.pageviews/1e6)+"M":e.pageviews>=1e3&&(t=Math.round(e.pageviews/1e3)+"K");return t}),n={type:"css.horizontalBar",data:s,yLength:1,yLabel:i,autoSized:!1,pointSize:6,barColor:"#efb330",barBackgroundColor:"#362c35",dateColor:"#444444",dateColorSaturday:"#4079e6",dateColorSunday:"#ec4b05",dateLabelSize:16,labelSize:22,labelColor:"#ffffff",showDate:!0,barWidth:40,barMarginLeft:35,barInterval:10},a={dataType:"timeline",unit:"daily",length:7};new l.Graph(n,a).trigger("APPEND_TO",e)}}})});
define("hbs!cards/stats/templates/itemviewContent",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n,a="";a+="\n    ";i=e.assets;n=s.eachOnly;i=n?n.call(e,i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)}):f.call(e,"eachOnly",i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)});(i||0===i)&&(a+=i);a+="\n  ";return a}function r(e){var t,i,n="";n+='\n    <div class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+') no-repeat center center / cover"><div class="circle-inner"></div></div>\n    ';return n}function o(){return'\n    <div class="item-asset no-image circle"><div class="circle-inner"></div></div>\n  '}s=s||e.helpers;var l,c,d="",h="function",p=this.escapeExpression,u=this,f=s.helperMissing;d+='<div class="item-num">';l=t.num;l=typeof l===h?l():l;d+=p(l)+'</div>\n<div class="item-content">\n  ';l=t.assets;l=null==l||l===!1?l:l.length;l=s["if"].call(t,l,{hash:{},inverse:u.program(4,o,n),fn:u.program(1,a,n)});(l||0===l)&&(d+=l);d+='\n  <div class="item-title">';c=s.title;if(c)l=c.call(t,{hash:{}});else{l=t.title;l=typeof l===h?l():l}d+=p(l)+'</div>\n</div>\n<div class="item-pageviews">';l=t.pageviews;l=typeof l===h?l():l;d+=p(l)+"</div>\n";return d});t.registerPartial("cards_stats_templates_itemviewContent",s);return s});
define("hbs!cards/stats/templates/top_articles_itemview",["hbs","handlebars","hbs!cards/stats/templates/itemviewContent"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,a,r="",o="function",l=this.escapeExpression,c=this;r+='<a data-route="stats/';a=s.blogId;if(a)n=a.call(t,{hash:{}});else{n=t.blogId;n=typeof n===o?n():n}r+=l(n)+"/";a=s.id;if(a)n=a.call(t,{hash:{}});else{n=t.id;n=typeof n===o?n():n}r+=l(n)+"/";a=s.unit;if(a)n=a.call(t,{hash:{}});else{n=t.unit;n=typeof n===o?n():n}r+=l(n)+'">\n  ';n=t;n=c.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",n,s,i);(n||0===n)&&(r+=n);r+='\n<div class="item-arrow icon-arrow"></div>\n</a>\n';return r});t.registerPartial("cards_stats_templates_top_articles_itemview",s);return s});
define("cards/stats/view/top_articles_itemview",["backbone.marionette","cards/stats/models/top_articles_itemview","hbs!cards/stats/templates/top_articles_itemview"],function(e,t,s){return e.ItemView.extend({template:s})});
define("hbs!cards/stats/templates/top_articles",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","hbs!js/views/card/partials/noItem","hbs!cards/stats/templates/itemviewContent","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e){var t,i;i=s.title;if(i)t=i.call(e,{hash:{}});else{t=e.title;t=typeof t===h?t():t}return t||0===t?t:""}function r(e){var t,n="";n+='\n    <li id="eid-';t=e.entry;t=null==t||t===!1?t:t.id;t=typeof t===h?t():t;n+=p(t)+'" data-pageviews="';t=e.pageviews;t=typeof t===h?t():t;n+=p(t)+'">\n      <div class="list-item-inner">\n        <div class="content-loading"></div>\n        ';t=e;t=u.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",t,s,i);(t||0===t)&&(n+=t);n+="\n      </div>\n    </li>\n  ";return n}function o(){return'\n  <div class="item-loading"></div>\n  '}s=s||e.helpers;i=i||e.partials;var l,c,d="",h="function",p=this.escapeExpression,u=this,f=s.helperMissing;d+='<header>\n<h1 id="';c=s.name;if(c)l=c.call(t,{hash:{}});else{l=t.name;l=typeof l===h?l():l}d+=p(l)+'-title">';l=t.trans;c=s.trans;l=c?c.call(t,l,{hash:{},inverse:u.noop,fn:u.program(1,a,n)}):f.call(t,"trans",l,{hash:{},inverse:u.noop,fn:u.program(1,a,n)});(l||0===l)&&(d+=l);d+='</h1>\n</header>\n<div class="content">\n  ';l=t;l=u.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(d+=l);d+="\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(d+=l);d+="\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(d+=l);d+="\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",l,s,i);(l||0===l)&&(d+=l);d+='\n  <ul id="top-articles-list-';c=s.unit;if(c)l=c.call(t,{hash:{}});else{l=t.unit;l=typeof l===h?l():l}d+=p(l)+'" class="card-item-list top-articles-list">\n  ';l=t.items;l=s.each.call(t,l,{hash:{},inverse:u.noop,fn:u.program(3,r,n)});(l||0===l)&&(d+=l);d+="\n  </ul>\n  ";l=t.itemLoading;l=s["if"].call(t,l,{hash:{},inverse:u.noop,fn:u.program(5,o,n)});(l||0===l)&&(d+=l);d+="\n</div>\n";return d});t.registerPartial("cards_stats_templates_top_articles",s);return s});
define("cards/stats/view/top_articles",["js/views/card/composite","js/cache","js/commands","js/device","moment","moment.lang","js/mtapi/stats_provider","cards/stats/models/top_articles","cards/stats/models/top_articles_itemview_collection","cards/stats/models/top_articles_itemview","cards/stats/view/top_articles_itemview","hbs!cards/stats/templates/top_articles"],function(e,t,s,i,n,a,r,o,l,c,d,h){return e.extend({numberOfArticles:3,template:h,itemView:d,itemViewContainer:"#top-articles-list-day",appendHtml:function(e,t){this.getItemViewContainer(e).find("#eid-"+t.model.id).html(t.el)},serializeData:function(){var e=this.serializeDataInitialize(),t=[];if(!this.loading){e=_.extend(e,this.model.toJSON());if(e.items&&e.items.length){var s=this.numberOfArticles,i=_.filter(e.items,function(e){return e.entry&&e.entry.id})||[];e.count=i.length;_.each(i,function(e){var i=e.entry?e.entry.id:null;if(s&&i){s-=1;var n=this.numberOfArticles-s;e.num=n;t.push(e);var a=this.collection.get(i);this.dfd.done(_.bind(function(){if(!a){a=new c({id:i,blogId:this.blogId,num:n,pageviews:e.pageviews,unit:this.unit});a.fetch({success:_.bind(function(){this.collection.add(a,{sort:!0})},this),error:_.bind(function(){a.set({title:e.title});this.collection.add(a,{sort:!0})},this)})}},this))}},this);e.items=t}}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;e.itemLoading=this.itemLoading?!0:!1;e.title="Top 3 of the "+this.unit;e.unit=this.unit;return e},fetch:function(){this.model.fetch({blogId:this.blogId,startDate:moment().startOf(this.unit).format(),endDate:moment().endOf(this.unit).format(),limit:10,success:_.bind(function(){this.loading=!1;this.error=!1;this.itemLoading=!0;this.render()},this),error:_.bind(function(){this.loading=!1;this.error=!0;this.render()},this)})},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.unit=s.unit||"day";this.model=t.get(this.blogId,"toparticle_"+this.unit+"_model")||t.set(this.blogId,"toparticle_"+this.unit+"_model",new o);this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new l);this.setTranslation();this.dfd=$.Deferred();if(this.model.isSynced){this.loading=!1;this.render()}else{var i=_.isFunction(r)?r(this.blogId):r;i.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));i.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}this.handleItemViewNavigate()},onRender:function(){this.handleRefetch();!this.loading&&this.itemLoading&&this.dfd.resolve()}})});
define("cards/stats/view/top_articles_weekly",["cards/stats/view/top_articles"],function(e){return e.extend({itemViewContainer:"#top-articles-list-week"})});
define("cards/stats/view/layout",["backbone.marionette","js/commands","hbs!cards/stats/templates/layout","cards/stats/view/recent_access","cards/stats/view/top_articles","cards/stats/view/top_articles_weekly"],function(e,t,s,i,n,a){return e.Layout.extend({template:s,regions:{recentAccess:"#recent-access",topArticles:"#top-articles",topArticlesWeekly:"#top-articles-weekly"},initialize:function(e){this.options=e},onRender:function(){this.recentAccess.show(new i(this.options));this.topArticles.show(new n(_.extend(this.options,{unit:"day"})));this.topArticlesWeekly.show(new a(_.extend(this.options,{unit:"week"})))}})});
define("hbs!cards/stats/templates/post",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/ifIs","template/helpers/trans","template/helpers/formatDate","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n,a,o="";o+="\n    ";i=e.status;n={};n.eq="Publish";a=s.ifIs;i=a?a.call(e,i,{hash:n,inverse:m.noop,fn:m.program(2,r,t)}):v.call(e,"ifIs",i,{hash:n,inverse:m.noop,fn:m.program(2,r,t)});(i||0===i)&&(o+=i);o+="\n  ";return o}function r(e,t){var i,n,a,r="";r+='\n    <div class="pageviews">\n      <span class="label">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:m.noop,fn:m.program(3,o,t)}):v.call(e,"trans",i,{hash:{},inverse:m.noop,fn:m.program(3,o,t)});(i||0===i)&&(r+=i);r+='</span>\n      <span class="pageview">';a=s.pageviews;if(a)i=a.call(e,{hash:{}});else{i=e.pageviews;i=typeof i===u?i():i}r+=f(i)+'</span>\n    </div>\n    <div class="title">';a=s.title;if(a)i=a.call(e,{hash:{}});else{i=e.title;i=typeof i===u?i():i}r+=f(i)+'</div>\n    <div class="date">';i=e.lang;n=e.date;a=s.formatDate;i=a?a.call(e,n,i,{hash:{}}):v.call(e,"formatDate",n,i,{hash:{}});r+=f(i)+'</div>\n    <div class="author">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:m.noop,fn:m.program(5,l,t)}):v.call(e,"trans",i,{hash:{},inverse:m.noop,fn:m.program(5,l,t)});(i||0===i)&&(r+=i);r+='<span class="author-name">';i=e.author;i=null==i||i===!1?i:i.displayName;i=typeof i===u?i():i;r+=f(i)+'</span></div>\n    <div class="body">';i=e.body;a=s.sanitize;i=a?a.call(e,i,{hash:{}}):v.call(e,"sanitize",i,{hash:{}});r+=f(i)+"</div>\n    ";return r}function o(e){var t,i;i=s.label;if(i)t=i.call(e,{hash:{}});else{t=e.label;t=typeof t===u?t():t}return f(t)}function l(){return"Author"}function c(e,t){var i,n="";n+="\n    ";i=e.error;i=s["if"].call(e,i,{hash:{},inverse:m.noop,fn:m.program(8,d,t)});(i||0===i)&&(n+=i);n+="\n  ";return n}function d(){return'\n      <div class="error-message">\n        記事の情報を取得できませんでした。\n      </div>\n    '}s=s||e.helpers;i=i||e.partials;var h,p="",u="function",f=this.escapeExpression,m=this,v=s.helperMissing;p+='<section id="stats-post" class="card">\n  <div class="content">\n  ';h=t;h=m.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",h,s,i);(h||0===h)&&(p+=h);p+="\n  ";h=t.id;h=s["if"].call(t,h,{hash:{},inverse:m.program(7,c,n),fn:m.program(1,a,n)});(h||0===h)&&(p+=h);p+="\n  </div>\n</section>\n";return p});t.registerPartial("cards_stats_templates_post",s);return s});
define("cards/stats/view/post",["js/views/card/itemview","js/cache","js/commands","js/device","moment","moment.lang","js/mtapi/stats_provider","cards/stats/models/top_articles_itemview","cards/stats/models/top_articles_itemview_collection","js/trans","hbs!cards/stats/templates/post","cards/stats/models/top_articles"],function(e,t,s,i,n,a,r,o,l,c,d,h){return e.extend({template:d,initialize:function(i){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var a=i.routes;this.blogId=a[0];this.entryId=a[1];this.unit=a[2];this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new l);this.model=this.collection.get(this.entryId)||null;this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.model=new o({id:this.entryId,blogId:this.blogId});this.model.fetch({success:_.bind(function(){var e,t=this.model.toJSON().permalink||null;if(t){t=t.match(/http(?:s)?:\/\/[^\/]+\/(.*)/);e=t.length>1?t[1]:null}if(e){this.statsModel=new h;this.statsModel.fetch({blogId:this.blogId,startDate:n().startOf(this.unit).format(),endDate:n().endOf(this.unit).format(),limit:1,path:e,success:_.bind(function(e){this.loading=!1;this.error=!1;this.pageviews=e.toJSON().items[0]?e.toJSON().items[0].pageviews:0;this.render()},this),error:_.bind(function(){this.loading=!1;this.error=!0;this.render()},this)})}},this),error:_.bind(function(){this.error=!0;this.loading=!1;this.render()},this)})}},this));s.setHandler("card:stats:share:show",_.bind(function(){var e=this.serializeData();s.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))},serializeData:function(){var e=this.serializeDataInitialize();if(this.model){e=_.extend(e,this.model.toJSON());s.execute("header:render",e)}var t={day:"Today's",week:"This week's",month:"This month's",year:"This year's"};e.label=t[this.unit]+" access";void 0===e.pageviews&&(e.pageviews=this.pageviews);return e}})});
define("cards/stats/view/post_header",["backbone.marionette","js/views/card/header","js/device","js/commands"],function(e,t){return t.extend({backButtonRoute:function(){return this.card.id},serializeData:function(){var e=t.prototype.serializeData.apply(this);if(this.object){e.post=this.object||{};e.shareEnabled="Publish"===e.post.status}return e}})});
define("hbs!cards/upload/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/title","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n="";n+="\n";i=e.FileUploadSupport;i=s["if"].call(e,i,{hash:{},inverse:D.noop,fn:D.program(2,r,t)});(i||0===i)&&(n+=i);n+="\n";return n}function r(e,t){var n,a="";a+="\n";n=e;n=D.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(a+=n);a+="\n";n=e;n=D.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(a+=n);a+='\n\n<form id="upload-file-form" method="post" name="upload-file">\n<div class="contents">\n';n=e.uploadedImages;n=s.each.call(e,n,{hash:{},inverse:D.noop,fn:D.program(3,o,t)});(n||0===n)&&(a+=n);a+="\n";n=e.uploadError;n=null==n||n===!1?n:n.length;n=s["if"].call(e,n,{hash:{},inverse:D.noop,fn:D.program(5,l,t)});(n||0===n)&&(a+=n);a+="\n";n=e.uploadError;n=null==n||n===!1?n:n.length;n=s.unless.call(e,n,{hash:{},inverse:D.noop,fn:D.program(14,f,t)});(n||0===n)&&(a+=n);a+='\n<div class="upload-file-input-container">\n  <input type="file" id="upload-file-input" accept="image/*"/>\n</div>\n<div id="upload-file" class="button">\n  ';n=e.isLabelNeeded;n=s["if"].call(e,n,{hash:{},inverse:D.noop,fn:D.program(17,v,t)});(n||0===n)&&(a+=n);a+='\n  <span class="upload-file-input-inner">\n    ';n=e.uploadCompleted;n=s["if"].call(e,n,{hash:{},inverse:D.program(22,_,t),fn:D.program(19,g,t)});(n||0===n)&&(a+=n);a+="\n  </span>\n  ";n=e.isLabelNeeded;n=s["if"].call(e,n,{hash:{},inverse:D.noop,fn:D.program(29,k,t)});(n||0===n)&&(a+=n);a+='\n</div>\n<div id="upload-file-uploading" class="upload-file button button-disabled"></div>\n</div>\n</form>\n';return a}function o(e){var t,s="";s+='\n<div class="uploaded-image">\n  <img src="';t=e.url;t=typeof t===C?t():t;s+=z(t)+'">\n</div>\n';return s}function l(e,t){var i,n,a="";a+='\n<div class="error">\n  <div class="upload-image icon-upload-fail"></div>\n  <div class="message"><div class="message-inner">\n  <p class="error-heading">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:D.noop,fn:D.program(6,c,t)}):S.call(e,"trans",i,{hash:{},inverse:D.noop,fn:D.program(6,c,t)});(i||0===i)&&(a+=i);a+="</p>\n  ";i=e.uploadError;i=s.each.call(e,i,{hash:{},inverse:D.noop,fn:D.program(8,d,t)});(i||0===i)&&(a+=i);a+="\n  </div></div>\n</div>\n";i=e.supportedFileAPI;i=s["if"].call(e,i,{hash:{},inverse:D.noop,fn:D.program(11,p,t)});(i||0===i)&&(a+=i);a+="\n";return a}function c(){return"Failed uploading"}function d(e,t){var i,n="";n+="\n  <p>";i=s["if"].call(e,e,{hash:{},inverse:D.noop,fn:D.program(9,h,t)});(i||0===i)&&(n+=i);n+="</p>\n  ";return n}function h(e){var t;t=e.message;t=typeof t===C?t():t;return z(t)}function p(e,t){var i,n,a="";a+='\n<div id="retry" class="upload-file button">\n    ';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:D.noop,fn:D.program(12,u,t)}):S.call(e,"trans",i,{hash:{},inverse:D.noop,fn:D.program(12,u,t)});(i||0===i)&&(a+=i);a+="\n</div>\n";return a}function u(){return"retry"}function f(e,t){var i,n="";n+="\n";i=e.uploadedImages;i=null==i||i===!1?i:i.length;i=s.unless.call(e,i,{hash:{},inverse:D.noop,fn:D.program(15,m,t)});(i||0===i)&&(n+=i);n+="\n";return n}function m(){return'\n<div class="upload-image icon-upload"></div>\n'}function v(){return'\n  <label for="upload-file-input">\n  '}function g(e,t){var i,n,a="";a+="\n      ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:D.noop,fn:D.program(20,b,t)}):S.call(e,"trans",i,{hash:{},inverse:D.noop,fn:D.program(20,b,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function b(){return"more upload"}function _(e,t){var i,n="";n+="\n      ";i=e.error;i=s["if"].call(e,i,{hash:{},inverse:D.program(26,j,t),fn:D.program(23,w,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function w(e,t){var i,n,a="";a+="\n        ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:D.noop,fn:D.program(24,y,t)}):S.call(e,"trans",i,{hash:{},inverse:D.noop,fn:D.program(24,y,t)});(i||0===i)&&(a+=i);a+="\n      ";return a}function y(){return"choose another files"}function j(e,t){var i,n,a="";a+="\n        ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:D.noop,fn:D.program(27,I,t)}):S.call(e,"trans",i,{hash:{},inverse:D.noop,fn:D.program(27,I,t)});(i||0===i)&&(a+=i);a+="\n      ";return a}function I(){return"choose files"}function k(){return"\n  </label>\n  "}s=s||e.helpers;i=i||e.partials;var x,P="",C="function",z=this.escapeExpression,D=this,S=s.helperMissing;x=t.perm;x=s["if"].call(t,x,{hash:{},inverse:D.noop,fn:D.program(1,a,n)});(x||0===x)&&(P+=x);P+="\n";return P});t.registerPartial("cards_upload_templates_dashboard",s);return s});
define("cards/upload/dashboard/dashboard",["js/mtapi","js/device","js/commands","js/views/card/itemview","hbs!cards/upload/templates/dashboard"],function(e,t,s,i,n){return i.extend({template:n,ui:{uploadForm:"#upload-file-input",uploadButton:"#upload-file",retryButton:"#retry",refreshButton:"#refresh"},initialize:function(){i.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userIsSystemAdmin()||this.userHasPermission("upload");this.FileUploadSupport=this.checkSupport();this.supportedFileAPI=this.checkFileAPISupport();this.isLabelNeeded=this.checkNeedLabel();this.dashboardShowWithPermission(this.perm&&this.FileUploadSupport).done(_.bind(function(){this.setTranslation()},this))},onRender:function(){if(this.perm){this.FileInputNotSupported&&this.$el.parent().hide();var t=_.bind(function(t,s){if(this.ui.uploadForm.val()||s){this.uploadedImages=[];this.uploadError=[];this.errorImages=[];this.uploading=!0;this.$el.addClass("now-uploading");var i=[];_.each(t,_.bind(function(t){var s=$.Deferred();i.push(s);e.api.uploadAsset(this.blogId,{file:t,autoRenameIfExists:!0,bustCache:(new Date).valueOf()},_.bind(function(e){if(e.error){this.errorImages.push(t);this.uploadError.push(e.error);s.reject()}else{s.resolve();this.uploadedImages.push(e)}this.render()},this))},this));$.when.apply(this,i).done(_.bind(function(){this.uploadError=[];this.uploadCompleted=!0},this)).always(_.bind(function(){this.$el.removeClass("now-uploading");this.uploading=!1;this.render()},this))}},this);this.ui.uploadButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.isLabelNeeded||this.ui.uploadForm.click()},this))},this));this.ui.retryButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.ui.retryButton.remove();t(this.errorImages,!0)},this))},this));this.ui.uploadForm.on("change",function(e){this.supportedFileAPI?t(e.target.files):t([$("#upload-file-input").get(0)])})}},checkSupport:function(){return t.isIOS&&t.version&&t.version<6||t.isWindowsPhone?!1:!0},checkFileAPISupport:function(){return window.FileReader&&"windows-phone"!==t.platform?!0:!1},checkNeedLabel:function(){return t.isIE&&parseInt(t.browserVersion,10)<10?!0:!1},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.title="Media Upload";e.FileUploadSupport=this.FileUploadSupport;e.loading=!1;e.uploadError=this.uploadError||[];e.uploading=this.uploading?!0:!1;e.uploadCompleted=this.uploadCompleted?!0:!1;e.uploadedImages=this.uploadedImages;e.supportedFileAPI=this.supportedFileAPI;e.isLabelNeeded=this.isLabelNeeded}e.perm=this.perm;e.trans=this.trans;return e}})});
define("hbs!cards/stats/templates/top_articles_itemview_content",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,n){function a(e,t){var i,n,a="";a+="\n    ";i=e.assets;n=s.eachOnly;i=n?n.call(e,i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)}):f.call(e,"eachOnly",i,0,{hash:{},inverse:u.noop,fn:u.program(2,r,t)});(i||0===i)&&(a+=i);a+="\n  ";return a}function r(e){var t,i,n="";n+='\n    <div class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===h?t():t}n+=p(t)+') no-repeat center center / cover"><div class="circle-inner"></div></div>\n    ';return n}function o(){return'\n    <div class="item-asset no-image circle"><div class="circle-inner"></div></div>\n  '}s=s||e.helpers;var l,c,d="",h="function",p=this.escapeExpression,u=this,f=s.helperMissing;d+='<div class="item-num">';l=t.num;l=typeof l===h?l():l;d+=p(l)+'</div>\n<div class="item-content">\n  ';l=t.assets;l=null==l||l===!1?l:l.length;l=s["if"].call(t,l,{hash:{},inverse:u.program(4,o,n),fn:u.program(1,a,n)});(l||0===l)&&(d+=l);d+='\n  <div class="item-title">';c=s.title;if(c)l=c.call(t,{hash:{}});else{l=t.title;l=typeof l===h?l():l}d+=p(l)+'</div>\n</div>\n<div class="item-pageviews">';l=t.pageviews;l=typeof l===h?l():l;d+=p(l)+"</div>\n";return d});t.registerPartial("cards_stats_templates_top_articles_itemview_content",s);return s});
define("json!cards/cards.json",function(){return[{name:"stats",id:"stats",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout"},{id:"post",route:":blog_id/:id/:unit",view:"view/post",header:"view/post_header"}]},{name:"acception",id:"acception",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",route:":blog_id/:id",view:"view/view",header:"view/view_header"}]},{name:"upload",id:"upload",dashboard:{view:"dashboard/dashboard"}},{name:"feedbacks",id:"feedbacks",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout",route:":type/:blog_id/:id"}]}]});