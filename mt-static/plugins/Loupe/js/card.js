define("js/views/card/composite",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{appendHtml:function(e,t){if(!this.loading){var s=this.getItemViewContainer(e);s.append(t.el)}},handleReadmore:function(e){this.$el.find(".readmore").hammer(this.hammerOpts).on("tap",_.bind(function(t){this.addTapClass(t.currentTarget,_.bind(function(){this.loadingReadmore=!0;this.render();this.fetch(e)},this))},this))},handleItemViewNavigate:function(){this.$el.hammer(this.hammerOpts).on("tap","a",_.bind(function(e){e.preventDefault();e.stopPropagation();var s=$(e.currentTarget).data("route")||null;s&&this.addTapClass(e.currentTarget,function(){t.execute("router:navigate",s)});return!1},this))},fetch:function(e){e=e||{};var t={merge:!0,remove:!1,sort:!0,success:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!1;this.fetchErrorOption=null;e.successCallback&&e.successCallback();this.render()},this),error:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!0;this.fetchErrorOption=e;e.errorCallback&&e.errorCallback();this.render()},this)};t=_.extend(t,e);this.collection.fetch(t)}});return e.CompositeView.extend(i,{cardCompositeViewProto:i})});
define("cards/acception/models/model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,s,i){var n=$.Deferred(),r=i.blogId,a=function(e){e.error?n.reject(e):n.resolve(e)};n.done(i.success);n.fail(i.error);if("read"===e)t.api.getEntry(r,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},a);else if("update"===e){var o=s.toJSON();o.status=i.status||o.status;t.api.updateEntry(r,this.id,o,a)}return n}})});
define("cards/acception/models/collection",["backbone","moment","js/mtapi","cards/acception/models/model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e;this.isSynced=!1},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var n=$.Deferred();n.done(i.success);n.fail(i.error);var r={status:"Review"};i.limit&&(r.limit=parseInt(i.limit,10));i.offset&&(r.offset=parseInt(i.offset,10));s.api.listEntries(this.blogId,r,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("template/helpers/eachOnly",["handlebars"],function(e){function t(e,t,s){var i,n="";i=0>t?e[e.length-t]:e[t];i&&(n=s.fn?s.fn(i):i);return n}e.registerHelper("eachOnly",t);return t});
define("hbs!cards/acception/templates/dashboardItemview",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e){var t,s="";s+='data-route="acception/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===u?t():t;s+=p(t)+"/";t=e.id;t=typeof t===u?t():t;s+=p(t)+'"';return s}function a(e,t){var i,n,r="";r+="\n      ";i=e.assets;n=s.eachOnly;i=n?n.call(e,i,0,{hash:{},inverse:f.noop,fn:f.program(4,o,t)}):m.call(e,"eachOnly",i,0,{hash:{},inverse:f.noop,fn:f.program(4,o,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function o(e){var t,i,n="";n+='\n      <span class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+') no-repeat center center / cover"><span class="circle-inner"></span></span>\n      ';return n}function l(){return'\n      <span class="item-asset no-image circle"><span class="circle-inner"></span></span>\n    '}s=s||e.helpers;var c,d,h="",u="function",p=this.escapeExpression,f=this,m=s.helperMissing;h+="<a ";c=t.id;c=s["if"].call(t,c,{hash:{},inverse:f.noop,fn:f.program(1,r,n)});(c||0===c)&&(h+=c);h+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=s["if"].call(t,c,{hash:{},inverse:f.program(6,l,n),fn:f.program(3,a,n)});(c||0===c)&&(h+=c);h+='\n    </span>\n    <span class="item-title">';d=s.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===u?c():c}h+=p(c)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return h});t.registerPartial("cards_acception_templates_dashboardItemview",s);return s});
define("cards/acception/dashboard/itemview",["backbone.marionette","hbs!cards/acception/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("hbs!cards/acception/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/noItem","hbs!cards/acception/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var n,r="";r+="\n";n=e;n=p.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(r+=n);r+='\n<div class="content content-list">\n  ';n=e;n=p.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(r+=n);r+="\n  ";n=e;n=p.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n  ";n=e;n=p.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",n,s,i);(n||0===n)&&(r+=n);r+='\n  <ul id="acceptions-list" class="card-item-list" ';n=e.fetchError;n=s["if"].call(e,n,{hash:{},inverse:p.noop,fn:p.program(2,a,t)});(n||0===n)&&(r+=n);r+=">\n    ";n=e.fetchError;n=s.unless.call(e,n,{hash:{},inverse:p.noop,fn:p.program(4,o,t)});(n||0===n)&&(r+=n);r+="\n  </ul>\n  ";n=e;n=p.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",n,s,i);(n||0===n)&&(r+=n);r+="\n</div>\n";return r}function a(){return'style="display:none"'}function o(e,t){var i;i=e.loading;i=s.unless.call(e,i,{hash:{},inverse:p.noop,fn:p.program(5,l,t)});return i||0===i?i:""}function l(e,t){var i;i=e.count;i=s.unless.call(e,i,{hash:{},inverse:p.noop,fn:p.program(6,c,t)});return i||0===i?i:""}function c(e,t){var i,n="";n+="\n      ";i=e.items;i=s.each.call(e,i,{hash:{},inverse:p.noop,fn:p.program(7,d,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function d(e){var t,n="";n+='\n      <li class="sample-item">\n      ';t=e;t=p.invokePartial(i.cards_acception_templates_dashboardItemview,"cards_acception_templates_dashboardItemview",t,s,i);(t||0===t)&&(n+=t);n+="\n      </li>\n      ";return n}s=s||e.helpers;i=i||e.partials;var h,u="",p=this;h=t.perm;h=s["if"].call(t,h,{hash:{},inverse:p.noop,fn:p.program(1,r,n)});(h||0===h)&&(u+=h);u+="\n";return u});t.registerPartial("cards_acception_templates_dashboard",s);return s});
define("cards/acception/dashboard/dashboard",["backbone.marionette","js/cache","js/device","js/commands","js/trans","template/helpers/trans","js/views/card/composite","cards/acception/models/collection","cards/acception/dashboard/itemview","hbs!cards/acception/templates/dashboard"],function(e,t,s,i,n,r,a,o,l,c){return a.extend({template:c,itemView:l,itemViewContainer:"#acceptions-list",initialize:function(){a.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userHasPermission("edit_all_posts");this.dashboardShowWithPermission(this.perm).done(_.bind(function(){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},this))},onRender:function(){if(this.perm){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){if(this.trans){var s=t.get("app","staticPath")||t.set("app","staticPath",$("#main-script").data("base")),i={id:null,assets:[{url:s+"/cards/acception/assets/welcome.png"}],title:r(this.trans,"welcome to Loupe! - this card lists the posts waiting for acception")};e.items=[];for(var n=0;3>n;n++)e.items.push(i)}}else e.items=this.collection.toJSON()}}return e}})});
define("template/helpers/formatDate",["handlebars","moment"],function(e,t){function s(s,i){i=i||"";return new e.SafeString(t(s).lang(i).format("ll"))}e.registerHelper("formatDate",s);return s});
define("template/helpers/sanitize",["handlebars"],function(e){function t(t){function s(e){var t,n=$(e);if(n.children().length){var r=[];n.contents().each(function(e,t){r.push(s(t))});t=$("<div></div>").html(i(n.html(r.join("")))).html()}else t=/script|iframe/i.test(e.tagName)?"":$("<div></div>").html(i(n)).html();return t}function i(e){var t,s=e.get(0).tagName;if(s){t=$("<"+s+">").html(e.html());if("A"===s){var i=e.attr("href");i&&!/(java|vb|live)script/i.test(i)&&t.attr("href",i)}else if("IMG"===s){var n=e.attr("src");n&&!/(java|vb|live)script/i.test(n)&&t.attr("src",n)}}else t=e;return t}t=s($("<div></div>").html(t));return new e.SafeString(t)}e.registerHelper("sanitize",t);return t});
define("hbs!cards/acception/templates/view",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","hbs!js/views/card/partials/noPermission","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var n,r="";r+="\n    ";n=e;n=I.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n    ";n=e;n=I.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(r+=n);r+="\n    ";n=e.acceptionFailed;n=s["if"].call(e,n,{hash:{},inverse:I.noop,fn:I.program(2,a,t)});(n||0===n)&&(r+=n);r+="\n    ";n=e.id;n=s["if"].call(e,n,{hash:{},inverse:I.noop,fn:I.program(7,c,t)});(n||0===n)&&(r+=n);r+="\n  ";return r}function a(e,t){var i,n,r="";r+='\n        <div class="acception-failed error overlay with-button">\n          <div class="overlay-inner">\n            <span class="message overlay-content">\n              <span class="message-inner overlay-content-inner">\n                ';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:I.noop,fn:I.program(3,o,t)}):k.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(3,o,t)});(i||0===i)&&(r+=i);r+='\n              </span>\n            </span>\n            <div class="button-container">\n              <div class="close-me button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:I.noop,fn:I.program(5,l,t)}):k.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(5,l,t)});(i||0===i)&&(r+=i);r+="</div>\n            </div>\n          </div>\n        </div>\n    ";return r}function o(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===y?t():t}return j(t)}function l(){return"Close"}function c(e,t){var n,r,a,o="";o+="\n      ";n=e.status;r={};r.eq="Review";a=s.ifIs;n=a?a.call(e,n,{hash:r,inverse:I.program(11,u,t),fn:I.program(8,d,t)}):k.call(e,"ifIs",n,{hash:r,inverse:I.program(11,u,t),fn:I.program(8,d,t)});(n||0===n)&&(o+=n);o+="\n      ";n=e;n=I.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",n,s,i);(n||0===n)&&(o+=n);o+="\n    ";return o}function d(e,t){var i,n,r="";r+='\n        <div id="accept" class="button-container button-container-top button-container-caution">\n          <div class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:I.noop,fn:I.program(9,h,t)}):k.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(9,h,t)});(i||0===i)&&(r+=i);r+="</div>\n        </div>\n      ";return r}function h(){return"Accept"}function u(e,t){var i,n,r,a="";a+="\n        ";i=e.status;n={};n.eq="Publish";r=s.ifIs;i=r?r.call(e,i,{hash:n,inverse:I.noop,fn:I.program(12,p,t)}):k.call(e,"ifIs",i,{hash:n,inverse:I.noop,fn:I.program(12,p,t)});(i||0===i)&&(a+=i);a+="\n      ";return a}function p(e,t){var i,n="";n+='\n        <div class="button-container button-container-top button-container-undo">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';i=e.accepted;i=s["if"].call(e,i,{hash:{},inverse:I.program(16,v,t),fn:I.program(13,f,t)});(i||0===i)&&(n+=i);n+='\n            <span id="accept-undo" class="button-undo">\n              <span class="button-undo-inner icon-undo-arrow"></span>\n            </span>\n          </span>\n        </div>\n        ';return n}function f(e,t){var i,n,r="";r+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:I.noop,fn:I.program(14,m,t)}):k.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(14,m,t)});(i||0===i)&&(r+=i);r+="\n            ";return r}function m(){return"Completed Publishing"}function v(e,t){var i,n,r="";r+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:I.noop,fn:I.program(17,g,t)}):k.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(17,g,t)});(i||0===i)&&(r+=i);r+="\n            ";return r}function g(){return"Published"}function b(e){var t,n="";n+="\n    ";t=e;t=I.invokePartial(i.js_views_card_partials_noPermission,"js_views_card_partials_noPermission",t,s,i);(t||0===t)&&(n+=t);n+="\n  ";return n}s=s||e.helpers;i=i||e.partials;var _,w="",y="function",j=this.escapeExpression,I=this,k=s.helperMissing;w+='<section id="acception-view" class="card">\n  <div class="content">\n  ';_=t.perm;_=s["if"].call(t,_,{hash:{},inverse:I.program(19,b,n),fn:I.program(1,r,n)});(_||0===_)&&(w+=_);w+="\n  </div>\n</section>\n";return w});t.registerPartial("cards_acception_templates_view",s);return s});
define("cards/acception/view/view",["js/views/card/itemview","js/cache","js/device","js/commands","js/trans","moment","cards/acception/models/collection","cards/acception/models/model","hbs!cards/acception/templates/view"],function(e,t,s,i,n,r,a,o,l){return e.extend({template:l,ui:{button:"#accept",undo:"#accept-undo"},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=s.routes;this.blogId=n[0];this.entryId=n[1];this.perm=this.userHasPermission("edit_all_posts");if(this.perm){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new a(this.blogId));this.model=this.collection.get(this.entryId);this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.model=new o({id:this.entryId});this.fetch()}},this));i.setHandler("card:acception:share:show",function(){var e=this.serializeData();i.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this)}else this.setTranslation()},onClose:function(){i.removeHandler("card:acception:share:show")},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model)},this)})},update:function(e){this.loading=!0;this.render();var t={blogId:this.blogId,status:e,success:_.bind(function(t){this.loading=!1;if("Publish"===e){this.accepted=!0;this.collection.remove(this.model);this.collection.totalResults=this.collection.totalResults-1}else{this.accepted=!0;this.collection.add(this.model);this.collection.totalResults=this.collection.totalResults+1}this.model.set(this.model.parse(t));this.render()},this),error:_.bind(function(e){this.error=e.error&&e.error.message?e.error.message:"Acception failed";this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,t)},onRender:function(){if(this.perm){this.acceptionFailed&&this.$el.find(".close-me").hammer(this.hammerOpts).on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Publish")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Review")},this))},this));this.handleRefetch()}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;if(this.model){e=_.extend(e,this.model.toJSON());i.execute("header:render",e)}e.accepted=this.accepted?!0:!1;e.acceptionFailed=this.acceptionFailed?!0:!1}else e.trans=this.trans;e.error=this.error;return e}})});
define("cards/acception/view/view_header",["backbone.marionette","js/views/card/header"],function(e,t){return t.extend({serializeData:function(){var e=t.prototype.serializeData.apply(this);e.post=this.object||{};"Publish"===e.post.status&&(e.shareEnabled=!0);return e}})});
define("template/helpers/removeHtml",["handlebars"],function(e){function t(t){return new e.SafeString($("<div>").html(t).text())}e.registerHelper("removeHtml",t);return t});
define("hbs!cards/feedbacks/templates/dashboardItemview",["hbs","handlebars","template/helpers/removeHtml"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e){var t,s="";s+='data-route="feedbacks/comments/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===c?t():t;s+=d(t)+"/";t=e.id;t=typeof t===c?t():t;s+=d(t)+'"';return s}s=s||e.helpers;var a,o,l="",c="function",d=this.escapeExpression,h=this,u=s.helperMissing;l+="<a ";a=t.id;a=s["if"].call(t,a,{hash:{},inverse:h.noop,fn:h.program(1,r,n)});(a||0===a)&&(l+=a);l+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n      <span class="item-asset icon-comment"></span>\n    </span>\n    <span class="item-title">';a=t.body;o=s.removeHtml;a=o?o.call(t,a,{hash:{}}):u.call(t,"removeHtml",a,{hash:{}});l+=d(a)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return l});t.registerPartial("cards_feedbacks_templates_dashboardItemview",s);return s});
define("cards/feedbacks/dashboard/comments_itemview",["backbone.marionette","hbs!cards/feedbacks/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("cards/feedbacks/models/comments_model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,s,i){var n=$.Deferred(),r=i.blogId,a=function(e){e.error?n.reject(e):n.resolve(e)};n.done(i.success);n.fail(i.error);if("read"===e)t.api.getComment(r,this.id,a);else if("update"===e){var o=s.toJSON();o.status=i.status||o.status;t.api.updateComment(r,this.id,o,a)}return n}})});
define("cards/feedbacks/models/comments_collection",["backbone","moment","js/mtapi","cards/feedbacks/models/comments_model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var n=$.Deferred();n.done(i.success);n.fail(i.error);var r={limit:i.limit,entryStatus:"Publish"};i.offset&&(r.offset=i.offset);s.api.listComments(this.blogId,r,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("hbs!cards/feedbacks/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/noItem","hbs!cards/feedbacks/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i;i=e.loading;i=s.unless.call(e,i,{hash:{},inverse:h.noop,fn:h.program(2,a,t)});return i||0===i?i:""}function a(e,t){var i;i=e.count;i=s.unless.call(e,i,{hash:{},inverse:h.noop,fn:h.program(3,o,t)});return i||0===i?i:""}function o(e,t){var i,n="";n+="\n      ";i=e.items;i=s.each.call(e,i,{hash:{},inverse:h.noop,fn:h.program(4,l,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function l(e){var t,n="";n+='\n      <li class="sample-item">\n      ';t=e;t=h.invokePartial(i.cards_feedbacks_templates_dashboardItemview,"cards_feedbacks_templates_dashboardItemview",t,s,i);(t||0===t)&&(n+=t);n+="\n      </li>\n      ";return n}s=s||e.helpers;i=i||e.partials;var c,d="",h=this;c=t;c=h.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",c,s,i);(c||0===c)&&(d+=c);d+='\n<div class="content content-list">\n  ';c=t;c=h.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",c,s,i);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",c,s,i);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",c,s,i);(c||0===c)&&(d+=c);d+='\n  <ul id="feedback-comments-list" class="card-item-list">\n    ';c=t.fetchError;c=s.unless.call(t,c,{hash:{},inverse:h.noop,fn:h.program(1,r,n)});(c||0===c)&&(d+=c);d+="\n  </ul>\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",c,s,i);(c||0===c)&&(d+=c);d+="\n</div>\n";return d});t.registerPartial("cards_feedbacks_templates_dashboard",s);return s});
define("cards/feedbacks/dashboard/dashboard",["js/cache","js/device","js/commands","template/helpers/trans","cards/feedbacks/models/comments_collection","hbs!cards/feedbacks/templates/dashboard","cards/feedbacks/dashboard/comments_itemview","js/views/card/composite"],function(e,t,s,i,n,r,a,o){return o.extend({template:r,itemView:a,itemViewContainer:"#feedback-comments-list",initialize:function(){o.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.collection=e.get(this.blogId,"feedbacks_comments")||e.set(this.blogId,"feedbacks_comments",new n(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},onRender:function(){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)},serializeData:function(){var e=this.serializeDataInitialize();e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){var t={id:null,body:i(this.trans,"welcome to Loupe! - this card lists the new comments")};e.items=[];for(var s=0;3>s;s++)e.items.push(t)}}return e}})});
define("hbs!cards/feedbacks/templates/content",["hbs","handlebars","template/helpers/formatDate","template/helpers/trans","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(){return"Author"}s=s||e.helpers;var a,o,l,c="",d=s.helperMissing,h=this.escapeExpression,u=this,p="function";c+='<ul class="comment-items-list">\n  <li class="date">';a=t.lang;o=t.date;l=s.formatDate;a=l?l.call(t,o,a,{hash:{}}):d.call(t,"formatDate",o,a,{hash:{}});c+=h(a)+'</li>\n  <li class="author">';a=t.trans;l=s.trans;a=l?l.call(t,a,{hash:{},inverse:u.noop,fn:u.program(1,r,n)}):d.call(t,"trans",a,{hash:{},inverse:u.noop,fn:u.program(1,r,n)});(a||0===a)&&(c+=a);c+='<span class="author-name">';a=t.author;a=null==a||a===!1?a:a.displayName;a=typeof a===p?a():a;c+=h(a)+'</span></li>\n  <li class="body">';a=t.body;l=s.sanitize;a=l?l.call(t,a,{hash:{}}):d.call(t,"sanitize",a,{hash:{}});c+=h(a)+"</li>\n</ul>\n";return c});t.registerPartial("cards_feedbacks_templates_content",s);return s});
define("hbs!cards/feedbacks/templates/comment",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!cards/feedbacks/templates/content","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i,n,r="";r+='\n      <div class="approve-failed error overlay with-button">\n        <div class="overlay-inner">\n          <span class="message overlay-content">\n            <span class="message-inner overlay-content-inner">';i=e.error;i=null==i||i===!1?i:i.message;i=typeof i===w?i():i;r+=y(i)+'</span>\n          </span>\n          <div class="button-container">\n            <div class="close-me button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(2,a,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(2,a,t)});(i||0===i)&&(r+=i);r+="</div>\n          </div>\n        </div>\n      </div>\n    ";return r}function a(){return"Close"}function o(e,t){var i,n,r,a="";a+="\n      ";i=e.status;n={};n.eq="Pending";r=s.ifIs;i=r?r.call(e,i,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)}):I.call(e,"ifIs",i,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function l(e,t){var n,r="";r+="\n        ";n=e.commentApprovePerm;n=s["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(6,c,t)});(n||0===n)&&(r+=n);r+="\n        ";n=e;n=j.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,s,i);(n||0===n)&&(r+=n);r+="\n      ";return r}function c(e,t){var i,n,r="";r+='\n        <div id="approve" class="button-container button-container-caution button-container-top">\n          <div class="button">\n            <div class="button-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(7,d,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(7,d,t)});(i||0===i)&&(r+=i);r+="</div>\n          </div>\n        </div>\n        ";return r}function d(){return"Approve"}function h(e,t){var i,n,r,a="";a+="\n        ";i=e.status;n={};n.eq="Approved";r=s.ifIs;i=r?r.call(e,i,{hash:n,inverse:j.noop,fn:j.program(10,u,t)}):I.call(e,"ifIs",i,{hash:n,inverse:j.noop,fn:j.program(10,u,t)});(i||0===i)&&(a+=i);a+="\n      ";return a}function u(e,t){var n,r="";r+='\n        <div class="button-container button-container-undo button-container-top">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';n=e.accepted;n=s["if"].call(e,n,{hash:{},inverse:j.program(14,m,t),fn:j.program(11,p,t)});(n||0===n)&&(r+=n);r+="\n          </span>\n          ";n=e.commentApprovePerm;n=s["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(17,g,t)});(n||0===n)&&(r+=n);r+="\n        </div>\n        ";n=e;n=j.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,s,i);(n||0===n)&&(r+=n);r+="\n        ";return r}function p(e,t){var i,n,r="";r+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(12,f,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(12,f,t)});(i||0===i)&&(r+=i);r+="\n            ";return r}function f(){return"Completed Approvement"}function m(e,t){var i,n,r="";r+="\n              ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:j.noop,fn:j.program(15,v,t)}):I.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(15,v,t)});(i||0===i)&&(r+=i);r+="\n            ";return r}function v(){return"Approved"}function g(){return'\n          <span id="comment-undo" class="button-undo">\n            <span class="button-undo-inner icon-undo-arrow"></span>\n          </span>\n          '}s=s||e.helpers;i=i||e.partials;var b,_="",w="function",y=this.escapeExpression,j=this,I=s.helperMissing;_+='  <div class="comment-container">\n    ';b=t;b=j.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",b,s,i);(b||0===b)&&(_+=b);_+="\n    ";b=t;b=j.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",b,s,i);(b||0===b)&&(_+=b);_+="\n    ";b=t.acceptionFailed;b=s["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(1,r,n)});(b||0===b)&&(_+=b);_+="\n    ";b=t.status;b=s["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(4,o,n)});(b||0===b)&&(_+=b);_+="\n  </div>\n";return _});t.registerPartial("cards_feedbacks_templates_comment",s);return s});
define("cards/feedbacks/view/comment",["js/views/card/itemview","js/commands","hbs!cards/feedbacks/templates/comment"],function(e,t,s){return e.extend({template:s,ui:{button:"#approve",undo:"#comment-undo"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.fetchError=t.fetchError;if(!this.fetchError){this.collection=t.collection;this.model=t.model;this.entryModel=t.entryModel;this.commentApprovePerm=!1;var s=this.entryModel.toJSON();"Publish"===s.status&&(this.userIsSystemAdmin()||this.userHasPermission("manage_feedback")||this.userHasPermission("edit_all_posts")?this.commentApprovePerm=!0:s.author&&s.author.displayName===this.user.name&&this.userHasPermission("publish_post")&&(this.commentApprovePerm=!0))}this.loading=!1;this.setTranslation()},update:function(e){this.loading=!0;this.render();var s={blogId:this.blogId,status:e,success:_.bind(function(e){this.loading=!1;this.accepted=!0;this.model.set(this.model.parse(e));this.render();t.execute("card:feedbacks:reply:render")},this),error:_.bind(function(e){this.error=e.error;this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,s)},onRender:function(){this.acceptionFailed&&this.$el.find(".close-me").hammer().on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Approved")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Pending")},this))},this))},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));e.accepted=this.accepted;e.acceptionFailed=this.acceptionFailed;e.error=this.error;e.commentApprovePerm=this.commentApprovePerm;return e}})});
define("hbs!cards/feedbacks/templates/entry",["hbs","handlebars","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/entryItemsList","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(){return"The Post Commented"}function a(e,t){var i,n,r,a="";a+="\n  ";i=e.status;n={};n.eq="Publish";r=s.ifIs;i=r?r.call(e,i,{hash:n,inverse:p.program(6,l,t),fn:p.program(4,o,t)}):f.call(e,"ifIs",i,{hash:n,inverse:p.program(6,l,t),fn:p.program(4,o,t)});(i||0===i)&&(a+=i);a+="\n  ";return a}function o(e){var t,n="";n+="\n    ";t=e;t=p.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",t,s,i);(t||0===t)&&(n+=t);n+="\n  ";return n}function l(e,t){var i,n,r="";r+='\n  <div class="error overlay">\n    <div class="overlay-inner">\n      <span class="message overlay-content">\n        <span class="message-inner overlay-content-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:p.noop,fn:p.program(7,c,t)}):f.call(e,"trans",i,{hash:{},inverse:p.noop,fn:p.program(7,c,t)});(i||0===i)&&(r+=i);r+="</span>\n      </span>\n    </div>\n  </div>\n  ";return r}function c(){return"The post is not published"}s=s||e.helpers;i=i||e.partials;var d,h,u="",p=this,f=s.helperMissing;u+="<header>\n<h1>";d=t.trans;h=s.trans;d=h?h.call(t,d,{hash:{},inverse:p.noop,fn:p.program(1,r,n)}):f.call(t,"trans",d,{hash:{},inverse:p.noop,fn:p.program(1,r,n)});(d||0===d)&&(u+=d);u+='</h1>\n</header>\n<div class="content">\n  ';d=t;d=p.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",d,s,i);(d||0===d)&&(u+=d);u+="\n  ";d=t;d=p.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",d,s,i);(d||0===d)&&(u+=d);u+="\n  ";d=t.id;d=s["if"].call(t,d,{hash:{},inverse:p.noop,fn:p.program(3,a,n)});(d||0===d)&&(u+=d);u+="\n</div>\n";return u});t.registerPartial("cards_feedbacks_templates_entry",s);return s});
define("cards/feedbacks/view/entry",["js/views/card/itemview","hbs!cards/feedbacks/templates/entry"],function(e,t){return e.extend({template:t,initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.fetchError=t.fetchError||!1;this.fetchError||(this.model=t.entryModel);this.loading=!1;this.setTranslation()},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));return e}})});
define("js/views/card/itemview_layout",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{});return e.Layout.extend(i,{cardItemViewLayoutProto:i})});
define("js/models/entry",["backbone","js/mtapi"],function(e,t){return e.Model.extend({initialize:function(e){this.blogId=e.blogId},sync:function(e,s,i){if("read"===e){var n=$.Deferred();n.done(i.success);n.fail(i.error);t.api.getEntry(this.blogId,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},function(e){e.error?n.reject(e):n.resolve(e)});return n}}})});
define("js/collections/entries",["backbone","js/models/entry"],function(e,t){return e.Collection.extend({model:t})});
define("hbs!cards/feedbacks/templates/layout",["hbs","handlebars","hbs!js/views/card/partials/loading"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,r="",a=this;r+='<section id="feedbacks-comment-view" class="card">\n  <div class="content">\n    ';n=t;n=a.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+='\n    <div id="comment"></div>\n    <div id="reply"></div>\n</section>\n<section id="feedbacks-comment-entry" class="card">\n  <div class="content">\n    ';n=t;n=a.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n  </div>\n</section>\n\n";return r});t.registerPartial("cards_feedbacks_templates_layout",s);return s});
define("hbs!cards/feedbacks/templates/reply",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i,n="";n+="\n";i=e.commentIsApproved;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(2,a,t)});(i||0===i)&&(n+=i);n+="\n";return n}function a(e,t){var n,r="";r+="\n  ";n=e;n=w.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n  ";n=e.initial;n=s["if"].call(e,n,{hash:{},inverse:w.program(6,c,t),fn:w.program(3,o,t)});(n||0===n)&&(r+=n);r+="\n";return r}function o(e,t){var i,n,r="";r+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(4,l,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(4,l,t)});(i||0===i)&&(r+=i);r+="</div>\n      </div>\n    </div>\n  </div>\n  ";return r}function l(){return"Reply"}function c(e,t){var i,n="";n+="\n  ";i=e.replied;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(7,d,t)});(i||0===i)&&(n+=i);n+="\n  ";i=e.form;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(12,p,t)});(i||0===i)&&(n+=i);n+="\n  ";return n}function d(e,t){var i,n,r="";r+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(8,h,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(8,h,t)});(i||0===i)&&(r+=i);r+='</div>\n      </div>\n    </div>\n  </div>\n  <div id="reply-textarea-container">\n    <div class="reply-complete-message message">\n      <div class="message-inner">\n        <span class="button-icon icon-check"></span>\n        <span id="accepted">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(10,u,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(10,u,t)});(i||0===i)&&(r+=i);r+="</span>\n      </div>\n    </div>\n    <div>";n=s.body;if(n)i=n.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}r+=I(i)+"</div>\n  </div>\n  ";return r}function h(){return"Another Comment"}function u(){return"Posted comment successfully"}function p(e,t){var i,n,r="";r+='\n  <div id="reply-container">\n    <div class="reply-button-container button-container button-container-disabled">\n      <div id="reply-disabled-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(13,f,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(13,f,t)});(i||0===i)&&(r+=i);r+='</div>\n    </div>\n  </div>\n  <div class="reply-textarea-container">\n    ';i=e.error;i=s["if"].call(e,i,{hash:{},inverse:w.noop,fn:w.program(15,m,t)});(i||0===i)&&(r+=i);r+='\n    <textarea id="reply-textarea">';n=s.body;if(n)i=n.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}r+=I(i)+'</textarea>\n    <div class="button-container">\n      <div id="do-reply-button" class="button">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(18,g,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(18,g,t)});(i||0===i)&&(r+=i);r+="</div>\n    </div>\n  </div>\n  ";return r}function f(){return"Reply"}function m(e,t){var i,n,r="";r+='\n    <div class="error">\n      <span class="message">\n        <span class="message-inner">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:w.noop,fn:w.program(16,v,t)}):y.call(e,"trans",i,{hash:{},inverse:w.noop,fn:w.program(16,v,t)});(i||0===i)&&(r+=i);r+="</span>\n      </span>\n    </div>\n    ";return r}function v(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===j?t():t}return I(t)}function g(){return"Post The Reply"}s=s||e.helpers;i=i||e.partials;var b,_="",w=this,y=s.helperMissing,j="function",I=this.escapeExpression;b=t.entryIsPublished;b=s["if"].call(t,b,{hash:{},inverse:w.noop,fn:w.program(1,r,n)});(b||0===b)&&(_+=b);_+="\n";return _});t.registerPartial("cards_feedbacks_templates_reply",s);return s});
define("cards/feedbacks/view/reply",["js/views/card/itemview","js/mtapi","js/commands","moment","cards/feedbacks/models/comments_model","hbs!cards/feedbacks/templates/reply"],function(e,t,s,i,n,r){return e.extend({template:r,ui:{replyButton:"#reply-button",doReplyButton:"#do-reply-button",replyTextarea:"#reply-textarea"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.blogId=t.blogId;this.commentId=t.commentId;this.model=t.model;this.collection=t.collection;this.entryModel=t.entryModel;this.initial=!0;this.loading=!1;this.setTranslation();s.setHandler("card:feedbacks:reply:render",this.render,this)},onClose:function(){s.removeHandler("card:feedbacks:reply:render")},commentIsApproved:function(){var e=this.model.toJSON();return"Approved"===e.status},entryIsPublished:function(){var e=this.entryModel.toJSON();return"Publish"===e.status},onRender:function(){if(this.entryIsPublished()&&this.commentIsApproved()){this.ui.replyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.initial=!1;this.form=!0;this.body=!1;this.replied=!1;this.loading=!1;this.render()},this))},this));this.ui.doReplyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){var e=this.ui.replyTextarea.val(),s=this.model.toJSON();if(e.length){var r={author:this.user,entry:s.entry,blog:s.blog,parent:this.commentId,date:i().format(),body:e};this.body=e;this.loading=!0;this.render();t.api.createReplyComment(this.blogId,s.entry.id,this.commentId,r,_.bind(function(t){if(t.error){this.form=!0;this.replied=!1;this.body=e;this.loading=!1;this.error=t.error&&t.error.message?t.error.message:"request failed";this.render()}else{this.form=!1;this.replied=!0;this.body=e;this.loading=!1;var s=new n;s.set(t);this.collection.unshift(s);this.render()}},this))}},this))},this))}},serializeData:function(){var e=this.serializeDataInitialize();e=_.extend(e,this.model.toJSON());e.commentIsApproved=this.commentIsApproved();e.entryIsPublished=this.entryIsPublished();e.error=this.error;e.initial=this.initial;e.form=this.form;e.replied=this.replied;e.body=this.body||"";return e}})});
define("cards/feedbacks/view/layout",["js/views/card/itemview_layout","js/cache","cards/feedbacks/models/comments_collection","cards/feedbacks/models/comments_model","js/collections/entries","js/models/entry","hbs!cards/feedbacks/templates/layout","cards/feedbacks/view/comment","cards/feedbacks/view/reply","cards/feedbacks/view/entry"],function(e,t,s,i,n,r,a,o,l,c){return e.extend({template:a,regions:{comment:"#comment",reply:"#reply",entry:"#feedbacks-comment-entry"},initialize:function(n){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var r=n.routes;this.options=n;this.type=r[0];this.blogId=r[1];this.commentId=r[2];this.collection=t.get(this.blogId,"feedbacks_comments")||t.set(this.blogId,"feedbacks_comments",new s(this.blogId));this.model=this.collection.get(this.commentId);this.setTranslation(_.bind(function(){if(this.model)this.fetchEntry();else{this.render();this.model=new i({id:this.commentId});this.fetch()}},this))},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model);this.loading=!0;this.fetchEntry()},this)})},fetchEntry:function(){var e=this.model.toJSON(),s=e.entry?e.entry.id:null;this.entryCollection=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));this.entryModel=this.entryCollection.get(s);if(this.entryModel){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.build()},this),0)}else{this.entryModel=new r({blogId:this.blogId,id:s});var i={success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.entryCollection.add(this.entryModel);this.build()},this),0)},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)};this.entryModel.fetch(i)}},build:function(){this.model.toJSON();var e=_.extend(this.options,{model:this.model,collection:this.collection,type:this.type,blogId:this.blogId,commentId:this.commentId,entryModel:this.entryModel});this.comment.show(new o(e));this.reply.show(new l(e));this.entry.show(new c(e))},onRender:function(){if(this.fetchError){this.handleRefetch();var e=_.extend(this.options,{fetchError:this.fetchError});this.comment.show(new o(e));this.entry.show(new c(e))}},serializeData:function(){var e=this.serializeDataInitialize();return e}})});
define("js/mtapi/stats_provider",["js/cache","js/mtapi"],function(e,t){return function(s){var i=$.Deferred(),n=e.get(s,"statsProvider")||null;n?i.resolve({id:n}):t.api.getStatsProvider(s,{bustCache:(new Date).valueOf()},function(t){if(t&&!t.error)if(t.id){e.set(s,"statsProvider",t);i.resolve(t)}else i.reject(t);else i.reject(t)});return i}});
define("cards/stats/models/latest_page_views",["backbone","moment","js/mtapi"],function(e,t,s){return e.Model.extend({isSynced:!1,initialize:function(e){this.blogId=e},sync:function(e,i,n){if("read"===e){var r=$.Deferred(),a=$.Deferred(),o={startDate:t().subtract("days",6).format(),endDate:t().format()};s.api.listStatsPageviewsForDate(this.blogId,o,_.bind(function(e){e.error?r.reject(e):r.resolve(e)},this));s.api.listStatsVisitsForDate(this.blogId,o,_.bind(function(e){e.error?a.reject(e):a.resolve(e)},this));$.when(r,a).then(_.bind(function(e,t){this.isSynced=!0;n.success({pageviews:e,visits:t},n)},this),n.error);return[r,a]}}})});
define("template/helpers/todaysPageViews",["handlebars"],function(e){function t(e){var t="";if(e){t=parseFloat(e[e.length-1].pageviews,10);t>1e6?t=Math.round(t/1e6)+"M":t>1e3&&(t=Math.round(t/1e3)+"K");return t}}e.registerHelper("todaysPageViews",t);return t});
define("hbs!cards/stats/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","template/helpers/formatDate","template/helpers/todaysPageViews"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e){var t,i,n,r="";r+='<div class="today">';t=e.lang;i=e.today;n=s.formatDate;t=n?n.call(e,i,t,{hash:{}}):d.call(e,"formatDate",i,t,{hash:{}});r+=h(t)+"</div>";return r}function a(e,t){var i,n="";n+="\n    ";i=e.pageviews;i=null==i||i===!1?i:i.items;i=s["if"].call(e,i,{hash:{},inverse:p.noop,fn:p.program(4,o,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function o(e){var t,i,n="";n+='\n    <div class="todays-pageviews">';t=e.pageviews;t=null==t||t===!1?t:t.items;i=s.todaysPageViews;t=i?i.call(e,t,{hash:{}}):d.call(e,"todaysPageViews",t,{hash:{}});n+=h(t)+'\n      <span class="diff-icon ';i=s.diffIcon;if(i)t=i.call(e,{hash:{}});else{t=e.diffIcon;t=typeof t===u?t():t}n+=h(t)+'"></span>\n    </div>\n    ';return n}s=s||e.helpers;i=i||e.partials;var l,c="",d=s.helperMissing,h=this.escapeExpression,u="function",p=this;l=t;l=p.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",l,s,i);(l||0===l)&&(c+=l);c+='\n<div class="content">\n  ';l=t;l=p.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t.today;l=s["if"].call(t,l,{hash:{},inverse:p.noop,fn:p.program(1,r,n)});(l||0===l)&&(c+=l);c+="\n\n  ";l=t;l=p.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=p.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(c+=l);c+='\n\n  <div class="stats-dashboard-graph-container">\n    ';l=t.pageviews;l=s["if"].call(t,l,{hash:{},inverse:p.noop,fn:p.program(3,a,n)});(l||0===l)&&(c+=l);c+='\n    <div id="stats-dashboard-graph"></div>\n  </div>\n</div>\n';return c});t.registerPartial("cards_stats_templates_dashboard",s);return s});
define("cards/stats/dashboard/dashboard",["js/cache","js/commands","js/device","js/mtapi/stats_provider","js/views/card/itemview","cards/stats/models/latest_page_views","hbs!cards/stats/templates/dashboard","mtchart"],function(e,t,s,i,n,r,a,o){return n.extend({template:a,initialize:function(){n.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=e.get(this.blogId,"stats_latest_page_views")||e.set(this.blogId,"stats_latest_page_views",new r(this.blogId));this.setTranslation();if(this.model.isSynced){this.loading=!1;this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")}else{var t=_.isFunction(i)?i(this.blogId):i;t.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));t.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},fetch:function(){n.prototype.fetch.call(this,{successCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")},this),errorCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).off("tap",this.navigatePage);this.$el.removeClass("tap-enabled")},this)})},navigatePage:function(){t.execute("router:navigate","stats")},onRender:function(){this.handleRefetch();var t,i,n,r,a,l,c,d,h,u=[];if(this.model.isSynced){t=this.model.toJSON();i=t.pageviews.items;n=t.visits.items;for(l=0,c=i.length;c>l;l++){r=i[l];a=n[l];u.push({x:r.date,y:a.visits,y1:r.pageviews})}d={type:"easel.mix",data:u,yLength:2,mix:[{type:"bar",yLength:1,chartColors:["#cccccc"],chartColorsAlpha:[.5]},{type:"motionLine",yLength:1,lineWidth:8,chartColors:["#55a038"],drawPointer:s.isAndroid?!1:!0,pointerColors:["#ea4b29"]}],fallback:{test:"canvas",type:"morris.bar",data:u,yLength:1,chartColors:["#55a038"],gridLineColor:"#f3f3f5",gridTextColor:"#f3f3f5",hideHover:"always"},height:170};h={length:7,unit:"daily"};new o.Graph(d,h).trigger("APPEND_TO",this.$el.find("#stats-dashboard-graph"))}else if(this.providerIsNotAvailable){var p=e.get("app","staticPath")||e.set("app","staticPath",$("#main-script").data("base"));this.$el.find("#stats-dashboard-graph").append('<img src="'+p+'/cards/stats/assets/welcome.png" class="stats-welcome" height="170">')}},serializeData:function(){var e=this.serializeDataInitialize();e.title="Today's Page Views";if(!this.loading){e=_.extend({},e,this.model.toJSON());if(e.pageviews&&e.pageviews.items){var t=e.pageviews.items.length;if(t>1){var s=parseInt(e.pageviews.items[t-2].pageviews,10),i=parseInt(e.pageviews.items[t-1].pageviews,10);this.diff=i-s;e.diffIcon=this.diff<0?"icon-arrow-down-right":this.diff>0?"icon-arrow-up-right":"icon-arrow-right"}}else if(this.providerIsNotAvailable){e.pageviews={items:[{pageviews:77e4}]};e.diffIcon="icon-arrow-up-right"}e.today=(new Date).valueOf()}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e}})});
define("cards/stats/models/top_articles",["backbone","js/mtapi","moment"],function(e,t){return e.Model.extend({isSynced:!1,sync:function(e,s,i){if("read"===e){var n=$.Deferred(),r={startDate:i.startDate,endDate:i.endDate,limit:i.limit};i.path&&(r.path=i.path);n.done(i.success);n.fail(i.error);t.api.listStatsPageviewsForPath(i.blogId,r,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}}})});
define("cards/stats/models/top_articles_itemview",["backbone","js/cache","js/mtapi","js/models/entry","js/collections/entries"],function(e,t,s,i,n){return e.Model.extend({initialize:function(e){this.blogId=e.blogId;this.num=e.num;this.pageviews=e.pageviews;this.unit=e.unit},sync:function(e,s,r){if("read"===e){var a=$.Deferred();a.done(r.success);a.fail(r.error);var o=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));if(o.get(this.id))a.resolve(o.get(this.id).toJSON());else{var l=new i({id:this.id,blogId:this.blogId});l.fetch({success:function(){o.add(l);a.resolve(l.toJSON())},error:function(){a.reject(l.toJSON())}})}return a}}})});
define("cards/stats/models/top_articles_itemview_collection",["backbone","js/mtapi","cards/stats/models/top_articles_itemview"],function(e,t,s){return e.Collection.extend({model:s,comparator:function(e){return-1*parseInt(e.get("pageviews"),10)}})});
define("hbs!cards/stats/templates/layout",["hbs","handlebars"],function(e,t){var s=t.template(function(e,t,s){s=s||e.helpers;return'<section id="recent-access" class="card"></section>\n<section id="top-articles" class="top-articles card">\n</section>\n<section id="top-articles-weekly" class="top-articles card">\n</section>\n'});t.registerPartial("cards_stats_templates_layout",s);return s});
define("hbs!cards/stats/templates/recent_access",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,r="",a=this;n=t;n=a.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(r+=n);r+='\n<div class="content">\n  ';n=t;n=a.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n  ";n=t;n=a.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,s,i);(n||0===n)&&(r+=n);r+="\n  ";n=t;n=a.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",n,s,i);(n||0===n)&&(r+=n);r+="\n</div>\n";return r});t.registerPartial("cards_stats_templates_recent_access",s);return s});
define("cards/stats/view/recent_access",["js/views/card/itemview","js/cache","js/mtapi/stats_provider","cards/stats/models/latest_page_views","hbs!cards/stats/templates/recent_access","mtchart"],function(e,t,s,i,n,r){return e.extend({template:n,serializeData:function(){var e=this.serializeDataInitialize();e.title="Access In Last Week";this.loading||(e=_.extend(e,this.model.toJSON()));e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=t.get(this.blogId,"stats_latest_page_views")||t.set(this.blogId,"stats_latest_page_views",new i(this.blogId));this.setTranslation();if(this.model.isSynced)this.loading=!1;else{var n=s(this.blogId);n.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));n.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},onRender:function(){this.handleRefetch();if(this.model.isSynced){var e=this.$el.find(".content"),t=this.model.toJSON().pageviews.items,s=_.map(t,function(e){return{x:e.date,y:e.pageviews}}),i=_.map(t,function(e){var t=e.pageviews;e.pageviews>=1e6?t=Math.round(e.pageviews/1e6)+"M":e.pageviews>=1e3&&(t=Math.round(e.pageviews/1e3)+"K");return t}),n={type:"css.horizontalBar",data:s,yLength:1,yLabel:i,autoSized:!1,pointSize:6,barColor:"#efb330",barBackgroundColor:"#362c35",dateColor:"#444444",dateColorSaturday:"#4079e6",dateColorSunday:"#ec4b05",dateLabelSize:16,labelSize:22,labelColor:"#ffffff",showDate:!0,barWidth:40,barMarginLeft:35,barInterval:10},a={dataType:"timeline",unit:"daily",length:7};new r.Graph(n,a).trigger("APPEND_TO",e)}}})});
define("hbs!cards/stats/templates/itemviewContent",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i,n,r="";r+="\n      ";i=e.assets;n=s.eachOnly;i=n?n.call(e,i,0,{hash:{},inverse:f.noop,fn:f.program(2,a,t)}):m.call(e,"eachOnly",i,0,{hash:{},inverse:f.noop,fn:f.program(2,a,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function a(e){var t,i,n="";n+='\n      <div class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+') no-repeat center center / cover"><div class="circle-inner"></div></div>\n      ';return n}function o(){return'\n      <div class="item-asset no-image circle"><div class="circle-inner"></div></div>\n    '}function l(){return'<div class="item-arrow icon-arrow"></div>'}s=s||e.helpers;var c,d,h="",u="function",p=this.escapeExpression,f=this,m=s.helperMissing;h+='<div class="item-num">';c=t.num;c=typeof c===u?c():c;h+=p(c)+'</div>\n<div class="item-content">\n  <div class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=s["if"].call(t,c,{hash:{},inverse:f.program(4,o,n),fn:f.program(1,r,n)});(c||0===c)&&(h+=c);h+='\n  </div>\n  <div class="item-title">';d=s.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===u?c():c}h+=p(c)+"</div>\n  ";c=t.arrow;c=s["if"].call(t,c,{hash:{},inverse:f.noop,fn:f.program(6,l,n)});(c||0===c)&&(h+=c);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_itemviewContent",s);return s});
define("hbs!cards/stats/templates/top_articles_itemview",["hbs","handlebars","hbs!cards/stats/templates/itemviewContent"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var n,r,a="",o="function",l=this.escapeExpression,c=this;a+='<a data-route="stats/';r=s.blogId;if(r)n=r.call(t,{hash:{}});else{n=t.blogId;n=typeof n===o?n():n}a+=l(n)+"/";r=s.id;if(r)n=r.call(t,{hash:{}});else{n=t.id;n=typeof n===o?n():n}a+=l(n)+"/";r=s.unit;if(r)n=r.call(t,{hash:{}});else{n=t.unit;n=typeof n===o?n():n}a+=l(n)+'" class="item-container">\n  ';n=t;n=c.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",n,s,i);(n||0===n)&&(a+=n);a+="\n</a>\n";return a});t.registerPartial("cards_stats_templates_top_articles_itemview",s);return s});
define("cards/stats/view/top_articles_itemview",["backbone.marionette","cards/stats/models/top_articles_itemview","hbs!cards/stats/templates/top_articles_itemview"],function(e,t,s){return e.ItemView.extend({template:s})});
define("hbs!cards/stats/templates/top_articles",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","hbs!js/views/card/partials/noItem","hbs!cards/stats/templates/itemviewContent","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e){var t,i;i=s.title;if(i)t=i.call(e,{hash:{}});else{t=e.title;t=typeof t===u?t():t}return t||0===t?t:""}function a(e){var t,n="";n+='\n    <li id="eid-';t=e.entry;t=null==t||t===!1?t:t.id;t=typeof t===u?t():t;n+=p(t)+'" data-pageviews="';t=e.pageviews;t=typeof t===u?t():t;n+=p(t)+'">\n      <div class="item-container">\n        <div class="content-loading"></div>\n        ';t=e;t=f.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",t,s,i);(t||0===t)&&(n+=t);n+="\n      </div>\n    </li>\n  ";return n}function o(){return'\n  <div class="item-loading"></div>\n  '}s=s||e.helpers;i=i||e.partials;var l,c,d,h="",u="function",p=this.escapeExpression,f=this,m=s.helperMissing;h+='<header>\n<h1 id="';d=s.name;if(d)l=d.call(t,{hash:{}});else{l=t.name;l=typeof l===u?l():l}h+=p(l)+'-title">';l=t.numberOfArticles;c=t.trans;d=s.trans;l=d?d.call(t,c,l,{hash:{},inverse:f.noop,fn:f.program(1,r,n)}):m.call(t,"trans",c,l,{hash:{},inverse:f.noop,fn:f.program(1,r,n)});(l||0===l)&&(h+=l);h+='</h1>\n</header>\n<div class="content content-list">\n  ';l=t;l=f.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",l,s,i);(l||0===l)&&(h+=l);h+='\n  <ul id="top-articles-list-';d=s.unit;if(d)l=d.call(t,{hash:{}});else{l=t.unit;l=typeof l===u?l():l}h+=p(l)+'" class="card-item-list top-articles-list">\n  ';l=t.items;l=s.each.call(t,l,{hash:{},inverse:f.noop,fn:f.program(3,a,n)});(l||0===l)&&(h+=l);h+="\n  </ul>\n  ";l=t.itemLoading;l=s["if"].call(t,l,{hash:{},inverse:f.noop,fn:f.program(5,o,n)});(l||0===l)&&(h+=l);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_top_articles",s);return s});
define("cards/stats/view/top_articles",["js/views/card/composite","js/cache","moment","js/mtapi/stats_provider","cards/stats/models/top_articles","cards/stats/models/top_articles_itemview_collection","cards/stats/models/top_articles_itemview","cards/stats/view/top_articles_itemview","hbs!cards/stats/templates/top_articles"],function(e,t,s,i,n,r,a,o,l){return e.extend({numberOfArticles:3,template:l,itemView:o,itemViewContainer:"#top-articles-list-day",appendHtml:function(e,t){this.getItemViewContainer(e).find("#eid-"+t.model.id).html(t.el)},serializeData:function(){var e=this.serializeDataInitialize(),t=[];if(!this.loading){e=_.extend(e,this.model.toJSON());if(e.items&&e.items.length){var s=this.numberOfArticles,i=_.filter(e.items,function(e){return e.entry&&e.entry.id})||[];e.count=i.length;_.each(i,function(e){var i=e.entry?e.entry.id:null;if(s&&i){s-=1;var n=this.numberOfArticles-s;e.num=n;t.push(e);var r=this.collection.get(i);this.dfd.done(_.bind(function(){if(!r){r=new a({id:i,blogId:this.blogId,num:n,pageviews:e.pageviews,unit:this.unit});r.fetch({success:_.bind(function(){r.set({arrow:!0});this.collection.add(r,{sort:!0})},this),error:_.bind(function(){r.set({title:e.title});this.collection.add(r,{sort:!0})},this)})}},this))}},this);e.items=t}}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;e.itemLoading=this.itemLoading?!0:!1;var n={day:"Day",week:"Week",month:"Month",year:"Year"};e.title="Top [_1] of The "+n[this.unit];e.numberOfArticles=this.numberOfArticles;e.unit=this.unit;return e},fetch:function(){this.model.fetch({blogId:this.blogId,startDate:s().startOf(this.unit).format(),endDate:s().endOf(this.unit).format(),limit:10,success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.itemLoading=!0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.unit=s.unit||"day";this.model=t.get(this.blogId,"toparticle_"+this.unit+"_model")||t.set(this.blogId,"toparticle_"+this.unit+"_model",new n);this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.setTranslation();this.dfd=$.Deferred();if(this.model.isSynced){this.loading=!1;this.render()}else{var a=i(this.blogId);a.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));a.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}this.handleItemViewNavigate()},onRender:function(){this.handleRefetch();!this.loading&&this.itemLoading&&this.dfd.resolve()}})});
define("cards/stats/view/top_articles_weekly",["cards/stats/view/top_articles"],function(e){return e.extend({itemViewContainer:"#top-articles-list-week"})});
define("cards/stats/view/layout",["backbone.marionette","js/commands","hbs!cards/stats/templates/layout","cards/stats/view/recent_access","cards/stats/view/top_articles","cards/stats/view/top_articles_weekly"],function(e,t,s,i,n,r){return e.Layout.extend({template:s,regions:{recentAccess:"#recent-access",topArticles:"#top-articles",topArticlesWeekly:"#top-articles-weekly"},initialize:function(e){this.options=e},onRender:function(){this.recentAccess.show(new i(this.options));this.topArticles.show(new n(_.extend({},this.options,{unit:"day"})));this.topArticlesWeekly.show(new r(_.extend({},this.options,{unit:"week"})))}})});
define("hbs!cards/stats/templates/post",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","template/helpers/ifIs","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i,n,r,o="";o+="\n    ";i=e.status;n={};n.eq="Publish";r=s.ifIs;i=r?r.call(e,i,{hash:n,inverse:h.noop,fn:h.program(2,a,t)}):u.call(e,"ifIs",i,{hash:n,inverse:h.noop,fn:h.program(2,a,t)});(i||0===i)&&(o+=i);o+="\n  ";return o}function a(e,t){var n,r,a="";a+='\n      <div class="pageviews">\n        <span class="label"><span class="label-inner">';n=e.trans;r=s.trans;n=r?r.call(e,n,{hash:{},inverse:h.noop,fn:h.program(3,o,t)}):u.call(e,"trans",n,{hash:{},inverse:h.noop,fn:h.program(3,o,t)});(n||0===n)&&(a+=n);a+='</span></span>\n        <span class="pageview">';r=s.pageviews;if(r)n=r.call(e,{hash:{}});else{n=e.pageviews;n=typeof n===d?n():n}a+=p(n)+"</span>\n      </div>\n      ";n=e;n=h.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",n,s,i);(n||0===n)&&(a+=n);a+="\n    ";return a}function o(e){var t,i;i=s.label;if(i)t=i.call(e,{hash:{}});else{t=e.label;t=typeof t===d?t():t}return t||0===t?t:""}s=s||e.helpers;i=i||e.partials;var l,c="",d="function",h=this,u=s.helperMissing,p=this.escapeExpression;c+='<section id="stats-post" class="card">\n  <div class="content">\n  ';l=t;l=h.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=h.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t.id;l=s["if"].call(t,l,{hash:{},inverse:h.noop,fn:h.program(1,r,n)});(l||0===l)&&(c+=l);c+="\n  </div>\n</section>\n";return c});t.registerPartial("cards_stats_templates_post",s);return s});
define("cards/stats/view/post",["js/views/card/itemview","js/cache","js/commands","moment","cards/stats/models/top_articles_itemview","cards/stats/models/top_articles_itemview_collection","hbs!cards/stats/templates/post","cards/stats/models/top_articles"],function(e,t,s,i,n,r,a,o){return e.extend({template:a,initialize:function(i){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=i.routes;this.blogId=n[0];this.entryId=n[1];this.unit=n[2];this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.model=this.collection.get(this.entryId)||null;this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.fetch()}},this));s.setHandler("card:stats:share:show",function(){var e=this.serializeData();s.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this)},onClose:function(){s.removeHandler("card:stats:share:show")},fetch:function(){this.model=new n({id:this.entryId,blogId:this.blogId});this.model.fetch({success:_.bind(function(){var e,t=this.model.toJSON().permalink||null;if(t){t=t.match(/http(?:s)?:\/\/[^\/]+\/(.*)/);e=t.length>1?t[1]:null}if(e){this.statsModel=new o;this.statsModel.fetch({blogId:this.blogId,startDate:i().startOf(this.unit).format(),endDate:i().endOf(this.unit).format(),limit:1,path:e,success:_.bind(function(e){this.loading=!1;this.fetchError=!1;this.pageviews=e.toJSON().items[0]?e.toJSON().items[0].pageviews:0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})}},this),error:_.bind(function(){this.fetchError=!0;this.loading=!1;this.render()},this)})},onRender:function(){this.handleRefetch()},serializeData:function(){var e=this.serializeDataInitialize();if(this.model){e=_.extend(e,this.model.toJSON());s.execute("header:render",e)}var t={day:"Today's",week:"This Week's",month:"This Month's",year:"This Year's"};e.label=t[this.unit]+" access";void 0===e.pageviews&&(e.pageviews=this.pageviews);return e}})});
define("cards/stats/view/post_header",["backbone.marionette","js/views/card/header","js/device","js/commands"],function(e,t){return t.extend({backButtonRoute:function(){return this.card.id},serializeData:function(){var e=t.prototype.serializeData.apply(this);if(this.object){e.post=this.object||{};e.shareEnabled="Publish"===e.post.status}return e}})});
define("hbs!cards/upload/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/title","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,n){function r(e,t){var i,n="";n+="\n";i=e.FileUploadSupport;i=s["if"].call(e,i,{hash:{},inverse:P.noop,fn:P.program(2,a,t)});(i||0===i)&&(n+=i);n+="\n";return n}function a(e,t){var n,r="";r+="\n";n=e;n=P.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",n,s,i);(n||0===n)&&(r+=n);r+="\n";n=e;n=P.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",n,s,i);(n||0===n)&&(r+=n);r+='\n\n<form id="upload-file-form" method="post" name="upload-file">\n<div class="content">\n  ';n=e.uploadedImages;n=s.each.call(e,n,{hash:{},inverse:P.noop,fn:P.program(3,o,t)});(n||0===n)&&(r+=n);r+="\n  ";n=e.uploadError;n=null==n||n===!1?n:n.length;n=s["if"].call(e,n,{hash:{},inverse:P.noop,fn:P.program(5,l,t)});(n||0===n)&&(r+=n);r+="\n  ";n=e.uploadError;n=null==n||n===!1?n:n.length;n=s.unless.call(e,n,{hash:{},inverse:P.noop,fn:P.program(11,u,t)});(n||0===n)&&(r+=n);r+='\n  <div class="upload-file-input-container">\n    <input type="file" id="upload-file-input" accept="image/*"/>\n  </div>\n  <div id="upload-file" class="button-container with-icon">\n    ';n=e.isLabelNeeded;n=s["if"].call(e,n,{hash:{},inverse:P.noop,fn:P.program(14,f,t)});(n||0===n)&&(r+=n);r+='\n    <span class="button-icon icon-plus"></span><span class="button">\n      ';n=e.uploadCompleted;n=s["if"].call(e,n,{hash:{},inverse:P.program(19,g,t),fn:P.program(16,m,t)});(n||0===n)&&(r+=n);r+="\n    </span>\n    ";n=e.isLabelNeeded;n=s["if"].call(e,n,{hash:{},inverse:P.noop,fn:P.program(26,j,t)});(n||0===n)&&(r+=n);r+='\n  </div>\n  <div class="button-container button-container-disabled">\n    <div id="upload-file-uploading" class="upload-file button"></div>\n  </div>\n</div>\n</form>\n';return r}function o(e){var t,s="";s+='\n  <div class="uploaded-image">\n    <img src="';t=e.url;t=typeof t===x?t():t;s+=C(t)+'">\n  </div>\n  ';return s}function l(e,t){var i,n,r="";r+='\n  <div class="error">\n    <div class="upload-image icon-upload-fail"></div>\n    <div class="message">\n      <div class="message-inner">\n        <p class="error-heading">';i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:P.noop,fn:P.program(6,c,t)}):S.call(e,"trans",i,{hash:{},inverse:P.noop,fn:P.program(6,c,t)});(i||0===i)&&(r+=i);r+="</p>\n        ";i=e.uploadError;i=s.each.call(e,i,{hash:{},inverse:P.noop,fn:P.program(8,d,t)});(i||0===i)&&(r+=i);r+="\n      </div>\n    </div>\n  </div>\n  ";return r}function c(){return"Failed Uploading"}function d(e,t){var i,n="";n+="\n          <p>";i=s["if"].call(e,e,{hash:{},inverse:P.noop,fn:P.program(9,h,t)});(i||0===i)&&(n+=i);n+="</p>\n        ";return n}function h(e){var t;t=e.message;t=typeof t===x?t():t;return C(t)}function u(e,t){var i,n="";n+="\n  ";i=e.uploadedImages;i=null==i||i===!1?i:i.length;i=s.unless.call(e,i,{hash:{},inverse:P.noop,fn:P.program(12,p,t)});(i||0===i)&&(n+=i);n+="\n  ";return n}function p(){return'\n  <div class="upload-image icon-upload"></div>\n  '}function f(){return'\n    <label for="upload-file-input">\n    '}function m(e,t){var i,n,r="";r+="\n        ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:P.noop,fn:P.program(17,v,t)}):S.call(e,"trans",i,{hash:{},inverse:P.noop,fn:P.program(17,v,t)});(i||0===i)&&(r+=i);r+="\n      ";return r}function v(){return"More Upload"}function g(e,t){var i,n="";n+="\n        ";i=e.error;i=s["if"].call(e,i,{hash:{},inverse:P.program(23,w,t),fn:P.program(20,b,t)});(i||0===i)&&(n+=i);n+="\n      ";return n}function b(e,t){var i,n,r="";r+="\n          ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:P.noop,fn:P.program(21,_,t)}):S.call(e,"trans",i,{hash:{},inverse:P.noop,fn:P.program(21,_,t)});(i||0===i)&&(r+=i);r+="\n        ";return r}function _(){return"Choose Another Files"}function w(e,t){var i,n,r="";r+="\n          ";i=e.trans;n=s.trans;i=n?n.call(e,i,{hash:{},inverse:P.noop,fn:P.program(24,y,t)}):S.call(e,"trans",i,{hash:{},inverse:P.noop,fn:P.program(24,y,t)});(i||0===i)&&(r+=i);r+="\n        ";return r}function y(){return"Choose Files"}function j(){return"\n    </label>\n    "}s=s||e.helpers;i=i||e.partials;var I,k="",x="function",C=this.escapeExpression,P=this,S=s.helperMissing;I=t.perm;I=s["if"].call(t,I,{hash:{},inverse:P.noop,fn:P.program(1,r,n)});(I||0===I)&&(k+=I);k+="\n";return k});t.registerPartial("cards_upload_templates_dashboard",s);return s});
define("cards/upload/dashboard/dashboard",["js/views/card/itemview","js/mtapi","js/device","hbs!cards/upload/templates/dashboard"],function(e,t,s,i){return e.extend({template:i,ui:{uploadForm:"#upload-file-input",uploadButton:"#upload-file",refreshButton:"#refresh"},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userIsSystemAdmin()||this.userHasPermission("upload");this.FileUploadSupport=this.checkSupport();this.supportedFileAPI=this.checkFileAPISupport();this.isLabelNeeded=this.checkNeedLabel();this.dashboardShowWithPermission(this.perm&&this.FileUploadSupport).done(_.bind(function(){this.setTranslation()},this))},upload:function(e){if(this.perm&&this.ui.uploadForm.val()){this.uploadedImages=[];this.uploadError=[];this.errorImages=[];this.uploading=!0;this.$el.addClass("now-uploading");var s=[];_.each(e,_.bind(function(e){var i=$.Deferred();s.push(i);t.api.uploadAsset(this.blogId,{file:e,autoRenameIfExists:!0,bustCache:(new Date).valueOf()},_.bind(function(t){if(t.error){this.errorImages.push(e);this.uploadError.push(t.error);i.reject()}else{i.resolve();this.uploadedImages.push(t)}this.render()},this))},this));$.when.apply(this,s).done(_.bind(function(){this.uploadError=[];this.uploadCompleted=!0},this)).always(_.bind(function(){this.$el.removeClass("now-uploading");this.uploading=!1;this.render()},this))}},onRender:function(){if(this.perm){this.ui.uploadButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.isLabelNeeded||this.ui.uploadForm.click()},this))},this));this.ui.uploadForm.on("change",_.bind(this.handleUploadFormChange,this))}},handleUploadFormChange:function(e){this.supportedFileAPI?this.upload(e.target.files):this.upload([$("#upload-file-input").get(0)])},checkSupport:function(){return s.isIOS&&s.version&&s.version<6||s.isWindowsPhone?!1:!0},checkFileAPISupport:function(){return window.FileReader&&!s.isWindowsPhone?!0:!1},checkNeedLabel:function(){return s.isIE&&parseInt(s.browserVersion,10)<10?!0:!1},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.title=e.name;e.FileUploadSupport=this.FileUploadSupport;e.loading=!1;e.uploadError=this.uploadError||[];e.uploading=this.uploading?!0:!1;e.uploadCompleted=this.uploadCompleted?!0:!1;e.uploadedImages=this.uploadedImages;e.supportedFileAPI=this.supportedFileAPI;e.isLabelNeeded=this.isLabelNeeded}e.perm=this.perm;e.trans=this.trans;return e}})});
define("json!cards/cards.json",function(){return[{name:"Stats",id:"stats",order:100,dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout"},{id:"post",route:":blog_id/:id/:unit",view:"view/post",header:"view/post_header"}]},{name:"Acception",id:"acception",order:200,dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",route:":blog_id/:id",view:"view/view",header:"view/view_header"}]},{name:"Media Upload",id:"upload",order:300,dashboard:{view:"dashboard/dashboard"}},{name:"Feedbacks",id:"feedbacks",order:400,dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout",route:":type/:blog_id/:id"}]}]});