define("js/views/card/composite",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,i){var s=_.extend({},i.cardItemViewProto,{appendHtml:function(e,t){if(!this.loading){var i=this.getItemViewContainer(e);i.append(t.el)}},handleReadmore:function(e){this.$el.find(".readmore").hammer(this.hammerOpts).on("tap",_.bind(function(t){this.addTapClass(t.currentTarget,_.bind(function(){this.loadingReadmore=!0;this.render();this.fetch(e)},this))},this))},handleItemViewNavigate:function(){this.$el.hammer(this.hammerOpts).on("tap","a",_.bind(function(e){e.preventDefault();e.stopPropagation();var i=$(e.currentTarget).data("route")||null;i&&this.addTapClass(e.currentTarget,function(){t.execute("router:navigate",i)});return!1},this))},fetch:function(e){e=e||{};var t={merge:!0,remove:!1,sort:!0,success:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!1;this.fetchErrorOption=null;e.successCallback&&e.successCallback();this.render()},this),error:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!0;this.fetchErrorOption=e;e.errorCallback&&e.errorCallback();this.render()},this)};t=_.extend(t,e);this.collection.fetch(t)}});return e.CompositeView.extend(s,{cardCompositeViewProto:s})});
define("cards/acception/models/model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,i,s){var n=$.Deferred(),a=s.blogId,r=function(e){e.error?n.reject(e):n.resolve(e)};n.done(s.success);n.fail(s.error);if("read"===e)t.api.getEntry(a,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},r);else if("update"===e){var o=i.toJSON();o.status=s.status||o.status;t.api.updateEntry(a,this.id,o,r)}return n}})});
define("cards/acception/models/collection",["backbone","moment","js/mtapi","cards/acception/models/model"],function(e,t,i,s){return e.Collection.extend({model:s,initialize:function(e){this.blogId=e;this.isSynced=!1},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,s){var n=$.Deferred();n.done(s.success);n.fail(s.error);var a={status:"Review"};s.limit&&(a.limit=parseInt(s.limit,10));s.offset&&(a.offset=parseInt(s.offset,10));i.api.listEntries(this.blogId,a,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("hbs!cards/acception/templates/dashboardItemview",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e){var t,i="";i+='data-route="acception/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===u?t():t;i+=p(t)+"/";t=e.id;t=typeof t===u?t():t;i+=p(t)+'"';return i}function r(e,t){var s,n,a="";a+="\n      ";s=e.assets;n=i.eachOnly;s=n?n.call(e,s,0,{hash:{},inverse:f.noop,fn:f.program(4,o,t)}):m.call(e,"eachOnly",s,0,{hash:{},inverse:f.noop,fn:f.program(4,o,t)});(s||0===s)&&(a+=s);a+="\n    ";return a}function o(e){var t,s,n="";n+='\n      <span class="item-asset image circle" style="background-image:url(';s=i.url;if(s)t=s.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+"); -pie-background: url(";s=i.url;if(s)t=s.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+') no-repeat center center / cover"><span class="circle-inner"></span></span>\n      ';return n}function l(){return'\n      <span class="item-asset no-image circle"><span class="circle-inner"></span></span>\n    '}i=i||e.helpers;var c,d,h="",u="function",p=this.escapeExpression,f=this,m=i.helperMissing;h+="<a ";c=t.id;c=i["if"].call(t,c,{hash:{},inverse:f.noop,fn:f.program(1,a,n)});(c||0===c)&&(h+=c);h+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=i["if"].call(t,c,{hash:{},inverse:f.program(6,l,n),fn:f.program(3,r,n)});(c||0===c)&&(h+=c);h+='\n    </span>\n    <span class="item-title">';d=i.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===u?c():c}h+=p(c)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return h});t.registerPartial("cards_acception_templates_dashboardItemview",i);return i});
define("cards/acception/dashboard/itemview",["backbone.marionette","hbs!cards/acception/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("hbs!cards/acception/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/noItem","hbs!cards/acception/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var n,a="";a+="\n";n=e;n=p.invokePartial(s.js_views_card_partials_title,"js_views_card_partials_title",n,i,s);(n||0===n)&&(a+=n);a+='\n<div class="content content-list">\n  ';n=e;n=p.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,i,s);(n||0===n)&&(a+=n);a+="\n  ";n=e;n=p.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n  ";n=e;n=p.invokePartial(s.js_views_card_partials_noItem,"js_views_card_partials_noItem",n,i,s);(n||0===n)&&(a+=n);a+='\n  <ul id="acceptions-list" class="card-item-list" ';n=e.fetchError;n=i["if"].call(e,n,{hash:{},inverse:p.noop,fn:p.program(2,r,t)});(n||0===n)&&(a+=n);a+=">\n    ";n=e.fetchError;n=i.unless.call(e,n,{hash:{},inverse:p.noop,fn:p.program(4,o,t)});(n||0===n)&&(a+=n);a+="\n  </ul>\n  ";n=e;n=p.invokePartial(s.js_views_card_partials_readmore,"js_views_card_partials_readmore",n,i,s);(n||0===n)&&(a+=n);a+="\n</div>\n";return a}function r(){return'style="display:none"'}function o(e,t){var s;s=e.loading;s=i.unless.call(e,s,{hash:{},inverse:p.noop,fn:p.program(5,l,t)});return s||0===s?s:""}function l(e,t){var s;s=e.count;s=i.unless.call(e,s,{hash:{},inverse:p.noop,fn:p.program(6,c,t)});return s||0===s?s:""}function c(e,t){var s,n="";n+="\n      ";s=e.items;s=i.each.call(e,s,{hash:{},inverse:p.noop,fn:p.program(7,d,t)});(s||0===s)&&(n+=s);n+="\n    ";return n}function d(e){var t,n="";n+='\n      <li class="sample-item">\n      ';t=e;t=p.invokePartial(s.cards_acception_templates_dashboardItemview,"cards_acception_templates_dashboardItemview",t,i,s);(t||0===t)&&(n+=t);n+="\n      </li>\n      ";return n}i=i||e.helpers;s=s||e.partials;var h,u="",p=this;h=t.perm;h=i["if"].call(t,h,{hash:{},inverse:p.noop,fn:p.program(1,a,n)});(h||0===h)&&(u+=h);u+="\n";return u});t.registerPartial("cards_acception_templates_dashboard",i);return i});
define("cards/acception/dashboard/dashboard",["backbone.marionette","js/cache","js/device","js/commands","js/trans","template/helpers/trans","js/views/card/composite","cards/acception/models/collection","cards/acception/dashboard/itemview","hbs!cards/acception/templates/dashboard"],function(e,t,i,s,n,a,r,o,l,c){return r.extend({template:c,itemView:l,itemViewContainer:"#acceptions-list",initialize:function(){r.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userHasPermission("edit_all_posts");this.dashboardShowWithPermission(this.perm).done(_.bind(function(){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},this))},onRender:function(){if(this.perm){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){if(this.trans){var i=t.get("app","staticPath")||t.set("app","staticPath",$("#main-script").data("base")),s={id:null,assets:[{url:i+"/cards/acception/assets/welcome.png"}],title:a(this.trans,"welcome to Loupe! - this card lists the posts waiting for acception")};e.items=[];for(var n=0;3>n;n++)e.items.push(s)}}else e.items=this.collection.toJSON()}}return e}})});
define("hbs!cards/acception/templates/view",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","hbs!js/views/card/partials/noPermission","template/helpers/trans","template/helpers/ifIs"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var n,a="";a+="\n    ";n=e;n=I.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n    ";n=e;n=I.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,i,s);(n||0===n)&&(a+=n);a+="\n    ";n=e.acceptionFailed;n=i["if"].call(e,n,{hash:{},inverse:I.noop,fn:I.program(2,r,t)});(n||0===n)&&(a+=n);a+="\n    ";n=e.id;n=i["if"].call(e,n,{hash:{},inverse:I.noop,fn:I.program(7,c,t)});(n||0===n)&&(a+=n);a+="\n  ";return a}function r(e,t){var s,n,a="";a+='\n        <div class="acception-failed error overlay with-button">\n          <div class="overlay-inner">\n            <span class="message overlay-content">\n              <span class="message-inner overlay-content-inner">\n                ';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:I.noop,fn:I.program(3,o,t)}):k.call(e,"trans",s,{hash:{},inverse:I.noop,fn:I.program(3,o,t)});(s||0===s)&&(a+=s);a+='\n              </span>\n            </span>\n            <div class="button-container">\n              <div class="close-me button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:I.noop,fn:I.program(5,l,t)}):k.call(e,"trans",s,{hash:{},inverse:I.noop,fn:I.program(5,l,t)});(s||0===s)&&(a+=s);a+="</div>\n            </div>\n          </div>\n        </div>\n    ";return a}function o(e){var t,s;s=i.error;if(s)t=s.call(e,{hash:{}});else{t=e.error;t=typeof t===y?t():t}return j(t)}function l(){return"Close"}function c(e,t){var n,a,r,o="";o+="\n      ";n=e.status;a={};a.eq="Review";r=i.ifIs;n=r?r.call(e,n,{hash:a,inverse:I.program(11,u,t),fn:I.program(8,d,t)}):k.call(e,"ifIs",n,{hash:a,inverse:I.program(11,u,t),fn:I.program(8,d,t)});(n||0===n)&&(o+=n);o+="\n      ";n=e;n=I.invokePartial(s.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",n,i,s);(n||0===n)&&(o+=n);o+="\n    ";return o}function d(e,t){var s,n,a="";a+='\n        <div id="accept" class="button-container button-container-top button-container-caution">\n          <div class="button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:I.noop,fn:I.program(9,h,t)}):k.call(e,"trans",s,{hash:{},inverse:I.noop,fn:I.program(9,h,t)});(s||0===s)&&(a+=s);a+="</div>\n        </div>\n      ";return a}function h(){return"Accept"}function u(e,t){var s,n,a,r="";r+="\n        ";s=e.status;n={};n.eq="Publish";a=i.ifIs;s=a?a.call(e,s,{hash:n,inverse:I.noop,fn:I.program(12,p,t)}):k.call(e,"ifIs",s,{hash:n,inverse:I.noop,fn:I.program(12,p,t)});(s||0===s)&&(r+=s);r+="\n      ";return r}function p(e,t){var s,n="";n+='\n        <div class="button-container button-container-top button-container-undo">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';s=e.accepted;s=i["if"].call(e,s,{hash:{},inverse:I.program(16,v,t),fn:I.program(13,f,t)});(s||0===s)&&(n+=s);n+='\n            <span id="accept-undo" class="button-undo">\n              <span class="button-undo-inner icon-undo-arrow"></span>\n            </span>\n          </span>\n        </div>\n        ';return n}function f(e,t){var s,n,a="";a+="\n              ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:I.noop,fn:I.program(14,m,t)}):k.call(e,"trans",s,{hash:{},inverse:I.noop,fn:I.program(14,m,t)});(s||0===s)&&(a+=s);a+="\n            ";return a}function m(){return"Completed Publishing"}function v(e,t){var s,n,a="";a+="\n              ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:I.noop,fn:I.program(17,g,t)}):k.call(e,"trans",s,{hash:{},inverse:I.noop,fn:I.program(17,g,t)});(s||0===s)&&(a+=s);a+="\n            ";return a}function g(){return"Published"}function b(e){var t,n="";n+="\n    ";t=e;t=I.invokePartial(s.js_views_card_partials_noPermission,"js_views_card_partials_noPermission",t,i,s);(t||0===t)&&(n+=t);n+="\n  ";return n}i=i||e.helpers;s=s||e.partials;var _,w="",y="function",j=this.escapeExpression,I=this,k=i.helperMissing;w+='<section id="acception-view" class="card">\n  <div class="content">\n  ';_=t.perm;_=i["if"].call(t,_,{hash:{},inverse:I.program(19,b,n),fn:I.program(1,a,n)});(_||0===_)&&(w+=_);w+="\n  </div>\n</section>\n";return w});t.registerPartial("cards_acception_templates_view",i);return i});
define("cards/acception/view/view",["js/views/card/itemview","js/cache","js/device","js/commands","js/trans","moment","moment.lang","cards/acception/models/collection","cards/acception/models/model","hbs!cards/acception/templates/view"],function(e,t,i,s,n,a,r,o,l,c){return e.extend({template:c,ui:{button:"#accept",undo:"#accept-undo"},initialize:function(i){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=i.routes;this.blogId=n[0];this.entryId=n[1];this.perm=this.userHasPermission("edit_all_posts");if(this.perm){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.model=this.collection.get(this.entryId);this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.model=new l({id:this.entryId});this.fetch()}},this));s.setHandler("card:acception:share:show",_.bind(function(){var e=this.serializeData();s.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))}else this.setTranslation()},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model)},this)})},update:function(e){this.loading=!0;this.render();var t={blogId:this.blogId,status:e,success:_.bind(function(t){this.loading=!1;if("Publish"===e){this.accepted=!0;this.collection.remove(this.model);this.collection.totalResults=this.collection.totalResults-1}else{this.accepted=!0;this.collection.add(this.model);this.collection.totalResults=this.collection.totalResults+1}this.model.set(this.model.parse(t));this.render()},this),error:_.bind(function(e){this.error=e.error&&e.error.message?e.error.message:"Acception failed";this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,t)},onRender:function(){if(this.perm){this.acceptionFailed&&this.$el.find(".close-me").hammer(this.hammerOpts).on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Publish")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Review")},this))},this));this.handleRefetch()}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;if(this.model){e=_.extend(e,this.model.toJSON());s.execute("header:render",e)}e.accepted=this.accepted?!0:!1;e.acceptionFailed=this.acceptionFailed?!0:!1}else e.trans=this.trans;e.error=this.error;return e}})});
define("cards/acception/view/view_header",["backbone.marionette","js/views/card/header"],function(e,t){return t.extend({serializeData:function(){var e=t.prototype.serializeData.apply(this);e.post=this.object||{};"Publish"===e.post.status&&(e.shareEnabled=!0);return e}})});
define("hbs!cards/feedbacks/templates/dashboardItemview",["hbs","handlebars","template/helpers/removeHtml"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e){var t,i="";i+='data-route="feedbacks/comments/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===c?t():t;i+=d(t)+"/";t=e.id;t=typeof t===c?t():t;i+=d(t)+'"';return i}i=i||e.helpers;var r,o,l="",c="function",d=this.escapeExpression,h=this,u=i.helperMissing;l+="<a ";r=t.id;r=i["if"].call(t,r,{hash:{},inverse:h.noop,fn:h.program(1,a,n)});(r||0===r)&&(l+=r);l+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n      <span class="item-asset icon-comment"></span>\n    </span>\n    <span class="item-title">';r=t.body;o=i.removeHtml;r=o?o.call(t,r,{hash:{}}):u.call(t,"removeHtml",r,{hash:{}});l+=d(r)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return l});t.registerPartial("cards_feedbacks_templates_dashboardItemview",i);return i});
define("cards/feedbacks/dashboard/comments_itemview",["backbone.marionette","hbs!cards/feedbacks/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("cards/feedbacks/models/comments_model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,i,s){var n=$.Deferred(),a=s.blogId,r=function(e){e.error?n.reject(e):n.resolve(e)};n.done(s.success);n.fail(s.error);if("read"===e)t.api.getComment(a,this.id,r);else if("update"===e){var o=i.toJSON();o.status=s.status||o.status;t.api.updateComment(a,this.id,o,r)}return n}})});
define("cards/feedbacks/models/comments_collection",["backbone","moment","js/mtapi","cards/feedbacks/models/comments_model"],function(e,t,i,s){return e.Collection.extend({model:s,initialize:function(e){this.blogId=e},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,s){var n=$.Deferred();n.done(s.success);n.fail(s.error);var a={limit:s.limit,entryStatus:"Publish"};s.offset&&(a.offset=s.offset);i.api.listComments(this.blogId,a,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}})});
define("hbs!cards/feedbacks/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/noItem","hbs!cards/feedbacks/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s;s=e.loading;s=i.unless.call(e,s,{hash:{},inverse:h.noop,fn:h.program(2,r,t)});return s||0===s?s:""}function r(e,t){var s;s=e.count;s=i.unless.call(e,s,{hash:{},inverse:h.noop,fn:h.program(3,o,t)});return s||0===s?s:""}function o(e,t){var s,n="";n+="\n      ";s=e.items;s=i.each.call(e,s,{hash:{},inverse:h.noop,fn:h.program(4,l,t)});(s||0===s)&&(n+=s);n+="\n    ";return n}function l(e){var t,n="";n+='\n      <li class="sample-item">\n      ';t=e;t=h.invokePartial(s.cards_feedbacks_templates_dashboardItemview,"cards_feedbacks_templates_dashboardItemview",t,i,s);(t||0===t)&&(n+=t);n+="\n      </li>\n      ";return n}i=i||e.helpers;s=s||e.partials;var c,d="",h=this;c=t;c=h.invokePartial(s.js_views_card_partials_title,"js_views_card_partials_title",c,i,s);(c||0===c)&&(d+=c);d+='\n<div class="content content-list">\n  ';c=t;c=h.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",c,i,s);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",c,i,s);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(s.js_views_card_partials_noItem,"js_views_card_partials_noItem",c,i,s);(c||0===c)&&(d+=c);d+='\n  <ul id="feedback-comments-list" class="card-item-list">\n    ';c=t.fetchError;c=i.unless.call(t,c,{hash:{},inverse:h.noop,fn:h.program(1,a,n)});(c||0===c)&&(d+=c);d+="\n  </ul>\n  ";c=t;c=h.invokePartial(s.js_views_card_partials_readmore,"js_views_card_partials_readmore",c,i,s);(c||0===c)&&(d+=c);d+="\n</div>\n";return d});t.registerPartial("cards_feedbacks_templates_dashboard",i);return i});
define("cards/feedbacks/dashboard/dashboard",["js/cache","js/device","js/commands","template/helpers/trans","cards/feedbacks/models/comments_collection","hbs!cards/feedbacks/templates/dashboard","cards/feedbacks/dashboard/comments_itemview","js/views/card/composite"],function(e,t,i,s,n,a,r,o){return o.extend({template:a,itemView:r,itemViewContainer:"#feedback-comments-list",initialize:function(){o.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.collection=e.get(this.blogId,"feedbacks_comments")||e.set(this.blogId,"feedbacks_comments",new n(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},onRender:function(){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)},serializeData:function(){var e=this.serializeDataInitialize();e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){var t={id:null,body:s(this.trans,"welcome to Loupe! - this card lists the new comments")};e.items=[];for(var i=0;3>i;i++)e.items.push(t)}}return e}})});
define("hbs!cards/feedbacks/templates/content",["hbs","handlebars","template/helpers/formatDate","template/helpers/trans","template/helpers/sanitize"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(){return"Author"}i=i||e.helpers;var r,o,l,c="",d=i.helperMissing,h=this.escapeExpression,u=this,p="function";c+='<ul class="comment-items-list">\n  <li class="date">';r=t.lang;o=t.date;l=i.formatDate;r=l?l.call(t,o,r,{hash:{}}):d.call(t,"formatDate",o,r,{hash:{}});c+=h(r)+'</li>\n  <li class="author">';r=t.trans;l=i.trans;r=l?l.call(t,r,{hash:{},inverse:u.noop,fn:u.program(1,a,n)}):d.call(t,"trans",r,{hash:{},inverse:u.noop,fn:u.program(1,a,n)});(r||0===r)&&(c+=r);c+='<span class="author-name">';r=t.author;r=null==r||r===!1?r:r.displayName;r=typeof r===p?r():r;c+=h(r)+'</span></li>\n  <li class="body">';r=t.body;l=i.sanitize;r=l?l.call(t,r,{hash:{}}):d.call(t,"sanitize",r,{hash:{}});c+=h(r)+"</li>\n</ul>\n";return c});t.registerPartial("cards_feedbacks_templates_content",i);return i});
define("hbs!cards/feedbacks/templates/comment",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!cards/feedbacks/templates/content","template/helpers/trans","template/helpers/ifIs"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s,n,a="";a+='\n      <div class="approve-failed error overlay with-button">\n        <div class="overlay-inner">\n          <span class="message overlay-content">\n            <span class="message-inner overlay-content-inner">';s=e.error;s=null==s||s===!1?s:s.message;s=typeof s===w?s():s;a+=y(s)+'</span>\n          </span>\n          <div class="button-container">\n            <div class="close-me button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:j.noop,fn:j.program(2,r,t)}):I.call(e,"trans",s,{hash:{},inverse:j.noop,fn:j.program(2,r,t)});(s||0===s)&&(a+=s);a+="</div>\n          </div>\n        </div>\n      </div>\n    ";return a}function r(){return"Close"}function o(e,t){var s,n,a,r="";r+="\n      ";s=e.status;n={};n.eq="Pending";a=i.ifIs;s=a?a.call(e,s,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)}):I.call(e,"ifIs",s,{hash:n,inverse:j.program(9,h,t),fn:j.program(5,l,t)});(s||0===s)&&(r+=s);r+="\n    ";return r}function l(e,t){var n,a="";a+="\n        ";n=e.commentApprovePerm;n=i["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(6,c,t)});(n||0===n)&&(a+=n);a+="\n        ";n=e;n=j.invokePartial(s.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,i,s);(n||0===n)&&(a+=n);a+="\n      ";return a}function c(e,t){var s,n,a="";a+='\n        <div id="approve" class="button-container button-container-caution button-container-top">\n          <div class="button">\n            <div class="button-inner">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:j.noop,fn:j.program(7,d,t)}):I.call(e,"trans",s,{hash:{},inverse:j.noop,fn:j.program(7,d,t)});(s||0===s)&&(a+=s);a+="</div>\n          </div>\n        </div>\n        ";return a}function d(){return"Approve"}function h(e,t){var s,n,a,r="";r+="\n        ";s=e.status;n={};n.eq="Approved";a=i.ifIs;s=a?a.call(e,s,{hash:n,inverse:j.noop,fn:j.program(10,u,t)}):I.call(e,"ifIs",s,{hash:n,inverse:j.noop,fn:j.program(10,u,t)});(s||0===s)&&(r+=s);r+="\n      ";return r}function u(e,t){var n,a="";a+='\n        <div class="button-container button-container-undo button-container-top">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';n=e.accepted;n=i["if"].call(e,n,{hash:{},inverse:j.program(14,m,t),fn:j.program(11,p,t)});(n||0===n)&&(a+=n);a+="\n          </span>\n          ";n=e.commentApprovePerm;n=i["if"].call(e,n,{hash:{},inverse:j.noop,fn:j.program(17,g,t)});(n||0===n)&&(a+=n);a+="\n        </div>\n        ";n=e;n=j.invokePartial(s.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",n,i,s);(n||0===n)&&(a+=n);a+="\n        ";return a}function p(e,t){var s,n,a="";a+="\n              ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:j.noop,fn:j.program(12,f,t)}):I.call(e,"trans",s,{hash:{},inverse:j.noop,fn:j.program(12,f,t)});(s||0===s)&&(a+=s);a+="\n            ";return a}function f(){return"Completed Approvement"}function m(e,t){var s,n,a="";a+="\n              ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:j.noop,fn:j.program(15,v,t)}):I.call(e,"trans",s,{hash:{},inverse:j.noop,fn:j.program(15,v,t)});(s||0===s)&&(a+=s);a+="\n            ";return a}function v(){return"Approved"}function g(){return'\n          <span id="comment-undo" class="button-undo">\n            <span class="button-undo-inner icon-undo-arrow"></span>\n          </span>\n          '}i=i||e.helpers;s=s||e.partials;var b,_="",w="function",y=this.escapeExpression,j=this,I=i.helperMissing;_+='  <div class="comment-container">\n    ';b=t;b=j.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",b,i,s);(b||0===b)&&(_+=b);_+="\n    ";b=t;b=j.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",b,i,s);(b||0===b)&&(_+=b);_+="\n    ";b=t.acceptionFailed;b=i["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(1,a,n)});(b||0===b)&&(_+=b);_+="\n    ";b=t.status;b=i["if"].call(t,b,{hash:{},inverse:j.noop,fn:j.program(4,o,n)});(b||0===b)&&(_+=b);_+="\n  </div>\n";return _});t.registerPartial("cards_feedbacks_templates_comment",i);return i});
define("cards/feedbacks/view/comment",["js/views/card/itemview","js/commands","hbs!cards/feedbacks/templates/comment"],function(e,t,i){return e.extend({template:i,ui:{button:"#approve",undo:"#comment-undo"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.fetchError=t.fetchError;if(!this.fetchError){this.collection=t.collection;this.model=t.model;this.entryModel=t.entryModel;this.commentApprovePerm=!1;var i=this.entryModel.toJSON();"Publish"===i.status&&(this.userIsSystemAdmin()||this.userHasPermission("manage_feedback")||this.userHasPermission("edit_all_posts")?this.commentApprovePerm=!0:i.author&&i.author.displayName===this.user.name&&this.userHasPermission("publish_post")&&(this.commentApprovePerm=!0))}this.loading=!1;this.setTranslation()},update:function(e){this.loading=!0;this.render();var i={blogId:this.blogId,status:e,success:_.bind(function(e){this.loading=!1;this.accepted=!0;this.model.set(this.model.parse(e));this.render();t.execute("card:feedbacks:reply:render")},this),error:_.bind(function(e){this.error=e.error;this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,i)},onRender:function(){this.acceptionFailed&&this.$el.find(".close-me").hammer().on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Approved")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Pending")},this))},this))},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));e.accepted=this.accepted;e.acceptionFailed=this.acceptionFailed;e.error=this.error;e.commentApprovePerm=this.commentApprovePerm;return e}})});
define("hbs!cards/feedbacks/templates/entry",["hbs","handlebars","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/entryItemsList","template/helpers/trans","template/helpers/ifIs"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(){return"The Post Commented"}function r(e,t){var s,n,a,r="";r+="\n  ";s=e.status;n={};n.eq="Publish";a=i.ifIs;s=a?a.call(e,s,{hash:n,inverse:p.program(6,l,t),fn:p.program(4,o,t)}):f.call(e,"ifIs",s,{hash:n,inverse:p.program(6,l,t),fn:p.program(4,o,t)});(s||0===s)&&(r+=s);r+="\n  ";return r}function o(e){var t,n="";n+="\n    ";t=e;t=p.invokePartial(s.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",t,i,s);(t||0===t)&&(n+=t);n+="\n  ";return n}function l(e,t){var s,n,a="";a+='\n  <div class="error overlay">\n    <div class="overlay-inner">\n      <span class="message overlay-content">\n        <span class="message-inner overlay-content-inner">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:p.noop,fn:p.program(7,c,t)}):f.call(e,"trans",s,{hash:{},inverse:p.noop,fn:p.program(7,c,t)});(s||0===s)&&(a+=s);a+="</span>\n      </span>\n    </div>\n  </div>\n  ";return a}function c(){return"The post is not published"}i=i||e.helpers;s=s||e.partials;var d,h,u="",p=this,f=i.helperMissing;u+="<header>\n<h1>";d=t.trans;h=i.trans;d=h?h.call(t,d,{hash:{},inverse:p.noop,fn:p.program(1,a,n)}):f.call(t,"trans",d,{hash:{},inverse:p.noop,fn:p.program(1,a,n)});(d||0===d)&&(u+=d);u+='</h1>\n</header>\n<div class="content">\n  ';d=t;d=p.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",d,i,s);(d||0===d)&&(u+=d);u+="\n  ";d=t;d=p.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",d,i,s);(d||0===d)&&(u+=d);u+="\n  ";d=t.id;d=i["if"].call(t,d,{hash:{},inverse:p.noop,fn:p.program(3,r,n)});(d||0===d)&&(u+=d);u+="\n</div>\n";return u});t.registerPartial("cards_feedbacks_templates_entry",i);return i});
define("cards/feedbacks/view/entry",["js/views/card/itemview","hbs!cards/feedbacks/templates/entry"],function(e,t){return e.extend({template:t,initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.fetchError=t.fetchError||!1;this.fetchError||(this.model=t.entryModel);this.loading=!1;this.setTranslation()},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));return e}})});
define("js/views/card/itemview_layout",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,i){var s=_.extend({},i.cardItemViewProto,{});return e.Layout.extend(s,{cardItemViewLayoutProto:s})});
define("js/models/entry",["backbone","js/mtapi"],function(e,t){return e.Model.extend({initialize:function(e){this.blogId=e.blogId},sync:function(e,i,s){if("read"===e){var n=$.Deferred();n.done(s.success);n.fail(s.error);t.api.getEntry(this.blogId,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},function(e){e.error?n.reject(e):n.resolve(e)});return n}}})});
define("js/collections/entries",["backbone","js/models/entry"],function(e,t){return e.Collection.extend({model:t})});
define("hbs!cards/feedbacks/templates/layout",["hbs","handlebars","hbs!js/views/card/partials/loading"],function(e,t){var i=t.template(function(e,t,i,s){i=i||e.helpers;s=s||e.partials;var n,a="",r=this;a+='<section id="feedbacks-comment-view" class="card">\n  <div class="content">\n    ';n=t;n=r.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+='\n    <div id="comment"></div>\n    <div id="reply"></div>\n</section>\n<section id="feedbacks-comment-entry" class="card">\n  <div class="content">\n    ';n=t;n=r.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n  </div>\n</section>\n\n";return a});t.registerPartial("cards_feedbacks_templates_layout",i);return i});
define("hbs!cards/feedbacks/templates/reply",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/trans"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s,n="";n+="\n";s=e.commentIsApproved;s=i["if"].call(e,s,{hash:{},inverse:w.noop,fn:w.program(2,r,t)});(s||0===s)&&(n+=s);n+="\n";return n}function r(e,t){var n,a="";a+="\n  ";n=e;n=w.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n  ";n=e.initial;n=i["if"].call(e,n,{hash:{},inverse:w.program(6,c,t),fn:w.program(3,o,t)});(n||0===n)&&(a+=n);a+="\n";return a}function o(e,t){var s,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(4,l,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(4,l,t)});(s||0===s)&&(a+=s);a+="</div>\n      </div>\n    </div>\n  </div>\n  ";return a}function l(){return"Reply"}function c(e,t){var s,n="";n+="\n  ";s=e.replied;s=i["if"].call(e,s,{hash:{},inverse:w.noop,fn:w.program(7,d,t)});(s||0===s)&&(n+=s);n+="\n  ";s=e.form;s=i["if"].call(e,s,{hash:{},inverse:w.noop,fn:w.program(12,p,t)});(s||0===s)&&(n+=s);n+="\n  ";return n}function d(e,t){var s,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(8,h,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(8,h,t)});(s||0===s)&&(a+=s);a+='</div>\n      </div>\n    </div>\n  </div>\n  <div id="reply-textarea-container">\n    <div class="reply-complete-message message">\n      <div class="message-inner">\n        <span class="button-icon icon-check"></span>\n        <span id="accepted">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(10,u,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(10,u,t)});(s||0===s)&&(a+=s);a+="</span>\n      </div>\n    </div>\n    <div>";n=i.body;if(n)s=n.call(e,{hash:{}});else{s=e.body;s=typeof s===j?s():s}a+=I(s)+"</div>\n  </div>\n  ";return a}function h(){return"Another Comment"}function u(){return"Posted comment successfully"}function p(e,t){var s,n,a="";a+='\n  <div id="reply-container">\n    <div class="reply-button-container button-container button-container-disabled">\n      <div id="reply-disabled-button" class="button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(13,f,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(13,f,t)});(s||0===s)&&(a+=s);a+='</div>\n    </div>\n  </div>\n  <div class="reply-textarea-container">\n    ';s=e.error;s=i["if"].call(e,s,{hash:{},inverse:w.noop,fn:w.program(15,m,t)});(s||0===s)&&(a+=s);a+='\n    <textarea id="reply-textarea">';n=i.body;if(n)s=n.call(e,{hash:{}});else{s=e.body;s=typeof s===j?s():s}a+=I(s)+'</textarea>\n    <div class="button-container">\n      <div id="do-reply-button" class="button">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(18,g,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(18,g,t)});(s||0===s)&&(a+=s);a+="</div>\n    </div>\n  </div>\n  ";return a}function f(){return"Reply"}function m(e,t){var s,n,a="";a+='\n    <div class="error">\n      <span class="message">\n        <span class="message-inner">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:w.noop,fn:w.program(16,v,t)}):y.call(e,"trans",s,{hash:{},inverse:w.noop,fn:w.program(16,v,t)});(s||0===s)&&(a+=s);a+="</span>\n      </span>\n    </div>\n    ";return a}function v(e){var t,s;s=i.error;if(s)t=s.call(e,{hash:{}});else{t=e.error;t=typeof t===j?t():t}return I(t)}function g(){return"Post The Reply"}i=i||e.helpers;s=s||e.partials;var b,_="",w=this,y=i.helperMissing,j="function",I=this.escapeExpression;b=t.entryIsPublished;b=i["if"].call(t,b,{hash:{},inverse:w.noop,fn:w.program(1,a,n)});(b||0===b)&&(_+=b);_+="\n";return _});t.registerPartial("cards_feedbacks_templates_reply",i);return i});
define("cards/feedbacks/view/reply",["js/views/card/itemview","js/mtapi","js/commands","moment","moment.lang","cards/feedbacks/models/comments_model","hbs!cards/feedbacks/templates/reply"],function(e,t,i,s,n,a,r){return e.extend({template:r,ui:{replyButton:"#reply-button",doReplyButton:"#do-reply-button",replyTextarea:"#reply-textarea"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.blogId=t.blogId;this.commentId=t.commentId;this.model=t.model;this.collection=t.collection;this.entryModel=t.entryModel;this.initial=!0;this.loading=!1;this.setTranslation();i.setHandler("card:feedbacks:reply:render",this.render)},commentIsApproved:function(){var e=this.model.toJSON();return"Approved"===e.status},entryIsPublished:function(){var e=this.entryModel.toJSON();return"Publish"===e.status},onRender:function(){if(this.entryIsPublished()&&this.commentIsApproved()){this.ui.replyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.initial=!1;this.form=!0;this.body=!1;this.replied=!1;this.loading=!1;this.render()},this))},this));this.ui.doReplyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){var e=this.ui.replyTextarea.val(),i=this.model.toJSON();if(e.length){var n={author:this.user,entry:i.entry,blog:i.blog,parent:this.commentId,date:s().format(),body:e};this.body=e;this.loading=!0;this.render();t.api.createReplyComment(this.blogId,i.entry.id,this.commentId,n,_.bind(function(t){if(t.error){this.form=!0;this.replied=!1;this.body=e;this.loading=!1;this.error=t.error&&t.error.message?t.error.message:"request failed";this.render()}else{this.form=!1;this.replied=!0;this.body=e;this.loading=!1;var i=new a;i.set(t);this.collection.unshift(i);this.render()}},this))}},this))},this))}},serializeData:function(){var e=this.serializeDataInitialize();e=_.extend(e,this.model.toJSON());e.commentIsApproved=this.commentIsApproved();e.entryIsPublished=this.entryIsPublished();e.error=this.error;e.initial=this.initial;e.form=this.form;e.replied=this.replied;e.body=this.body||"";return e}})});
define("cards/feedbacks/view/layout",["js/views/card/itemview_layout","js/cache","cards/feedbacks/models/comments_collection","cards/feedbacks/models/comments_model","js/collections/entries","js/models/entry","hbs!cards/feedbacks/templates/layout","cards/feedbacks/view/comment","cards/feedbacks/view/reply","cards/feedbacks/view/entry"],function(e,t,i,s,n,a,r,o,l,c){return e.extend({template:r,regions:{comment:"#comment",reply:"#reply",entry:"#feedbacks-comment-entry"},initialize:function(n){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var a=n.routes;this.options=n;this.type=a[0];this.blogId=a[1];this.commentId=a[2];this.collection=t.get(this.blogId,"feedbacks_comments")||t.set(this.blogId,"feedbacks_comments",new i(this.blogId));this.model=this.collection.get(this.commentId);this.setTranslation(_.bind(function(){if(this.model)this.fetchEntry();else{this.render();this.model=new s({id:this.commentId});this.fetch()}},this))},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model);this.loading=!0;this.fetchEntry()},this)})},fetchEntry:function(){var e=this.model.toJSON(),i=e.entry?e.entry.id:null;this.entryCollection=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));this.entryModel=this.entryCollection.get(i);if(this.entryModel){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.build()},this),0)}else{this.entryModel=new a({blogId:this.blogId,id:i});var s={success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.entryCollection.add(this.entryModel);this.build()},this),0)},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)};this.entryModel.fetch(s)}},build:function(){this.model.toJSON();var e=_.extend(this.options,{model:this.model,collection:this.collection,type:this.type,blogId:this.blogId,commentId:this.commentId,entryModel:this.entryModel});this.comment.show(new o(e));this.reply.show(new l(e));this.entry.show(new c(e))},onRender:function(){if(this.fetchError){this.handleRefetch();var e=_.extend(this.options,{fetchError:this.fetchError});this.comment.show(new o(e));this.entry.show(new c(e))}},serializeData:function(){var e=this.serializeDataInitialize();return e}})});
define("js/mtapi/stats_provider",["js/cache","js/mtapi"],function(e,t){return function(i){var s=$.Deferred(),n=e.get(i,"statsProvider")||null;n?s.resolve({id:n}):t.api.getStatsProvider(i,{bustCache:(new Date).valueOf()},function(t){if(t&&!t.error)if(t.id){e.set(i,"statsProvider",t);s.resolve(t)}else s.reject(t);else s.reject(t)});return s}});
define("cards/stats/models/latest_page_views",["backbone","moment","js/mtapi"],function(e,t,i){return e.Model.extend({isSynced:!1,initialize:function(e){this.blogId=e},sync:function(e,s,n){if("read"===e){var a=$.Deferred(),r=$.Deferred(),o={startDate:t().subtract("days",6).format(),endDate:t().format()};i.api.listStatsPageviewsForDate(this.blogId,o,_.bind(function(e){e.error?a.reject(e):a.resolve(e)},this));i.api.listStatsVisitsForDate(this.blogId,o,_.bind(function(e){e.error?r.reject(e):r.resolve(e)},this));$.when(a,r).then(_.bind(function(e,t){this.isSynced=!0;n.success({pageviews:e,visits:t},n)},this),n.error);return[a,r]}}})});
define("hbs!cards/stats/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","template/helpers/formatDate","template/helpers/todaysPageViews"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e){var t,s,n,a="";a+='<div class="today">';t=e.lang;s=e.today;n=i.formatDate;t=n?n.call(e,s,t,{hash:{}}):d.call(e,"formatDate",s,t,{hash:{}});a+=h(t)+"</div>";return a}function r(e,t){var s,n="";n+="\n    ";s=e.pageviews;s=null==s||s===!1?s:s.items;s=i["if"].call(e,s,{hash:{},inverse:p.noop,fn:p.program(4,o,t)});(s||0===s)&&(n+=s);n+="\n    ";return n}function o(e){var t,s,n="";n+='\n    <div class="todays-pageviews">';t=e.pageviews;t=null==t||t===!1?t:t.items;s=i.todaysPageViews;t=s?s.call(e,t,{hash:{}}):d.call(e,"todaysPageViews",t,{hash:{}});n+=h(t)+'\n      <span class="diff-icon ';s=i.diffIcon;if(s)t=s.call(e,{hash:{}});else{t=e.diffIcon;t=typeof t===u?t():t}n+=h(t)+'"></span>\n    </div>\n    ';return n}i=i||e.helpers;s=s||e.partials;var l,c="",d=i.helperMissing,h=this.escapeExpression,u="function",p=this;l=t;l=p.invokePartial(s.js_views_card_partials_title,"js_views_card_partials_title",l,i,s);(l||0===l)&&(c+=l);c+='\n<div class="content">\n  ';l=t;l=p.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",l,i,s);(l||0===l)&&(c+=l);c+="\n  ";l=t.today;l=i["if"].call(t,l,{hash:{},inverse:p.noop,fn:p.program(1,a,n)});(l||0===l)&&(c+=l);c+="\n\n  ";l=t;l=p.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,i,s);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=p.invokePartial(s.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,i,s);(l||0===l)&&(c+=l);c+='\n\n  <div class="stats-dashboard-graph-container">\n    ';l=t.pageviews;l=i["if"].call(t,l,{hash:{},inverse:p.noop,fn:p.program(3,r,n)});(l||0===l)&&(c+=l);c+='\n    <div id="stats-dashboard-graph"></div>\n  </div>\n</div>\n';return c});t.registerPartial("cards_stats_templates_dashboard",i);return i});
define("cards/stats/dashboard/dashboard",["js/cache","js/commands","js/device","js/mtapi/stats_provider","js/views/card/itemview","cards/stats/models/latest_page_views","hbs!cards/stats/templates/dashboard","mtchart"],function(e,t,i,s,n,a,r,o){return n.extend({template:r,initialize:function(){n.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=e.get(this.blogId,"stats_latest_page_views")||e.set(this.blogId,"stats_latest_page_views",new a(this.blogId));this.setTranslation();if(this.model.isSynced){this.loading=!1;this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")}else{var t=_.isFunction(s)?s(this.blogId):s;t.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));t.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},fetch:function(){n.prototype.fetch.call(this,{successCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")},this),errorCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).off("tap",this.navigatePage);this.$el.removeClass("tap-enabled")},this)})},navigatePage:function(){t.execute("router:navigate","stats")},onRender:function(){this.handleRefetch();var t,s,n,a,r,l,c,d,h,u=[];if(this.model.isSynced){t=this.model.toJSON();s=t.pageviews.items;n=t.visits.items;for(l=0,c=s.length;c>l;l++){a=s[l];r=n[l];u.push({x:a.date,y:r.visits,y1:a.pageviews})}d={type:"easel.mix",data:u,yLength:2,mix:[{type:"bar",yLength:1,chartColors:["#cccccc"],chartColorsAlpha:[.5]},{type:"motionLine",yLength:1,lineWidth:8,chartColors:["#55a038"],drawPointer:i.isAndroid?!1:!0,pointerColors:["#ea4b29"]}],fallback:{test:"canvas",type:"morris.bar",data:u,yLength:1,chartColors:["#55a038"],gridLineColor:"#f3f3f5",gridTextColor:"#f3f3f5",hideHover:"always"},height:170};h={length:7,unit:"daily"};new o.Graph(d,h).trigger("APPEND_TO",this.$el.find("#stats-dashboard-graph"))}else if(this.providerIsNotAvailable){var p=e.get("app","staticPath")||e.set("app","staticPath",$("#main-script").data("base"));this.$el.find("#stats-dashboard-graph").append('<img src="'+p+'/cards/stats/assets/welcome.png" class="stats-welcome" height="170">')}},serializeData:function(){var e=this.serializeDataInitialize();e.title="Today's Page Views";if(!this.loading){e=_.extend({},e,this.model.toJSON());if(e.pageviews&&e.pageviews.items){var t=e.pageviews.items.length;if(t>1){var i=parseInt(e.pageviews.items[t-2].pageviews,10),s=parseInt(e.pageviews.items[t-1].pageviews,10);this.diff=s-i;e.diffIcon=this.diff<0?"icon-arrow-down-right":this.diff>0?"icon-arrow-up-right":"icon-arrow-right"}}else if(this.providerIsNotAvailable){e.pageviews={items:[{pageviews:77e4}]};e.diffIcon="icon-arrow-up-right"}e.today=(new Date).valueOf()}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e}})});
define("cards/stats/models/top_articles",["backbone","js/mtapi","moment"],function(e,t){return e.Model.extend({isSynced:!1,sync:function(e,i,s){if("read"===e){var n=$.Deferred(),a={startDate:s.startDate,endDate:s.endDate,limit:s.limit};s.path&&(a.path=s.path);n.done(s.success);n.fail(s.error);t.api.listStatsPageviewsForPath(s.blogId,a,_.bind(function(e){if(e.error)n.reject(e);else{this.isSynced=!0;n.resolve(e)}},this));return n}}})});
define("cards/stats/models/top_articles_itemview",["backbone","js/cache","js/mtapi","js/models/entry","js/collections/entries"],function(e,t,i,s,n){return e.Model.extend({initialize:function(e){this.blogId=e.blogId;this.num=e.num;this.pageviews=e.pageviews;this.unit=e.unit},sync:function(e,i,a){if("read"===e){var r=$.Deferred();r.done(a.success);r.fail(a.error);var o=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new n(this.blogId));if(o.get(this.id))r.resolve(o.get(this.id).toJSON());else{var l=new s({id:this.id,blogId:this.blogId});l.fetch({success:function(){o.add(l);r.resolve(l.toJSON())},error:function(){r.reject(l.toJSON())}})}return r}}})});
define("cards/stats/models/top_articles_itemview_collection",["backbone","js/mtapi","cards/stats/models/top_articles_itemview"],function(e,t,i){return e.Collection.extend({model:i,comparator:function(e){return-1*parseInt(e.get("pageviews"),10)}})});
define("hbs!cards/stats/templates/layout",["hbs","handlebars"],function(e,t){var i=t.template(function(e,t,i){i=i||e.helpers;return'<section id="recent-access" class="card"></section>\n<section id="top-articles" class="top-articles card">\n</section>\n<section id="top-articles-weekly" class="top-articles card">\n</section>\n'});t.registerPartial("cards_stats_templates_layout",i);return i});
define("hbs!cards/stats/templates/recent_access",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable"],function(e,t){var i=t.template(function(e,t,i,s){i=i||e.helpers;s=s||e.partials;var n,a="",r=this;n=t;n=r.invokePartial(s.js_views_card_partials_title,"js_views_card_partials_title",n,i,s);(n||0===n)&&(a+=n);a+='\n<div class="content">\n  ';n=t;n=r.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",n,i,s);(n||0===n)&&(a+=n);a+="\n  ";n=t;n=r.invokePartial(s.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",n,i,s);(n||0===n)&&(a+=n);a+="\n</div>\n";return a});t.registerPartial("cards_stats_templates_recent_access",i);return i});
define("cards/stats/view/recent_access",["js/views/card/itemview","js/cache","js/mtapi/stats_provider","cards/stats/models/latest_page_views","hbs!cards/stats/templates/recent_access","mtchart"],function(e,t,i,s,n,a){return e.extend({template:n,serializeData:function(){var e=this.serializeDataInitialize();e.title="Access In Last Week";this.loading||(e=_.extend(e,this.model.toJSON()));e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=t.get(this.blogId,"stats_latest_page_views")||t.set(this.blogId,"stats_latest_page_views",new s(this.blogId));this.setTranslation();if(this.model.isSynced)this.loading=!1;else{var n=i(this.blogId);n.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));n.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},onRender:function(){this.handleRefetch();if(this.model.isSynced){var e=this.$el.find(".content"),t=this.model.toJSON().pageviews.items,i=_.map(t,function(e){return{x:e.date,y:e.pageviews}}),s=_.map(t,function(e){var t=e.pageviews;e.pageviews>=1e6?t=Math.round(e.pageviews/1e6)+"M":e.pageviews>=1e3&&(t=Math.round(e.pageviews/1e3)+"K");return t}),n={type:"css.horizontalBar",data:i,yLength:1,yLabel:s,autoSized:!1,pointSize:6,barColor:"#efb330",barBackgroundColor:"#362c35",dateColor:"#444444",dateColorSaturday:"#4079e6",dateColorSunday:"#ec4b05",dateLabelSize:16,labelSize:22,labelColor:"#ffffff",showDate:!0,barWidth:40,barMarginLeft:35,barInterval:10},r={dataType:"timeline",unit:"daily",length:7};new a.Graph(n,r).trigger("APPEND_TO",e)}}})});
define("hbs!cards/stats/templates/itemviewContent",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s,n,a="";a+="\n      ";s=e.assets;n=i.eachOnly;s=n?n.call(e,s,0,{hash:{},inverse:f.noop,fn:f.program(2,r,t)}):m.call(e,"eachOnly",s,0,{hash:{},inverse:f.noop,fn:f.program(2,r,t)});(s||0===s)&&(a+=s);a+="\n    ";return a}function r(e){var t,s,n="";n+='\n      <div class="item-asset image circle" style="background-image:url(';s=i.url;if(s)t=s.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+"); -pie-background: url(";s=i.url;if(s)t=s.call(e,{hash:{}});else{t=e.url;t=typeof t===u?t():t}n+=p(t)+') no-repeat center center / cover"><div class="circle-inner"></div></div>\n      ';return n}function o(){return'\n      <div class="item-asset no-image circle"><div class="circle-inner"></div></div>\n    '}function l(){return'<div class="item-arrow icon-arrow"></div>'}i=i||e.helpers;var c,d,h="",u="function",p=this.escapeExpression,f=this,m=i.helperMissing;h+='<div class="item-num">';c=t.num;c=typeof c===u?c():c;h+=p(c)+'</div>\n<div class="item-content">\n  <div class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=i["if"].call(t,c,{hash:{},inverse:f.program(4,o,n),fn:f.program(1,a,n)});(c||0===c)&&(h+=c);h+='\n  </div>\n  <div class="item-title">';d=i.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===u?c():c}h+=p(c)+"</div>\n  ";c=t.arrow;c=i["if"].call(t,c,{hash:{},inverse:f.noop,fn:f.program(6,l,n)});(c||0===c)&&(h+=c);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_itemviewContent",i);return i});
define("hbs!cards/stats/templates/top_articles_itemview",["hbs","handlebars","hbs!cards/stats/templates/itemviewContent"],function(e,t){var i=t.template(function(e,t,i,s){i=i||e.helpers;s=s||e.partials;var n,a,r="",o="function",l=this.escapeExpression,c=this;r+='<a data-route="stats/';a=i.blogId;if(a)n=a.call(t,{hash:{}});else{n=t.blogId;n=typeof n===o?n():n}r+=l(n)+"/";a=i.id;if(a)n=a.call(t,{hash:{}});else{n=t.id;n=typeof n===o?n():n}r+=l(n)+"/";a=i.unit;if(a)n=a.call(t,{hash:{}});else{n=t.unit;n=typeof n===o?n():n}r+=l(n)+'" class="item-container">\n  ';n=t;n=c.invokePartial(s.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",n,i,s);(n||0===n)&&(r+=n);r+="\n</a>\n";return r});t.registerPartial("cards_stats_templates_top_articles_itemview",i);return i});
define("cards/stats/view/top_articles_itemview",["backbone.marionette","cards/stats/models/top_articles_itemview","hbs!cards/stats/templates/top_articles_itemview"],function(e,t,i){return e.ItemView.extend({template:i})});
define("hbs!cards/stats/templates/top_articles",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","hbs!js/views/card/partials/noItem","hbs!cards/stats/templates/itemviewContent","template/helpers/trans"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e){var t,s;s=i.title;if(s)t=s.call(e,{hash:{}});else{t=e.title;t=typeof t===u?t():t}return t||0===t?t:""}function r(e){var t,n="";n+='\n    <li id="eid-';t=e.entry;t=null==t||t===!1?t:t.id;t=typeof t===u?t():t;n+=p(t)+'" data-pageviews="';t=e.pageviews;t=typeof t===u?t():t;n+=p(t)+'">\n      <div class="item-container">\n        <div class="content-loading"></div>\n        ';t=e;t=f.invokePartial(s.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",t,i,s);(t||0===t)&&(n+=t);n+="\n      </div>\n    </li>\n  ";return n}function o(){return'\n  <div class="item-loading"></div>\n  '}i=i||e.helpers;s=s||e.partials;var l,c,d,h="",u="function",p=this.escapeExpression,f=this,m=i.helperMissing;h+='<header>\n<h1 id="';d=i.name;if(d)l=d.call(t,{hash:{}});else{l=t.name;l=typeof l===u?l():l}h+=p(l)+'-title">';l=t.numberOfArticles;c=t.trans;d=i.trans;l=d?d.call(t,c,l,{hash:{},inverse:f.noop,fn:f.program(1,a,n)}):m.call(t,"trans",c,l,{hash:{},inverse:f.noop,fn:f.program(1,a,n)});(l||0===l)&&(h+=l);h+='</h1>\n</header>\n<div class="content content-list">\n  ';l=t;l=f.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",l,i,s);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,i,s);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(s.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,i,s);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=f.invokePartial(s.js_views_card_partials_noItem,"js_views_card_partials_noItem",l,i,s);(l||0===l)&&(h+=l);h+='\n  <ul id="top-articles-list-';d=i.unit;if(d)l=d.call(t,{hash:{}});else{l=t.unit;l=typeof l===u?l():l}h+=p(l)+'" class="card-item-list top-articles-list">\n  ';l=t.items;l=i.each.call(t,l,{hash:{},inverse:f.noop,fn:f.program(3,r,n)});(l||0===l)&&(h+=l);h+="\n  </ul>\n  ";l=t.itemLoading;l=i["if"].call(t,l,{hash:{},inverse:f.noop,fn:f.program(5,o,n)});(l||0===l)&&(h+=l);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_top_articles",i);return i});
define("cards/stats/view/top_articles",["js/views/card/composite","js/cache","moment","moment.lang","js/mtapi/stats_provider","cards/stats/models/top_articles","cards/stats/models/top_articles_itemview_collection","cards/stats/models/top_articles_itemview","cards/stats/view/top_articles_itemview","hbs!cards/stats/templates/top_articles"],function(e,t,i,s,n,a,r,o,l,c){return e.extend({numberOfArticles:3,template:c,itemView:l,itemViewContainer:"#top-articles-list-day",appendHtml:function(e,t){this.getItemViewContainer(e).find("#eid-"+t.model.id).html(t.el)},serializeData:function(){var e=this.serializeDataInitialize(),t=[];if(!this.loading){e=_.extend(e,this.model.toJSON());if(e.items&&e.items.length){var i=this.numberOfArticles,s=_.filter(e.items,function(e){return e.entry&&e.entry.id})||[];e.count=s.length;_.each(s,function(e){var s=e.entry?e.entry.id:null;if(i&&s){i-=1;var n=this.numberOfArticles-i;e.num=n;t.push(e);var a=this.collection.get(s);this.dfd.done(_.bind(function(){if(!a){a=new o({id:s,blogId:this.blogId,num:n,pageviews:e.pageviews,unit:this.unit});a.fetch({success:_.bind(function(){a.set({arrow:!0});this.collection.add(a,{sort:!0})},this),error:_.bind(function(){a.set({title:e.title});this.collection.add(a,{sort:!0})},this)})}},this))}},this);e.items=t}}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;e.itemLoading=this.itemLoading?!0:!1;var n={day:"Day",week:"Week",month:"Month",year:"Year"};e.title="Top [_1] of The "+n[this.unit];e.numberOfArticles=this.numberOfArticles;e.unit=this.unit;return e},fetch:function(){this.model.fetch({blogId:this.blogId,startDate:i().startOf(this.unit).format(),endDate:i().endOf(this.unit).format(),limit:10,success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.itemLoading=!0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})},initialize:function(i){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.unit=i.unit||"day";this.model=t.get(this.blogId,"toparticle_"+this.unit+"_model")||t.set(this.blogId,"toparticle_"+this.unit+"_model",new a);this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.setTranslation();this.dfd=$.Deferred();if(this.model.isSynced){this.loading=!1;this.render()}else{var s=n(this.blogId);s.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));s.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}this.handleItemViewNavigate()},onRender:function(){this.handleRefetch();!this.loading&&this.itemLoading&&this.dfd.resolve()}})});
define("cards/stats/view/top_articles_weekly",["cards/stats/view/top_articles"],function(e){return e.extend({itemViewContainer:"#top-articles-list-week"})});
define("cards/stats/view/layout",["backbone.marionette","js/commands","hbs!cards/stats/templates/layout","cards/stats/view/recent_access","cards/stats/view/top_articles","cards/stats/view/top_articles_weekly"],function(e,t,i,s,n,a){return e.Layout.extend({template:i,regions:{recentAccess:"#recent-access",topArticles:"#top-articles",topArticlesWeekly:"#top-articles-weekly"},initialize:function(e){this.options=e},onRender:function(){this.recentAccess.show(new s(this.options));this.topArticles.show(new n(_.extend({},this.options,{unit:"day"})));this.topArticlesWeekly.show(new a(_.extend({},this.options,{unit:"week"})))}})});
define("hbs!cards/stats/templates/post",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","template/helpers/ifIs","template/helpers/trans"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s,n,a,o="";o+="\n    ";s=e.status;n={};n.eq="Publish";a=i.ifIs;s=a?a.call(e,s,{hash:n,inverse:h.noop,fn:h.program(2,r,t)}):u.call(e,"ifIs",s,{hash:n,inverse:h.noop,fn:h.program(2,r,t)});(s||0===s)&&(o+=s);o+="\n  ";return o}function r(e,t){var n,a,r="";r+='\n      <div class="pageviews">\n        <span class="label"><span class="label-inner">';n=e.trans;a=i.trans;n=a?a.call(e,n,{hash:{},inverse:h.noop,fn:h.program(3,o,t)}):u.call(e,"trans",n,{hash:{},inverse:h.noop,fn:h.program(3,o,t)});(n||0===n)&&(r+=n);r+='</span></span>\n        <span class="pageview">';a=i.pageviews;if(a)n=a.call(e,{hash:{}});else{n=e.pageviews;n=typeof n===d?n():n}r+=p(n)+"</span>\n      </div>\n      ";n=e;n=h.invokePartial(s.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",n,i,s);(n||0===n)&&(r+=n);r+="\n    ";return r}function o(e){var t,s;s=i.label;if(s)t=s.call(e,{hash:{}});else{t=e.label;t=typeof t===d?t():t}return t||0===t?t:""}i=i||e.helpers;s=s||e.partials;var l,c="",d="function",h=this,u=i.helperMissing,p=this.escapeExpression;c+='<section id="stats-post" class="card">\n  <div class="content">\n  ';l=t;l=h.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",l,i,s);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=h.invokePartial(s.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,i,s);(l||0===l)&&(c+=l);c+="\n  ";l=t.id;l=i["if"].call(t,l,{hash:{},inverse:h.noop,fn:h.program(1,a,n)});(l||0===l)&&(c+=l);c+="\n  </div>\n</section>\n";return c});t.registerPartial("cards_stats_templates_post",i);return i});
define("cards/stats/view/post",["js/views/card/itemview","js/cache","js/commands","moment","moment.lang","cards/stats/models/top_articles_itemview","cards/stats/models/top_articles_itemview_collection","hbs!cards/stats/templates/post","cards/stats/models/top_articles"],function(e,t,i,s,n,a,r,o,l){return e.extend({template:o,initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=s.routes;this.blogId=n[0];this.entryId=n[1];this.unit=n[2];this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.model=this.collection.get(this.entryId)||null;this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.fetch()}},this));i.setHandler("card:stats:share:show",_.bind(function(){var e=this.serializeData();i.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))},fetch:function(){this.model=new a({id:this.entryId,blogId:this.blogId});this.model.fetch({success:_.bind(function(){var e,t=this.model.toJSON().permalink||null;if(t){t=t.match(/http(?:s)?:\/\/[^\/]+\/(.*)/);e=t.length>1?t[1]:null}if(e){this.statsModel=new l;this.statsModel.fetch({blogId:this.blogId,startDate:s().startOf(this.unit).format(),endDate:s().endOf(this.unit).format(),limit:1,path:e,success:_.bind(function(e){this.loading=!1;this.fetchError=!1;this.pageviews=e.toJSON().items[0]?e.toJSON().items[0].pageviews:0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})}},this),error:_.bind(function(){this.fetchError=!0;this.loading=!1;this.render()},this)})},onRender:function(){this.handleRefetch()},serializeData:function(){var e=this.serializeDataInitialize();if(this.model){e=_.extend(e,this.model.toJSON());i.execute("header:render",e)}var t={day:"Today's",week:"This Week's",month:"This Month's",year:"This Year's"};e.label=t[this.unit]+" access";void 0===e.pageviews&&(e.pageviews=this.pageviews);return e}})});
define("cards/stats/view/post_header",["backbone.marionette","js/views/card/header","js/device","js/commands"],function(e,t){return t.extend({backButtonRoute:function(){return this.card.id},serializeData:function(){var e=t.prototype.serializeData.apply(this);if(this.object){e.post=this.object||{};e.shareEnabled="Publish"===e.post.status}return e}})});
define("hbs!cards/upload/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/title","template/helpers/trans"],function(e,t){var i=t.template(function(e,t,i,s,n){function a(e,t){var s,n="";n+="\n";s=e.FileUploadSupport;s=i["if"].call(e,s,{hash:{},inverse:C.noop,fn:C.program(2,r,t)});(s||0===s)&&(n+=s);n+="\n";return n}function r(e,t){var n,a="";a+="\n";n=e;n=C.invokePartial(s.js_views_card_partials_loading,"js_views_card_partials_loading",n,i,s);(n||0===n)&&(a+=n);a+="\n";n=e;n=C.invokePartial(s.js_views_card_partials_title,"js_views_card_partials_title",n,i,s);(n||0===n)&&(a+=n);a+='\n\n<form id="upload-file-form" method="post" name="upload-file">\n<div class="content">\n  ';n=e.uploadedImages;n=i.each.call(e,n,{hash:{},inverse:C.noop,fn:C.program(3,o,t)});(n||0===n)&&(a+=n);a+="\n  ";n=e.uploadError;n=null==n||n===!1?n:n.length;n=i["if"].call(e,n,{hash:{},inverse:C.noop,fn:C.program(5,l,t)});(n||0===n)&&(a+=n);a+="\n  ";n=e.uploadError;n=null==n||n===!1?n:n.length;n=i.unless.call(e,n,{hash:{},inverse:C.noop,fn:C.program(11,u,t)});(n||0===n)&&(a+=n);a+='\n  <div class="upload-file-input-container">\n    <input type="file" id="upload-file-input" accept="image/*"/>\n  </div>\n  <div id="upload-file" class="button-container with-icon">\n    ';n=e.isLabelNeeded;n=i["if"].call(e,n,{hash:{},inverse:C.noop,fn:C.program(14,f,t)});(n||0===n)&&(a+=n);a+='\n    <span class="button-icon icon-plus"></span><span class="button">\n      ';n=e.uploadCompleted;n=i["if"].call(e,n,{hash:{},inverse:C.program(19,g,t),fn:C.program(16,m,t)});(n||0===n)&&(a+=n);a+="\n    </span>\n    ";n=e.isLabelNeeded;n=i["if"].call(e,n,{hash:{},inverse:C.noop,fn:C.program(26,j,t)});(n||0===n)&&(a+=n);a+='\n  </div>\n  <div class="button-container button-container-disabled">\n    <div id="upload-file-uploading" class="upload-file button"></div>\n  </div>\n</div>\n</form>\n';return a}function o(e){var t,i="";i+='\n  <div class="uploaded-image">\n    <img src="';t=e.url;t=typeof t===x?t():t;i+=P(t)+'">\n  </div>\n  ';return i}function l(e,t){var s,n,a="";a+='\n  <div class="error">\n    <div class="upload-image icon-upload-fail"></div>\n    <div class="message">\n      <div class="message-inner">\n        <p class="error-heading">';s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:C.noop,fn:C.program(6,c,t)}):S.call(e,"trans",s,{hash:{},inverse:C.noop,fn:C.program(6,c,t)});(s||0===s)&&(a+=s);a+="</p>\n        ";s=e.uploadError;s=i.each.call(e,s,{hash:{},inverse:C.noop,fn:C.program(8,d,t)});(s||0===s)&&(a+=s);a+="\n      </div>\n    </div>\n  </div>\n  ";return a}function c(){return"Failed Uploading"}function d(e,t){var s,n="";n+="\n          <p>";s=i["if"].call(e,e,{hash:{},inverse:C.noop,fn:C.program(9,h,t)});(s||0===s)&&(n+=s);n+="</p>\n        ";return n}function h(e){var t;t=e.message;t=typeof t===x?t():t;return P(t)}function u(e,t){var s,n="";n+="\n  ";s=e.uploadedImages;s=null==s||s===!1?s:s.length;s=i.unless.call(e,s,{hash:{},inverse:C.noop,fn:C.program(12,p,t)});(s||0===s)&&(n+=s);n+="\n  ";return n}function p(){return'\n  <div class="upload-image icon-upload"></div>\n  '}function f(){return'\n    <label for="upload-file-input">\n    '}function m(e,t){var s,n,a="";a+="\n        ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:C.noop,fn:C.program(17,v,t)}):S.call(e,"trans",s,{hash:{},inverse:C.noop,fn:C.program(17,v,t)});(s||0===s)&&(a+=s);a+="\n      ";return a}function v(){return"More Upload"}function g(e,t){var s,n="";n+="\n        ";s=e.error;s=i["if"].call(e,s,{hash:{},inverse:C.program(23,w,t),fn:C.program(20,b,t)});(s||0===s)&&(n+=s);n+="\n      ";return n}function b(e,t){var s,n,a="";a+="\n          ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:C.noop,fn:C.program(21,_,t)}):S.call(e,"trans",s,{hash:{},inverse:C.noop,fn:C.program(21,_,t)});(s||0===s)&&(a+=s);a+="\n        ";return a}function _(){return"Choose Another Files"}function w(e,t){var s,n,a="";a+="\n          ";s=e.trans;n=i.trans;s=n?n.call(e,s,{hash:{},inverse:C.noop,fn:C.program(24,y,t)}):S.call(e,"trans",s,{hash:{},inverse:C.noop,fn:C.program(24,y,t)});(s||0===s)&&(a+=s);a+="\n        ";return a}function y(){return"Choose Files"}function j(){return"\n    </label>\n    "}i=i||e.helpers;s=s||e.partials;var I,k="",x="function",P=this.escapeExpression,C=this,S=i.helperMissing;I=t.perm;I=i["if"].call(t,I,{hash:{},inverse:C.noop,fn:C.program(1,a,n)});(I||0===I)&&(k+=I);k+="\n";return k});t.registerPartial("cards_upload_templates_dashboard",i);return i});
define("cards/upload/dashboard/dashboard",["js/views/card/itemview","js/mtapi","js/device","hbs!cards/upload/templates/dashboard"],function(e,t,i,s){return e.extend({template:s,ui:{uploadForm:"#upload-file-input",uploadButton:"#upload-file",refreshButton:"#refresh"},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userIsSystemAdmin()||this.userHasPermission("upload");this.FileUploadSupport=this.checkSupport();this.supportedFileAPI=this.checkFileAPISupport();this.isLabelNeeded=this.checkNeedLabel();this.dashboardShowWithPermission(this.perm&&this.FileUploadSupport).done(_.bind(function(){this.setTranslation()},this))},upload:function(e){if(this.perm&&this.ui.uploadForm.val()){this.uploadedImages=[];this.uploadError=[];this.errorImages=[];this.uploading=!0;this.$el.addClass("now-uploading");var i=[];_.each(e,_.bind(function(e){var s=$.Deferred();i.push(s);t.api.uploadAsset(this.blogId,{file:e,autoRenameIfExists:!0,bustCache:(new Date).valueOf()},_.bind(function(t){if(t.error){this.errorImages.push(e);this.uploadError.push(t.error);s.reject()}else{s.resolve();this.uploadedImages.push(t)}this.render()},this))},this));$.when.apply(this,i).done(_.bind(function(){this.uploadError=[];this.uploadCompleted=!0},this)).always(_.bind(function(){this.$el.removeClass("now-uploading");this.uploading=!1;this.render()},this))}},onRender:function(){if(this.perm){this.ui.uploadButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.isLabelNeeded||this.ui.uploadForm.click()},this))},this));this.ui.uploadForm.on("change",_.bind(this.handleUploadFormChange,this))}},handleUploadFormChange:function(e){this.supportedFileAPI?this.upload(e.target.files):this.upload([$("#upload-file-input").get(0)])},checkSupport:function(){return i.isIOS&&i.version&&i.version<6||i.isWindowsPhone?!1:!0},checkFileAPISupport:function(){return window.FileReader&&!i.isWindowsPhone?!0:!1},checkNeedLabel:function(){return i.isIE&&parseInt(i.browserVersion,10)<10?!0:!1},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.title=e.name;e.FileUploadSupport=this.FileUploadSupport;e.loading=!1;e.uploadError=this.uploadError||[];e.uploading=this.uploading?!0:!1;e.uploadCompleted=this.uploadCompleted?!0:!1;e.uploadedImages=this.uploadedImages;e.supportedFileAPI=this.supportedFileAPI;e.isLabelNeeded=this.isLabelNeeded}e.perm=this.perm;e.trans=this.trans;return e}})});
define("json!cards/cards.json",function(){return[{name:"Stats",id:"stats",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout"},{id:"post",route:":blog_id/:id/:unit",view:"view/post",header:"view/post_header"}]},{name:"Acception",id:"acception",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",route:":blog_id/:id",view:"view/view",header:"view/view_header"}]},{name:"Media Upload",id:"upload",dashboard:{view:"dashboard/dashboard"}},{name:"Feedbacks",id:"feedbacks",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout",route:":type/:blog_id/:id"}]}]});