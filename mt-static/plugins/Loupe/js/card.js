define("js/views/card/composite",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{appendHtml:function(e,t){if(!this.loading){var s=this.getItemViewContainer(e);s.append(t.el)}},handleReadmore:function(e){this.$el.find(".readmore").hammer(this.hammerOpts).on("tap",_.bind(function(t){this.addTapClass(t.currentTarget,_.bind(function(){this.loadingReadmore=!0;this.render();this.fetch(e)},this))},this))},handleItemViewNavigate:function(){this.$el.hammer(this.hammerOpts).on("tap","a",_.bind(function(e){e.preventDefault();e.stopPropagation();var s=$(e.currentTarget).data("route")||null;s&&this.addTapClass(e.currentTarget,function(){t.execute("router:navigate",s)});return!1},this))},fetch:function(e){e=e||{};var t={merge:!0,remove:!1,sort:!0,success:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!1;this.fetchErrorOption=null;e.successCallback&&e.successCallback();this.render()},this),error:_.bind(function(){this.loading=!1;this.loadingReadmore=!1;this.fetchError=!0;this.fetchErrorOption=e;e.errorCallback&&e.errorCallback();this.render()},this)};t=_.extend(t,e);this.collection.fetch(t)}});return e.CompositeView.extend(i,{cardCompositeViewProto:i})});
define("cards/acception/models/model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,s,i){var a=$.Deferred(),n=i.blogId,r=function(e){e.error?a.reject(e):a.resolve(e)};a.done(i.success);a.fail(i.error);if("read"===e)t.api.getEntry(n,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},r);else if("update"===e){var o=s.toJSON();o.status=i.status||o.status;t.api.updateEntry(n,this.id,o,r)}return a}})});
define("cards/acception/models/collection",["backbone","moment","js/mtapi","cards/acception/models/model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e;this.isSynced=!1},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var a=$.Deferred();a.done(i.success);a.fail(i.error);var n={status:"Review"};i.limit&&(n.limit=parseInt(i.limit,10));i.offset&&(n.offset=parseInt(i.offset,10));s.api.listEntries(this.blogId,n,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},_.bind(function(e){if(e.error)a.reject(e);else{this.isSynced=!0;a.resolve(e)}},this));return a}})});
define("hbs!cards/acception/templates/dashboardItemview",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e){var t,s="";s+='data-route="acception/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===p?t():t;s+=u(t)+"/";t=e.id;t=typeof t===p?t():t;s+=u(t)+'"';return s}function r(e,t){var i,a,n="";n+="\n      ";i=e.assets;a=s.eachOnly;i=a?a.call(e,i,0,{hash:{},inverse:m.noop,fn:m.program(4,o,t)}):f.call(e,"eachOnly",i,0,{hash:{},inverse:m.noop,fn:m.program(4,o,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function o(e){var t,i,a="";a+='\n      <span class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===p?t():t}a+=u(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===p?t():t}a+=u(t)+') no-repeat center center / cover"><span class="circle-inner"></span></span>\n      ';return a}function l(){return'\n      <span class="item-asset no-image circle"><span class="circle-inner"></span></span>\n    '}s=s||e.helpers;var c,d,h="",p="function",u=this.escapeExpression,m=this,f=s.helperMissing;h+="<a ";c=t.id;c=s["if"].call(t,c,{hash:{},inverse:m.noop,fn:m.program(1,n,a)});(c||0===c)&&(h+=c);h+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=s["if"].call(t,c,{hash:{},inverse:m.program(6,l,a),fn:m.program(3,r,a)});(c||0===c)&&(h+=c);h+='\n    </span>\n    <span class="item-title">';d=s.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===p?c():c}h+=u(c)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return h});t.registerPartial("cards_acception_templates_dashboardItemview",s);return s});
define("cards/acception/dashboard/itemview",["backbone.marionette","hbs!cards/acception/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("hbs!cards/acception/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/noItem","hbs!cards/acception/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var a,n="";n+="\n";a=e;a=u.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",a,s,i);(a||0===a)&&(n+=a);n+='\n<div class="content content-list">\n  ';a=e;a=u.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",a,s,i);(a||0===a)&&(n+=a);n+="\n  ";a=e;a=u.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n  ";a=e;a=u.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",a,s,i);(a||0===a)&&(n+=a);n+='\n  <ul id="acceptions-list" class="card-item-list" ';a=e.fetchError;a=s["if"].call(e,a,{hash:{},inverse:u.noop,fn:u.program(2,r,t)});(a||0===a)&&(n+=a);n+=">\n    ";a=e.fetchError;a=s.unless.call(e,a,{hash:{},inverse:u.noop,fn:u.program(4,o,t)});(a||0===a)&&(n+=a);n+="\n  </ul>\n  ";a=e;a=u.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",a,s,i);(a||0===a)&&(n+=a);n+="\n</div>\n";return n}function r(){return'style="display:none"'}function o(e,t){var i;i=e.loading;i=s.unless.call(e,i,{hash:{},inverse:u.noop,fn:u.program(5,l,t)});return i||0===i?i:""}function l(e,t){var i;i=e.count;i=s.unless.call(e,i,{hash:{},inverse:u.noop,fn:u.program(6,c,t)});return i||0===i?i:""}function c(e,t){var i,a="";a+="\n      ";i=e.items;i=s.each.call(e,i,{hash:{},inverse:u.noop,fn:u.program(7,d,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function d(e){var t,a="";a+='\n      <li class="sample-item">\n      ';t=e;t=u.invokePartial(i.cards_acception_templates_dashboardItemview,"cards_acception_templates_dashboardItemview",t,s,i);(t||0===t)&&(a+=t);a+="\n      </li>\n      ";return a}s=s||e.helpers;i=i||e.partials;var h,p="",u=this;h=t.perm;h=s["if"].call(t,h,{hash:{},inverse:u.noop,fn:u.program(1,n,a)});(h||0===h)&&(p+=h);p+="\n";return p});t.registerPartial("cards_acception_templates_dashboard",s);return s});
define("cards/acception/dashboard/dashboard",["backbone.marionette","js/cache","js/device","js/commands","js/trans","template/helpers/trans","js/views/card/composite","cards/acception/models/collection","cards/acception/dashboard/itemview","hbs!cards/acception/templates/dashboard"],function(e,t,s,i,a,n,r,o,l,c){return r.extend({template:c,itemView:l,itemViewContainer:"#acceptions-list",initialize:function(){r.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userHasPermission("edit_all_posts");this.dashboardShowWithPermission(this.perm).done(_.bind(function(){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},this))},onRender:function(){if(this.perm){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){if(this.trans){var s=t.get("app","staticPath")||t.set("app","staticPath",$("#main-script").data("base")),i={id:null,assets:[{url:s+"/cards/acception/assets/welcome.png"}],title:n(this.trans,"welcome to Loupe! - this card lists the posts waiting for acception")};e.items=[];for(var a=0;3>a;a++)e.items.push(i)}}else e.items=this.collection.toJSON()}}return e}})});
define("hbs!cards/acception/templates/view",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","hbs!js/views/card/partials/noPermission","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var a,n="";n+="\n    ";a=e;a=j.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n    ";a=e;a=j.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",a,s,i);(a||0===a)&&(n+=a);n+="\n    ";a=e.acceptionFailed;a=s["if"].call(e,a,{hash:{},inverse:j.noop,fn:j.program(2,r,t)});(a||0===a)&&(n+=a);n+="\n    ";a=e.id;a=s["if"].call(e,a,{hash:{},inverse:j.noop,fn:j.program(7,c,t)});(a||0===a)&&(n+=a);n+="\n  ";return n}function r(e,t){var i,a,n="";n+='\n        <div class="acception-failed error overlay with-button">\n          <div class="overlay-inner">\n            <span class="message overlay-content">\n              <span class="message-inner overlay-content-inner">\n                ';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:j.noop,fn:j.program(3,o,t)}):k.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(3,o,t)});(i||0===i)&&(n+=i);n+='\n              </span>\n            </span>\n            <div class="button-container">\n              <div class="close-me button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:j.noop,fn:j.program(5,l,t)}):k.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(5,l,t)});(i||0===i)&&(n+=i);n+="</div>\n            </div>\n          </div>\n        </div>\n    ";return n}function o(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===y?t():t}return I(t)}function l(){return"Close"}function c(e,t){var a,n,r,o="";o+="\n      ";a=e.status;n={};n.eq="Review";r=s.ifIs;a=r?r.call(e,a,{hash:n,inverse:j.program(11,p,t),fn:j.program(8,d,t)}):k.call(e,"ifIs",a,{hash:n,inverse:j.program(11,p,t),fn:j.program(8,d,t)});(a||0===a)&&(o+=a);o+="\n      ";a=e;a=j.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",a,s,i);(a||0===a)&&(o+=a);o+="\n    ";return o}function d(e,t){var i,a,n="";n+='\n        <div id="accept" class="button-container button-container-top button-container-caution">\n          <div class="button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:j.noop,fn:j.program(9,h,t)}):k.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(9,h,t)});(i||0===i)&&(n+=i);n+="</div>\n        </div>\n      ";return n}function h(){return"Accept"}function p(e,t){var i,a,n,r="";r+="\n        ";i=e.status;a={};a.eq="Publish";n=s.ifIs;i=n?n.call(e,i,{hash:a,inverse:j.noop,fn:j.program(12,u,t)}):k.call(e,"ifIs",i,{hash:a,inverse:j.noop,fn:j.program(12,u,t)});(i||0===i)&&(r+=i);r+="\n      ";return r}function u(e,t){var i,a="";a+='\n        <div class="button-container button-container-top button-container-undo">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';i=e.accepted;i=s["if"].call(e,i,{hash:{},inverse:j.program(16,v,t),fn:j.program(13,m,t)});(i||0===i)&&(a+=i);a+='\n            <span id="accept-undo" class="button-undo">\n              <span class="button-undo-inner icon-undo-arrow"></span>\n            </span>\n          </span>\n        </div>\n        ';return a}function m(e,t){var i,a,n="";n+="\n              ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:j.noop,fn:j.program(14,f,t)}):k.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(14,f,t)});(i||0===i)&&(n+=i);n+="\n            ";return n}function f(){return"Completed Publishing"}function v(e,t){var i,a,n="";n+="\n              ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:j.noop,fn:j.program(17,b,t)}):k.call(e,"trans",i,{hash:{},inverse:j.noop,fn:j.program(17,b,t)});(i||0===i)&&(n+=i);n+="\n            ";return n}function b(){return"Published"}function _(e){var t,a="";a+="\n    ";t=e;t=j.invokePartial(i.js_views_card_partials_noPermission,"js_views_card_partials_noPermission",t,s,i);(t||0===t)&&(a+=t);a+="\n  ";return a}s=s||e.helpers;i=i||e.partials;var g,w="",y="function",I=this.escapeExpression,j=this,k=s.helperMissing;w+='<section id="acception-view" class="card">\n  <div class="content">\n  ';g=t.perm;g=s["if"].call(t,g,{hash:{},inverse:j.program(19,_,a),fn:j.program(1,n,a)});(g||0===g)&&(w+=g);w+="\n  </div>\n</section>\n";return w});t.registerPartial("cards_acception_templates_view",s);return s});
define("cards/acception/view/view",["js/views/card/itemview","js/cache","js/device","js/commands","js/trans","moment","moment.lang","cards/acception/models/collection","cards/acception/models/model","hbs!cards/acception/templates/view"],function(e,t,s,i,a,n,r,o,l,c){return e.extend({template:c,ui:{button:"#accept",undo:"#accept-undo"},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var a=s.routes;this.blogId=a[0];this.entryId=a[1];this.perm=this.userHasPermission("edit_all_posts");if(this.perm){this.collection=t.get(this.blogId,"acception")||t.set(this.blogId,"acception",new o(this.blogId));this.model=this.collection.get(this.entryId);this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.model=new l({id:this.entryId});this.fetch()}},this));i.setHandler("card:acception:share:show",_.bind(function(){var e=this.serializeData();i.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))}else this.setTranslation()},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model)},this)})},update:function(e){this.loading=!0;this.render();var t={blogId:this.blogId,status:e,success:_.bind(function(t){this.loading=!1;if("Publish"===e){this.accepted=!0;this.collection.remove(this.model);this.collection.totalResults=this.collection.totalResults-1}else{this.accepted=!0;this.collection.add(this.model);this.collection.totalResults=this.collection.totalResults+1}this.model.set(this.model.parse(t));this.render()},this),error:_.bind(function(e){this.error=e.error&&e.error.message?e.error.message:"Acception failed";this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,t)},onRender:function(){if(this.perm){this.acceptionFailed&&this.$el.find(".close-me").hammer(this.hammerOpts).on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Publish")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Review")},this))},this));this.handleRefetch()}},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.perm=this.perm;if(this.model){e=_.extend(e,this.model.toJSON());i.execute("header:render",e)}e.accepted=this.accepted?!0:!1;e.acceptionFailed=this.acceptionFailed?!0:!1}else e.trans=this.trans;e.error=this.error;return e}})});
define("cards/acception/view/view_header",["backbone.marionette","js/views/card/header"],function(e,t){return t.extend({serializeData:function(){var e=t.prototype.serializeData.apply(this);e.post=this.object||{};"Publish"===e.post.status&&(e.shareEnabled=!0);return e}})});
define("hbs!cards/feedbacks/templates/dashboardItemview",["hbs","handlebars","template/helpers/removeHtml"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e){var t,s="";s+='data-route="feedbacks/comments/';t=e.blog;t=null==t||t===!1?t:t.id;t=typeof t===c?t():t;s+=d(t)+"/";t=e.id;t=typeof t===c?t():t;s+=d(t)+'"';return s}s=s||e.helpers;var r,o,l="",c="function",d=this.escapeExpression,h=this,p=s.helperMissing;l+="<a ";r=t.id;r=s["if"].call(t,r,{hash:{},inverse:h.noop,fn:h.program(1,n,a)});(r||0===r)&&(l+=r);l+=' class="item-container">\n  <span class="item-content">\n    <span class="item-asset-container">\n      <span class="item-asset icon-comment"></span>\n    </span>\n    <span class="item-title">';r=t.body;o=s.removeHtml;r=o?o.call(t,r,{hash:{}}):p.call(t,"removeHtml",r,{hash:{}});l+=d(r)+'</span>\n    <span class="item-arrow icon-arrow"></span>\n  </span>\n</a>\n';return l});t.registerPartial("cards_feedbacks_templates_dashboardItemview",s);return s});
define("cards/feedbacks/dashboard/comments_itemview",["backbone.marionette","hbs!cards/feedbacks/templates/dashboardItemview"],function(e,t){return e.ItemView.extend({tagName:"li",template:t})});
define("cards/feedbacks/models/comments_model",["backbone","js/mtapi"],function(e,t){return e.Model.extend({sync:function(e,s,i){var a=$.Deferred(),n=i.blogId,r=function(e){e.error?a.reject(e):a.resolve(e)};a.done(i.success);a.fail(i.error);if("read"===e)t.api.getComment(n,this.id,r);else if("update"===e){var o=s.toJSON();o.status=i.status||o.status;t.api.updateComment(n,this.id,o,r)}return a}})});
define("cards/feedbacks/models/comments_collection",["backbone","moment","js/mtapi","cards/feedbacks/models/comments_model"],function(e,t,s,i){return e.Collection.extend({model:i,initialize:function(e){this.blogId=e},comparator:function(e){return-1*t(e.get("date")).valueOf()},parse:function(e){this.totalResults=e.totalResults;return e.items},sync:function(e,t,i){var a=$.Deferred();a.done(i.success);a.fail(i.error);var n={limit:i.limit,entryStatus:"Publish"};i.offset&&(n.offset=i.offset);s.api.listComments(this.blogId,n,_.bind(function(e){if(e.error)a.reject(e);else{this.isSynced=!0;a.resolve(e)}},this));return a}})});
define("hbs!cards/feedbacks/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/noItem","hbs!cards/feedbacks/templates/dashboardItemview","hbs!js/views/card/partials/readmore"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var i;i=e.loading;i=s.unless.call(e,i,{hash:{},inverse:h.noop,fn:h.program(2,r,t)});return i||0===i?i:""}function r(e,t){var i;i=e.count;i=s.unless.call(e,i,{hash:{},inverse:h.noop,fn:h.program(3,o,t)});return i||0===i?i:""}function o(e,t){var i,a="";a+="\n      ";i=e.items;i=s.each.call(e,i,{hash:{},inverse:h.noop,fn:h.program(4,l,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function l(e){var t,a="";a+='\n      <li class="sample-item">\n      ';t=e;t=h.invokePartial(i.cards_feedbacks_templates_dashboardItemview,"cards_feedbacks_templates_dashboardItemview",t,s,i);(t||0===t)&&(a+=t);a+="\n      </li>\n      ";return a}s=s||e.helpers;i=i||e.partials;var c,d="",h=this;c=t;c=h.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",c,s,i);(c||0===c)&&(d+=c);d+='\n<div class="content content-list">\n  ';c=t;c=h.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",c,s,i);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",c,s,i);(c||0===c)&&(d+=c);d+="\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",c,s,i);(c||0===c)&&(d+=c);d+='\n  <ul id="feedback-comments-list" class="card-item-list">\n    ';c=t.fetchError;c=s.unless.call(t,c,{hash:{},inverse:h.noop,fn:h.program(1,n,a)});(c||0===c)&&(d+=c);d+="\n  </ul>\n  ";c=t;c=h.invokePartial(i.js_views_card_partials_readmore,"js_views_card_partials_readmore",c,s,i);(c||0===c)&&(d+=c);d+="\n</div>\n";return d});t.registerPartial("cards_feedbacks_templates_dashboard",s);return s});
define("cards/feedbacks/dashboard/dashboard",["js/cache","js/device","js/commands","template/helpers/trans","cards/feedbacks/models/comments_collection","hbs!cards/feedbacks/templates/dashboard","cards/feedbacks/dashboard/comments_itemview","js/views/card/composite"],function(e,t,s,i,a,n,r,o){return o.extend({template:n,itemView:r,itemViewContainer:"#feedback-comments-list",initialize:function(){o.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.collection=e.get(this.blogId,"feedbacks_comments")||e.set(this.blogId,"feedbacks_comments",new a(this.blogId));this.setTranslation(_.bind(function(){if(this.collection.isSynced){this.loading=!1;this.render()}else{this.render();this.fetch({limit:3,reset:!0})}},this));this.handleItemViewNavigate()},onRender:function(){var e={limit:5,offset:this.collection.length};this.handleReadmore(e);this.handleRefetch(this.fetchErrorOption||e)},serializeData:function(){var e=this.serializeDataInitialize();e.title=e.name;if(!this.loading){e.count=parseInt(this.collection.totalResults,10);e.count>this.collection.length&&(e.showMoreButton=!0);if(0===e.count){var t={id:null,body:i(this.trans,"welcome to Loupe! - this card lists the new comments")};e.items=[];for(var s=0;3>s;s++)e.items.push(t)}}return e}})});
define("hbs!cards/feedbacks/templates/content",["hbs","handlebars","template/helpers/formatDate","template/helpers/trans","template/helpers/sanitize"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(){return"Author"}s=s||e.helpers;var r,o,l,c="",d=s.helperMissing,h=this.escapeExpression,p=this,u="function";c+='<ul class="comment-items-list">\n  <li class="date">';r=t.lang;o=t.date;l=s.formatDate;r=l?l.call(t,o,r,{hash:{}}):d.call(t,"formatDate",o,r,{hash:{}});c+=h(r)+'</li>\n  <li class="author">';r=t.trans;l=s.trans;r=l?l.call(t,r,{hash:{},inverse:p.noop,fn:p.program(1,n,a)}):d.call(t,"trans",r,{hash:{},inverse:p.noop,fn:p.program(1,n,a)});(r||0===r)&&(c+=r);c+='<span class="author-name">';r=t.author;r=null==r||r===!1?r:r.displayName;r=typeof r===u?r():r;c+=h(r)+'</span></li>\n  <li class="body">';r=t.body;l=s.sanitize;r=l?l.call(t,r,{hash:{}}):d.call(t,"sanitize",r,{hash:{}});c+=h(r)+"</li>\n</ul>\n";return c});t.registerPartial("cards_feedbacks_templates_content",s);return s});
define("hbs!cards/feedbacks/templates/comment",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!cards/feedbacks/templates/content","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var i,a,n="";n+='\n      <div class="approve-failed error overlay with-button">\n        <div class="overlay-inner">\n          <span class="message overlay-content">\n            <span class="message-inner overlay-content-inner">';i=e.error;i=null==i||i===!1?i:i.message;i=typeof i===w?i():i;n+=y(i)+'</span>\n          </span>\n          <div class="button-container">\n            <div class="close-me button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:I.noop,fn:I.program(2,r,t)}):j.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(2,r,t)});(i||0===i)&&(n+=i);n+="</div>\n          </div>\n        </div>\n      </div>\n    ";return n}function r(){return"Close"}function o(e,t){var i,a,n,r="";r+="\n      ";i=e.status;a={};a.eq="Pending";n=s.ifIs;i=n?n.call(e,i,{hash:a,inverse:I.program(9,h,t),fn:I.program(5,l,t)}):j.call(e,"ifIs",i,{hash:a,inverse:I.program(9,h,t),fn:I.program(5,l,t)});(i||0===i)&&(r+=i);r+="\n    ";return r}function l(e,t){var a,n="";n+="\n        ";a=e.commentApprovePerm;a=s["if"].call(e,a,{hash:{},inverse:I.noop,fn:I.program(6,c,t)});(a||0===a)&&(n+=a);n+="\n        ";a=e;a=I.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",a,s,i);(a||0===a)&&(n+=a);n+="\n      ";return n}function c(e,t){var i,a,n="";n+='\n        <div id="approve" class="button-container button-container-caution button-container-top">\n          <div class="button">\n            <div class="button-inner">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:I.noop,fn:I.program(7,d,t)}):j.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(7,d,t)});(i||0===i)&&(n+=i);n+="</div>\n          </div>\n        </div>\n        ";return n}function d(){return"Approve"}function h(e,t){var i,a,n,r="";r+="\n        ";i=e.status;a={};a.eq="Approved";n=s.ifIs;i=n?n.call(e,i,{hash:a,inverse:I.noop,fn:I.program(10,p,t)}):j.call(e,"ifIs",i,{hash:a,inverse:I.noop,fn:I.program(10,p,t)});(i||0===i)&&(r+=i);r+="\n      ";return r}function p(e,t){var a,n="";n+='\n        <div class="button-container button-container-undo button-container-top">\n          <span class="button-icon icon-check"></span>\n          <span id="accepted" class="button-label">\n            ';a=e.accepted;a=s["if"].call(e,a,{hash:{},inverse:I.program(14,f,t),fn:I.program(11,u,t)});(a||0===a)&&(n+=a);n+="\n          </span>\n          ";a=e.commentApprovePerm;a=s["if"].call(e,a,{hash:{},inverse:I.noop,fn:I.program(17,b,t)});(a||0===a)&&(n+=a);n+="\n        </div>\n        ";a=e;a=I.invokePartial(i.cards_feedbacks_templates_content,"cards_feedbacks_templates_content",a,s,i);(a||0===a)&&(n+=a);n+="\n        ";return n}function u(e,t){var i,a,n="";n+="\n              ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:I.noop,fn:I.program(12,m,t)}):j.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(12,m,t)});(i||0===i)&&(n+=i);n+="\n            ";return n}function m(){return"Completed Approvement"}function f(e,t){var i,a,n="";n+="\n              ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:I.noop,fn:I.program(15,v,t)}):j.call(e,"trans",i,{hash:{},inverse:I.noop,fn:I.program(15,v,t)});(i||0===i)&&(n+=i);n+="\n            ";return n}function v(){return"Approved"}function b(){return'\n          <span id="comment-undo" class="button-undo">\n            <span class="button-undo-inner icon-undo-arrow"></span>\n          </span>\n          '}s=s||e.helpers;i=i||e.partials;var _,g="",w="function",y=this.escapeExpression,I=this,j=s.helperMissing;g+='  <div class="comment-container">\n    ';_=t;_=I.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",_,s,i);(_||0===_)&&(g+=_);g+="\n    ";_=t;_=I.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",_,s,i);(_||0===_)&&(g+=_);g+="\n    ";_=t.acceptionFailed;_=s["if"].call(t,_,{hash:{},inverse:I.noop,fn:I.program(1,n,a)});(_||0===_)&&(g+=_);g+="\n    ";_=t.status;_=s["if"].call(t,_,{hash:{},inverse:I.noop,fn:I.program(4,o,a)});(_||0===_)&&(g+=_);g+="\n  </div>\n";return g});t.registerPartial("cards_feedbacks_templates_comment",s);return s});
define("cards/feedbacks/view/comment",["js/views/card/itemview","js/commands","hbs!cards/feedbacks/templates/comment"],function(e,t,s){return e.extend({template:s,ui:{button:"#approve",undo:"#comment-undo"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.fetchError=t.fetchError;if(!this.fetchError){this.collection=t.collection;this.model=t.model;this.entryModel=t.entryModel;this.commentApprovePerm=!1;var s=this.entryModel.toJSON();"Publish"===s.status&&(this.userIsSystemAdmin()||this.userHasPermission("manage_feedback")||this.userHasPermission("edit_all_posts")?this.commentApprovePerm=!0:s.author&&s.author.id===this.user.id&&this.userHasPermission("publish_post")&&(this.commentApprovePerm=!0))}this.loading=!1;this.setTranslation()},update:function(e){this.loading=!0;this.render();var s={blogId:this.blogId,status:e,success:_.bind(function(e){this.loading=!1;this.accepted=!0;this.model.set(this.model.parse(e));this.render();t.execute("card:feedbacks:reply:render")},this),error:_.bind(function(e){this.error=e.error;this.loading=!1;this.acceptionFailed=!0;this.render()},this)};this.model.sync("update",this.model,s)},onRender:function(){this.acceptionFailed&&this.$el.find(".close-me").hammer().on("tap",_.bind(function(){this.$el.find(".overlay").remove()},this));this.ui.button.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.update("Approved")},this))},this));this.ui.undo.hammer(this.hammerOpts).on("tap",_.bind(function(){this.addTapClass(this.$el.find(".button-container-undo"),_.bind(function(){this.update("Pending")},this))},this))},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));e.accepted=this.accepted;e.acceptionFailed=this.acceptionFailed;e.error=this.error;e.commentApprovePerm=this.commentApprovePerm;return e}})});
define("hbs!cards/feedbacks/templates/entry",["hbs","handlebars","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/entryItemsList","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(){return"The Post Commented"}function r(e,t){var i,a,n,r="";r+="\n  ";i=e.status;a={};a.eq="Publish";n=s.ifIs;i=n?n.call(e,i,{hash:a,inverse:u.program(6,l,t),fn:u.program(4,o,t)}):m.call(e,"ifIs",i,{hash:a,inverse:u.program(6,l,t),fn:u.program(4,o,t)});(i||0===i)&&(r+=i);r+="\n  ";return r}function o(e){var t,a="";a+="\n    ";t=e;t=u.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",t,s,i);(t||0===t)&&(a+=t);a+="\n  ";return a}function l(e,t){var i,a,n="";n+='\n  <div class="error overlay">\n    <div class="overlay-inner">\n      <span class="message overlay-content">\n        <span class="message-inner overlay-content-inner">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:u.noop,fn:u.program(7,c,t)}):m.call(e,"trans",i,{hash:{},inverse:u.noop,fn:u.program(7,c,t)});(i||0===i)&&(n+=i);n+="</span>\n      </span>\n    </div>\n  </div>\n  ";return n}function c(){return"The post is not published"}s=s||e.helpers;i=i||e.partials;var d,h,p="",u=this,m=s.helperMissing;p+="<header>\n<h1>";d=t.trans;h=s.trans;d=h?h.call(t,d,{hash:{},inverse:u.noop,fn:u.program(1,n,a)}):m.call(t,"trans",d,{hash:{},inverse:u.noop,fn:u.program(1,n,a)});(d||0===d)&&(p+=d);p+='</h1>\n</header>\n<div class="content">\n  ';d=t;d=u.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",d,s,i);(d||0===d)&&(p+=d);p+="\n  ";d=t;d=u.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",d,s,i);(d||0===d)&&(p+=d);p+="\n  ";d=t.id;d=s["if"].call(t,d,{hash:{},inverse:u.noop,fn:u.program(3,r,a)});(d||0===d)&&(p+=d);p+="\n</div>\n";return p});t.registerPartial("cards_feedbacks_templates_entry",s);return s});
define("cards/feedbacks/view/entry",["js/views/card/itemview","hbs!cards/feedbacks/templates/entry"],function(e,t){return e.extend({template:t,initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.fetchError=t.fetchError||!1;this.fetchError||(this.model=t.entryModel);this.loading=!1;this.setTranslation()},serializeData:function(){var e=this.serializeDataInitialize();this.model&&(e=_.extend(e,this.model.toJSON()));return e}})});
define("js/views/card/itemview_layout",["backbone.marionette","js/commands","js/views/card/itemview"],function(e,t,s){var i=_.extend({},s.cardItemViewProto,{});return e.Layout.extend(i,{cardItemViewLayoutProto:i})});
define("js/models/entry",["backbone","js/mtapi"],function(e,t){return e.Model.extend({initialize:function(e){this.blogId=e.blogId},sync:function(e,s,i){if("read"===e){var a=$.Deferred();a.done(i.success);a.fail(i.error);t.api.getEntry(this.blogId,this.id,{fields:"author,blog,categories,id,status,title,body,permalink,date,excerpt"},function(e){e.error?a.reject(e):a.resolve(e)});return a}}})});
define("js/collections/entries",["backbone","js/models/entry"],function(e,t){return e.Collection.extend({model:t})});
define("hbs!cards/feedbacks/templates/layout",["hbs","handlebars","hbs!js/views/card/partials/loading"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var a,n="",r=this;n+='<section id="feedbacks-comment-view" class="card">\n  <div class="content">\n    ';a=t;a=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+='\n    <div id="comment"></div>\n    <div id="reply"></div>\n</section>\n<section id="feedbacks-comment-entry" class="card">\n  <div class="content">\n    ';a=t;a=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n  </div>\n</section>\n\n";return n});t.registerPartial("cards_feedbacks_templates_layout",s);return s});
define("hbs!cards/feedbacks/templates/reply",["hbs","handlebars","hbs!js/views/card/partials/loading","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var i,a="";a+="\n";i=e.commentIsApproved;i=s["if"].call(e,i,{hash:{},inverse:y.noop,fn:y.program(2,r,t)});(i||0===i)&&(a+=i);a+="\n";return a}function r(e,t){var i,a="";a+="\n";i=e.commentApprovePerm;i=s["if"].call(e,i,{hash:{},inverse:y.noop,fn:y.program(3,o,t)});(i||0===i)&&(a+=i);a+="\n";return a}function o(e,t){var a,n="";n+="\n  ";a=e;a=y.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n  ";a=e.initial;a=s["if"].call(e,a,{hash:{},inverse:y.program(7,d,t),fn:y.program(4,l,t)});(a||0===a)&&(n+=a);n+="\n";return n}function l(e,t){var i,a,n="";n+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(5,c,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(5,c,t)});(i||0===i)&&(n+=i);n+="</div>\n      </div>\n    </div>\n  </div>\n  ";return n}function c(){return"Reply"}function d(e,t){var i,a="";a+="\n  ";i=e.replied;i=s["if"].call(e,i,{hash:{},inverse:y.noop,fn:y.program(8,h,t)});(i||0===i)&&(a+=i);a+="\n  ";i=e.form;i=s["if"].call(e,i,{hash:{},inverse:y.noop,fn:y.program(13,m,t)});(i||0===i)&&(a+=i);a+="\n  ";return a}function h(e,t){var i,a,n="";n+='\n  <div id="reply-container">\n    <div class="reply-button-container">\n      <div class="button-container">\n        <div id="reply-button" class="button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(9,p,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(9,p,t)});(i||0===i)&&(n+=i);n+='</div>\n      </div>\n    </div>\n  </div>\n  <div id="reply-textarea-container">\n    <div class="reply-complete-message message">\n      <div class="message-inner">\n        <span class="button-icon icon-check"></span>\n        <span id="accepted">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(11,u,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(11,u,t)});(i||0===i)&&(n+=i);n+="</span>\n      </div>\n    </div>\n    <div>";a=s.body;if(a)i=a.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}n+=k(i)+"</div>\n  </div>\n  ";return n}function p(){return"Another Comment"}function u(){return"Posted comment successfully"}function m(e,t){var i,a,n="";n+='\n  <div id="reply-container">\n    <div class="reply-button-container button-container button-container-disabled">\n      <div id="reply-disabled-button" class="button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(14,f,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(14,f,t)});(i||0===i)&&(n+=i);n+='</div>\n    </div>\n  </div>\n  <div class="reply-textarea-container">\n    ';i=e.error;i=s["if"].call(e,i,{hash:{},inverse:y.noop,fn:y.program(16,v,t)});(i||0===i)&&(n+=i);n+='\n    <textarea id="reply-textarea">';a=s.body;if(a)i=a.call(e,{hash:{}});else{i=e.body;i=typeof i===j?i():i}n+=k(i)+'</textarea>\n    <div class="button-container">\n      <div id="do-reply-button" class="button">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(19,_,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(19,_,t)});(i||0===i)&&(n+=i);n+="</div>\n    </div>\n  </div>\n  ";return n}function f(){return"Reply"}function v(e,t){var i,a,n="";n+='\n    <div class="error">\n      <span class="message">\n        <span class="message-inner">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:y.noop,fn:y.program(17,b,t)}):I.call(e,"trans",i,{hash:{},inverse:y.noop,fn:y.program(17,b,t)});(i||0===i)&&(n+=i);n+="</span>\n      </span>\n    </div>\n    ";return n}function b(e){var t,i;i=s.error;if(i)t=i.call(e,{hash:{}});else{t=e.error;t=typeof t===j?t():t}return k(t)}function _(){return"Post The Reply"}s=s||e.helpers;i=i||e.partials;var g,w="",y=this,I=s.helperMissing,j="function",k=this.escapeExpression;g=t.entryIsPublished;g=s["if"].call(t,g,{hash:{},inverse:y.noop,fn:y.program(1,n,a)});(g||0===g)&&(w+=g);w+="\n";return w});t.registerPartial("cards_feedbacks_templates_reply",s);return s});
define("cards/feedbacks/view/reply",["js/views/card/itemview","js/mtapi","js/commands","moment","moment.lang","cards/feedbacks/models/comments_model","hbs!cards/feedbacks/templates/reply"],function(e,t,s,i,a,n,r){return e.extend({template:r,ui:{replyButton:"#reply-button",doReplyButton:"#do-reply-button",replyTextarea:"#reply-textarea"},initialize:function(t){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.type=t.type;this.blogId=t.blogId;this.commentId=t.commentId;this.model=t.model;this.collection=t.collection;this.entryModel=t.entryModel;this.initial=!0;this.loading=!1;this.setTranslation();s.setHandler("card:feedbacks:reply:render",this.render)},commentIsApproved:function(){var e=this.model.toJSON();return"Approved"===e.status},entryIsPublished:function(){var e=this.entryModel.toJSON();return"Publish"===e.status},commentApprovePerm:function(){var e=this.entryModel.toJSON(),t=!1;"Publish"===e.status&&(this.userIsSystemAdmin()||this.userHasPermission("manage_feedback")||this.userHasPermission("edit_all_posts")?t=!0:e.author&&e.author.id===this.user.id&&this.userHasPermission("publish_post")&&(t=!0));return t},onRender:function(){if(this.entryIsPublished()&&this.commentIsApproved()&&this.commentApprovePerm()){this.ui.replyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.initial=!1;this.form=!0;this.body=!1;this.replied=!1;this.loading=!1;this.render()},this))},this));this.ui.doReplyButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){var e=this.ui.replyTextarea.val(),s=this.model.toJSON();if(e.length){var a={author:this.user,entry:s.entry,blog:s.blog,parent:this.commentId,date:i().format(),body:e};this.body=e;this.loading=!0;this.render();t.api.createReplyComment(this.blogId,s.entry.id,this.commentId,a,_.bind(function(t){if(t.error){this.form=!0;this.replied=!1;this.body=e;this.loading=!1;this.error=t.error&&t.error.message?t.error.message:"request failed";this.render()}else{this.form=!1;this.replied=!0;this.body=e;this.loading=!1;var s=new n;s.set(t);this.collection.unshift(s);this.render()}},this))}},this))},this))}},serializeData:function(){var e=this.serializeDataInitialize();e=_.extend(e,this.model.toJSON());e.commentIsApproved=this.commentIsApproved();e.entryIsPublished=this.entryIsPublished();e.commentApprovePerm=this.commentApprovePerm();e.error=this.error;e.initial=this.initial;e.form=this.form;e.replied=this.replied;e.body=this.body||"";return e}})});
define("cards/feedbacks/view/layout",["js/views/card/itemview_layout","js/cache","cards/feedbacks/models/comments_collection","cards/feedbacks/models/comments_model","js/collections/entries","js/models/entry","hbs!cards/feedbacks/templates/layout","cards/feedbacks/view/comment","cards/feedbacks/view/reply","cards/feedbacks/view/entry"],function(e,t,s,i,a,n,r,o,l,c){return e.extend({template:r,regions:{comment:"#comment",reply:"#reply",entry:"#feedbacks-comment-entry"},initialize:function(a){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var n=a.routes;this.options=a;this.type=n[0];this.blogId=n[1];this.commentId=n[2];this.collection=t.get(this.blogId,"feedbacks_comments")||t.set(this.blogId,"feedbacks_comments",new s(this.blogId));this.model=this.collection.get(this.commentId);this.setTranslation(_.bind(function(){if(this.model)this.fetchEntry();else{this.render();this.model=new i({id:this.commentId});this.fetch()}},this))},fetch:function(){e.prototype.fetch.call(this,{blogId:this.blogId,successCallback:_.bind(function(){this.collection.add(this.model);this.loading=!0;this.fetchEntry()},this)})},fetchEntry:function(){var e=this.model.toJSON(),s=e.entry?e.entry.id:null;this.entryCollection=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new a(this.blogId));this.entryModel=this.entryCollection.get(s);if(this.entryModel){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.build()},this),0)}else{this.entryModel=new n({blogId:this.blogId,id:s});var i={success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.render();setTimeout(_.bind(function(){this.entryCollection.add(this.entryModel);this.build()},this),0)},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)};this.entryModel.fetch(i)}},build:function(){this.model.toJSON();var e=_.extend(this.options,{model:this.model,collection:this.collection,type:this.type,blogId:this.blogId,commentId:this.commentId,entryModel:this.entryModel});this.comment.show(new o(e));this.reply.show(new l(e));this.entry.show(new c(e))},onRender:function(){if(this.fetchError){this.handleRefetch();var e=_.extend(this.options,{fetchError:this.fetchError});this.comment.show(new o(e));this.entry.show(new c(e))}},serializeData:function(){var e=this.serializeDataInitialize();return e}})});
define("js/mtapi/stats_provider",["js/cache","js/mtapi"],function(e,t){return function(s){var i=$.Deferred(),a=e.get(s,"statsProvider")||null;a?i.resolve({id:a}):t.api.getStatsProvider(s,{bustCache:(new Date).valueOf()},function(t){if(t&&!t.error)if(t.id){e.set(s,"statsProvider",t);i.resolve(t)}else i.reject(t);else i.reject(t)});return i}});
define("cards/stats/models/latest_page_views",["backbone","moment","js/mtapi"],function(e,t,s){return e.Model.extend({isSynced:!1,initialize:function(e){this.blogId=e},sync:function(e,i,a){if("read"===e){var n=$.Deferred(),r=$.Deferred(),o={startDate:t().subtract("days",6).format(),endDate:t().format()};s.api.listStatsPageviewsForDate(this.blogId,o,_.bind(function(e){e.error?n.reject(e):n.resolve(e)},this));s.api.listStatsVisitsForDate(this.blogId,o,_.bind(function(e){e.error?r.reject(e):r.resolve(e)},this));$.when(n,r).then(_.bind(function(e,t){this.isSynced=!0;a.success({pageviews:e,visits:t},a)},this),a.error);return[n,r]}}})});
define("hbs!cards/stats/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","template/helpers/formatDate","template/helpers/todaysPageViews"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e){var t,i,a,n="";n+='<div class="today">';t=e.lang;i=e.today;a=s.formatDate;t=a?a.call(e,i,t,{hash:{}}):d.call(e,"formatDate",i,t,{hash:{}});n+=h(t)+"</div>";return n}function r(e,t){var i,a="";a+="\n    ";i=e.pageviews;i=null==i||i===!1?i:i.items;i=s["if"].call(e,i,{hash:{},inverse:u.noop,fn:u.program(4,o,t)});(i||0===i)&&(a+=i);a+="\n    ";return a}function o(e){var t,i,a="";a+='\n    <div class="todays-pageviews">';t=e.pageviews;t=null==t||t===!1?t:t.items;i=s.todaysPageViews;t=i?i.call(e,t,{hash:{}}):d.call(e,"todaysPageViews",t,{hash:{}});a+=h(t)+'\n      <span class="diff-icon ';i=s.diffIcon;if(i)t=i.call(e,{hash:{}});else{t=e.diffIcon;t=typeof t===p?t():t}a+=h(t)+'"></span>\n    </div>\n    ';return a}s=s||e.helpers;i=i||e.partials;var l,c="",d=s.helperMissing,h=this.escapeExpression,p="function",u=this;l=t;l=u.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",l,s,i);(l||0===l)&&(c+=l);c+='\n<div class="content">\n  ';l=t;l=u.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t.today;l=s["if"].call(t,l,{hash:{},inverse:u.noop,fn:u.program(1,n,a)});(l||0===l)&&(c+=l);c+="\n\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=u.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(c+=l);c+='\n\n  <div class="stats-dashboard-graph-container">\n    ';l=t.pageviews;l=s["if"].call(t,l,{hash:{},inverse:u.noop,fn:u.program(3,r,a)});(l||0===l)&&(c+=l);c+='\n    <div id="stats-dashboard-graph"></div>\n  </div>\n</div>\n';return c});t.registerPartial("cards_stats_templates_dashboard",s);return s});
define("cards/stats/dashboard/dashboard",["js/cache","js/commands","js/device","js/mtapi/stats_provider","js/views/card/itemview","cards/stats/models/latest_page_views","hbs!cards/stats/templates/dashboard","mtchart"],function(e,t,s,i,a,n,r,o){return a.extend({template:r,initialize:function(){a.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=e.get(this.blogId,"stats_latest_page_views")||e.set(this.blogId,"stats_latest_page_views",new n(this.blogId));this.setTranslation();if(this.model.isSynced){this.loading=!1;this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")}else{var t=_.isFunction(i)?i(this.blogId):i;t.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));t.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},fetch:function(){a.prototype.fetch.call(this,{successCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).on("tap",this.navigatePage);this.$el.addClass("tap-enabled")},this),errorCallback:_.bind(function(){this.$el.hammer(this.hammerOpts).off("tap",this.navigatePage);this.$el.removeClass("tap-enabled")},this)})},navigatePage:function(){t.execute("router:navigate","stats")},onRender:function(){this.handleRefetch();var t,i,a,n,r,l,c,d,h,p=[];if(this.model.isSynced){t=this.model.toJSON();i=t.pageviews.items;a=t.visits.items;for(l=0,c=i.length;c>l;l++){n=i[l];r=a[l];p.push({x:n.date,y:r.visits,y1:n.pageviews})}d={type:"easel.mix",data:p,yLength:2,mix:[{type:"bar",yLength:1,chartColors:["#cccccc"],chartColorsAlpha:[.5]},{type:"motionLine",yLength:1,lineWidth:8,chartColors:["#55a038"],drawPointer:s.isAndroid?!1:!0,pointerColors:["#ea4b29"]}],fallback:{test:"canvas",type:"morris.bar",data:p,yLength:1,chartColors:["#55a038"],gridLineColor:"#f3f3f5",gridTextColor:"#f3f3f5",hideHover:"always"},height:170};h={length:7,unit:"daily"};new o.Graph(d,h).trigger("APPEND_TO",this.$el.find("#stats-dashboard-graph"))}else if(this.providerIsNotAvailable){var u=e.get("app","staticPath")||e.set("app","staticPath",$("#main-script").data("base"));this.$el.find("#stats-dashboard-graph").append('<img src="'+u+'/cards/stats/assets/welcome.png" class="stats-welcome" height="170">')}},serializeData:function(){var e=this.serializeDataInitialize();e.title="Today's Page Views";if(!this.loading){e=_.extend({},e,this.model.toJSON());if(e.pageviews&&e.pageviews.items){var t=e.pageviews.items.length;if(t>1){var s=parseInt(e.pageviews.items[t-2].pageviews,10),i=parseInt(e.pageviews.items[t-1].pageviews,10);this.diff=i-s;e.diffIcon=this.diff<0?"icon-arrow-down-right":this.diff>0?"icon-arrow-up-right":"icon-arrow-right"}}else if(this.providerIsNotAvailable){e.pageviews={items:[{pageviews:77e4}]};e.diffIcon="icon-arrow-up-right"}e.today=(new Date).valueOf()}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e}})});
define("cards/stats/models/top_articles",["backbone","js/mtapi","moment"],function(e,t){return e.Model.extend({isSynced:!1,sync:function(e,s,i){if("read"===e){var a=$.Deferred(),n={startDate:i.startDate,endDate:i.endDate,limit:i.limit};i.path&&(n.path=i.path);a.done(i.success);a.fail(i.error);t.api.listStatsPageviewsForPath(i.blogId,n,_.bind(function(e){if(e.error)a.reject(e);else{this.isSynced=!0;a.resolve(e)}},this));return a}}})});
define("cards/stats/models/top_articles_itemview",["backbone","js/cache","js/mtapi","js/models/entry","js/collections/entries"],function(e,t,s,i,a){return e.Model.extend({initialize:function(e){this.blogId=e.blogId;this.num=e.num;this.pageviews=e.pageviews;this.unit=e.unit},sync:function(e,s,n){if("read"===e){var r=$.Deferred();r.done(n.success);r.fail(n.error);var o=t.get(this.blogId,"entries")||t.set(this.blogId,"entries",new a(this.blogId));if(o.get(this.id))r.resolve(o.get(this.id).toJSON());else{var l=new i({id:this.id,blogId:this.blogId});l.fetch({success:function(){o.add(l);r.resolve(l.toJSON())},error:function(){r.reject(l.toJSON())}})}return r}}})});
define("cards/stats/models/top_articles_itemview_collection",["backbone","js/mtapi","cards/stats/models/top_articles_itemview"],function(e,t,s){return e.Collection.extend({model:s,comparator:function(e){return-1*parseInt(e.get("pageviews"),10)}})});
define("hbs!cards/stats/templates/layout",["hbs","handlebars"],function(e,t){var s=t.template(function(e,t,s){s=s||e.helpers;return'<section id="recent-access" class="card"></section>\n<section id="top-articles" class="top-articles card">\n</section>\n<section id="top-articles-weekly" class="top-articles card">\n</section>\n'});t.registerPartial("cards_stats_templates_layout",s);return s});
define("hbs!cards/stats/templates/recent_access",["hbs","handlebars","hbs!js/views/card/partials/title","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var a,n="",r=this;a=t;a=r.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",a,s,i);(a||0===a)&&(n+=a);n+='\n<div class="content">\n  ';a=t;a=r.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n  ";a=t;a=r.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",a,s,i);(a||0===a)&&(n+=a);n+="\n  ";a=t;a=r.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",a,s,i);(a||0===a)&&(n+=a);n+="\n</div>\n";return n});t.registerPartial("cards_stats_templates_recent_access",s);return s});
define("cards/stats/view/recent_access",["js/views/card/itemview","js/cache","js/mtapi/stats_provider","cards/stats/models/latest_page_views","hbs!cards/stats/templates/recent_access","mtchart"],function(e,t,s,i,a,n){return e.extend({template:a,serializeData:function(){var e=this.serializeDataInitialize();e.title="Access In Last Week";this.loading||(e=_.extend(e,this.model.toJSON()));e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;return e},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.model=t.get(this.blogId,"stats_latest_page_views")||t.set(this.blogId,"stats_latest_page_views",new i(this.blogId));this.setTranslation();if(this.model.isSynced)this.loading=!1;else{var a=s(this.blogId);a.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));a.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}},onRender:function(){this.handleRefetch();if(this.model.isSynced){var e=this.$el.find(".content"),t=this.model.toJSON().pageviews.items,s=_.map(t,function(e){return{x:e.date,y:e.pageviews}}),i=_.map(t,function(e){var t=e.pageviews;e.pageviews>=1e6?t=Math.round(e.pageviews/1e6)+"M":e.pageviews>=1e3&&(t=Math.round(e.pageviews/1e3)+"K");return t}),a={type:"css.horizontalBar",data:s,yLength:1,yLabel:i,autoSized:!1,pointSize:6,barColor:"#efb330",barBackgroundColor:"#362c35",dateColor:"#444444",dateColorSaturday:"#4079e6",dateColorSunday:"#ec4b05",dateLabelSize:16,labelSize:22,labelColor:"#ffffff",showDate:!0,barWidth:40,barMarginLeft:35,barInterval:10},r={dataType:"timeline",unit:"daily",length:7};new n.Graph(a,r).trigger("APPEND_TO",e)}}})});
define("hbs!cards/stats/templates/itemviewContent",["hbs","handlebars","template/helpers/eachOnly"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var i,a,n="";n+="\n      ";i=e.assets;a=s.eachOnly;i=a?a.call(e,i,0,{hash:{},inverse:m.noop,fn:m.program(2,r,t)}):f.call(e,"eachOnly",i,0,{hash:{},inverse:m.noop,fn:m.program(2,r,t)});(i||0===i)&&(n+=i);n+="\n    ";return n}function r(e){var t,i,a="";a+='\n      <div class="item-asset image circle" style="background-image:url(';i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===p?t():t}a+=u(t)+"); -pie-background: url(";i=s.url;if(i)t=i.call(e,{hash:{}});else{t=e.url;t=typeof t===p?t():t}a+=u(t)+') no-repeat center center / cover"><div class="circle-inner"></div></div>\n      ';return a}function o(){return'\n      <div class="item-asset no-image circle"><div class="circle-inner"></div></div>\n    '}function l(){return'<div class="item-arrow icon-arrow"></div>'}s=s||e.helpers;var c,d,h="",p="function",u=this.escapeExpression,m=this,f=s.helperMissing;h+='<div class="item-num">';c=t.num;c=typeof c===p?c():c;h+=u(c)+'</div>\n<div class="item-content">\n  <div class="item-asset-container">\n    ';c=t.assets;c=null==c||c===!1?c:c.length;c=s["if"].call(t,c,{hash:{},inverse:m.program(4,o,a),fn:m.program(1,n,a)});(c||0===c)&&(h+=c);h+='\n  </div>\n  <div class="item-title">';d=s.title;if(d)c=d.call(t,{hash:{}});else{c=t.title;c=typeof c===p?c():c}h+=u(c)+"</div>\n  ";c=t.arrow;c=s["if"].call(t,c,{hash:{},inverse:m.noop,fn:m.program(6,l,a)});(c||0===c)&&(h+=c);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_itemviewContent",s);return s});
define("hbs!cards/stats/templates/top_articles_itemview",["hbs","handlebars","hbs!cards/stats/templates/itemviewContent"],function(e,t){var s=t.template(function(e,t,s,i){s=s||e.helpers;i=i||e.partials;var a,n,r="",o="function",l=this.escapeExpression,c=this;r+='<a data-route="stats/';n=s.blogId;if(n)a=n.call(t,{hash:{}});else{a=t.blogId;a=typeof a===o?a():a}r+=l(a)+"/";n=s.id;if(n)a=n.call(t,{hash:{}});else{a=t.id;a=typeof a===o?a():a}r+=l(a)+"/";n=s.unit;if(n)a=n.call(t,{hash:{}});else{a=t.unit;a=typeof a===o?a():a}r+=l(a)+'" class="item-container">\n  ';a=t;a=c.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",a,s,i);(a||0===a)&&(r+=a);r+="\n</a>\n";return r});t.registerPartial("cards_stats_templates_top_articles_itemview",s);return s});
define("cards/stats/view/top_articles_itemview",["backbone.marionette","cards/stats/models/top_articles_itemview","hbs!cards/stats/templates/top_articles_itemview"],function(e,t,s){return e.ItemView.extend({template:s})});
define("hbs!cards/stats/templates/top_articles",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/providerIsNotAvailable","hbs!js/views/card/partials/noItem","hbs!cards/stats/templates/itemviewContent","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e){var t,i;i=s.title;if(i)t=i.call(e,{hash:{}});else{t=e.title;t=typeof t===p?t():t}return t||0===t?t:""}function r(e){var t,a="";a+='\n    <li id="eid-';t=e.entry;t=null==t||t===!1?t:t.id;t=typeof t===p?t():t;a+=u(t)+'" data-pageviews="';t=e.pageviews;t=typeof t===p?t():t;a+=u(t)+'">\n      <div class="item-container">\n        <div class="content-loading"></div>\n        ';t=e;t=m.invokePartial(i.cards_stats_templates_itemviewContent,"cards_stats_templates_itemviewContent",t,s,i);(t||0===t)&&(a+=t);a+="\n      </div>\n    </li>\n  ";return a}function o(){return'\n  <div class="item-loading"></div>\n  '}s=s||e.helpers;i=i||e.partials;var l,c,d,h="",p="function",u=this.escapeExpression,m=this,f=s.helperMissing;h+='<header>\n<h1 id="';d=s.name;if(d)l=d.call(t,{hash:{}});else{l=t.name;l=typeof l===p?l():l}h+=u(l)+'-title">';l=t.numberOfArticles;c=t.trans;d=s.trans;l=d?d.call(t,c,l,{hash:{},inverse:m.noop,fn:m.program(1,n,a)}):f.call(t,"trans",c,l,{hash:{},inverse:m.noop,fn:m.program(1,n,a)});(l||0===l)&&(h+=l);h+='</h1>\n</header>\n<div class="content content-list">\n  ';l=t;l=m.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=m.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=m.invokePartial(i.js_views_card_partials_providerIsNotAvailable,"js_views_card_partials_providerIsNotAvailable",l,s,i);(l||0===l)&&(h+=l);h+="\n  ";l=t;l=m.invokePartial(i.js_views_card_partials_noItem,"js_views_card_partials_noItem",l,s,i);(l||0===l)&&(h+=l);h+='\n  <ul id="top-articles-list-';d=s.unit;if(d)l=d.call(t,{hash:{}});else{l=t.unit;l=typeof l===p?l():l}h+=u(l)+'" class="card-item-list top-articles-list">\n  ';l=t.items;l=s.each.call(t,l,{hash:{},inverse:m.noop,fn:m.program(3,r,a)});(l||0===l)&&(h+=l);h+="\n  </ul>\n  ";l=t.itemLoading;l=s["if"].call(t,l,{hash:{},inverse:m.noop,fn:m.program(5,o,a)});(l||0===l)&&(h+=l);h+="\n</div>\n";return h});t.registerPartial("cards_stats_templates_top_articles",s);return s});
define("cards/stats/view/top_articles",["js/views/card/composite","js/cache","moment","moment.lang","js/mtapi/stats_provider","cards/stats/models/top_articles","cards/stats/models/top_articles_itemview_collection","cards/stats/models/top_articles_itemview","cards/stats/view/top_articles_itemview","hbs!cards/stats/templates/top_articles"],function(e,t,s,i,a,n,r,o,l,c){return e.extend({numberOfArticles:3,template:c,itemView:l,itemViewContainer:"#top-articles-list-day",appendHtml:function(e,t){this.getItemViewContainer(e).find("#eid-"+t.model.id).html(t.el)},serializeData:function(){var e=this.serializeDataInitialize(),t=[];if(!this.loading){e=_.extend(e,this.model.toJSON());if(e.items&&e.items.length){var s=this.numberOfArticles,i=_.filter(e.items,function(e){return e.entry&&e.entry.id})||[];e.count=i.length;_.each(i,function(e){var i=e.entry?e.entry.id:null;if(s&&i){s-=1;var a=this.numberOfArticles-s;e.num=a;t.push(e);var n=this.collection.get(i);this.dfd.done(_.bind(function(){if(!n){n=new o({id:i,blogId:this.blogId,num:a,pageviews:e.pageviews,unit:this.unit});n.fetch({success:_.bind(function(){n.set({arrow:!0});this.collection.add(n,{sort:!0})},this),error:_.bind(function(){n.set({title:e.title});this.collection.add(n,{sort:!0})},this)})}},this))}},this);e.items=t}}e.providerIsNotAvailable=this.providerIsNotAvailable?!0:!1;e.itemLoading=this.itemLoading?!0:!1;var a={day:"Day",week:"Week",month:"Month",year:"Year"};e.title="Top [_1] of The "+a[this.unit];e.numberOfArticles=this.numberOfArticles;e.unit=this.unit;return e},fetch:function(){this.model.fetch({blogId:this.blogId,startDate:s().startOf(this.unit).format(),endDate:s().endOf(this.unit).format(),limit:10,success:_.bind(function(){this.loading=!1;this.fetchError=!1;this.itemLoading=!0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})},initialize:function(s){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.unit=s.unit||"day";this.model=t.get(this.blogId,"toparticle_"+this.unit+"_model")||t.set(this.blogId,"toparticle_"+this.unit+"_model",new n);this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.setTranslation();this.dfd=$.Deferred();if(this.model.isSynced){this.loading=!1;this.render()}else{var i=a(this.blogId);i.done(_.bind(function(){this.providerIsNotAvailable=!1;this.fetch()},this));i.fail(_.bind(function(){this.providerIsNotAvailable=!0;this.loading=!1;this.render()},this))}this.handleItemViewNavigate()},onRender:function(){this.handleRefetch();!this.loading&&this.itemLoading&&this.dfd.resolve()}})});
define("cards/stats/view/top_articles_weekly",["cards/stats/view/top_articles"],function(e){return e.extend({itemViewContainer:"#top-articles-list-week"})});
define("cards/stats/view/layout",["backbone.marionette","js/commands","hbs!cards/stats/templates/layout","cards/stats/view/recent_access","cards/stats/view/top_articles","cards/stats/view/top_articles_weekly"],function(e,t,s,i,a,n){return e.Layout.extend({template:s,regions:{recentAccess:"#recent-access",topArticles:"#top-articles",topArticlesWeekly:"#top-articles-weekly"},initialize:function(e){this.options=e},onRender:function(){this.recentAccess.show(new i(this.options));this.topArticles.show(new a(_.extend({},this.options,{unit:"day"})));this.topArticlesWeekly.show(new n(_.extend({},this.options,{unit:"week"})))}})});
define("hbs!cards/stats/templates/post",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/fetchError","hbs!js/views/card/partials/entryItemsList","template/helpers/trans","template/helpers/ifIs"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var a,n,l,c="";c+='\n      <div class="pageviews">\n        <span class="label"><span class="label-inner">';a=e.trans;l=s.trans;a=l?l.call(e,a,{hash:{},inverse:p.noop,fn:p.program(2,r,t)}):u.call(e,"trans",a,{hash:{},inverse:p.noop,fn:p.program(2,r,t)});(a||0===a)&&(c+=a);c+='</span></span>\n        <span class="pageview">';l=s.pageviews;if(l)a=l.call(e,{hash:{}});else{a=e.pageviews;a=typeof a===d?a():a}c+=h(a)+"</span>\n      </div>\n      ";a=e.status;n={};n.ne="Publish";l=s.ifIs;a=l?l.call(e,a,{hash:n,inverse:p.noop,fn:p.program(4,o,t)}):u.call(e,"ifIs",a,{hash:n,inverse:p.noop,fn:p.program(4,o,t)});(a||0===a)&&(c+=a);c+="\n      ";a=e;a=p.invokePartial(i.js_views_card_partials_entryItemsList,"js_views_card_partials_entryItemsList",a,s,i);(a||0===a)&&(c+=a);c+="\n  ";return c}function r(e){var t,i;i=s.label;if(i)t=i.call(e,{hash:{}});else{t=e.label;t=typeof t===d?t():t}return t||0===t?t:""}function o(e){var t,i,a="";a+='\n      <div class="post-status">\n        <span>';i=s.status;if(i)t=i.call(e,{hash:{}});else{t=e.status;t=typeof t===d?t():t}a+=h(t)+"</span>\n      </div>\n      ";return a}s=s||e.helpers;i=i||e.partials;var l,c="",d="function",h=this.escapeExpression,p=this,u=s.helperMissing;c+='<section id="stats-post" class="card">\n  <div class="content">\n  ';l=t;l=p.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t;l=p.invokePartial(i.js_views_card_partials_fetchError,"js_views_card_partials_fetchError",l,s,i);(l||0===l)&&(c+=l);c+="\n  ";l=t.id;l=s["if"].call(t,l,{hash:{},inverse:p.noop,fn:p.program(1,n,a)});(l||0===l)&&(c+=l);c+="\n  </div>\n</section>\n";return c});t.registerPartial("cards_stats_templates_post",s);return s});
define("cards/stats/view/post",["js/views/card/itemview","js/cache","js/commands","moment","moment.lang","cards/stats/models/top_articles_itemview","cards/stats/models/top_articles_itemview_collection","hbs!cards/stats/templates/post","cards/stats/models/top_articles"],function(e,t,s,i,a,n,r,o,l){return e.extend({template:o,initialize:function(i){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));var a=i.routes;this.blogId=a[0];this.entryId=a[1];this.unit=a[2];this.collection=t.get(this.blogId,"toparticle_itemview_"+this.unit+"_collection")||t.set(this.blogId,"toparticle_itemview_"+this.unit+"_collection",new r);this.model=this.collection.get(this.entryId)||null;this.setTranslation(_.bind(function(){if(this.model){this.loading=!1;this.render()}else{this.render();this.fetch()}},this));s.setHandler("card:stats:share:show",_.bind(function(){var e=this.serializeData();s.execute("share:show",{share:{url:e.permalink,tweetText:e.title+" "+e.excerpt}})},this))},fetch:function(){this.model=new n({id:this.entryId,blogId:this.blogId});this.model.fetch({success:_.bind(function(){var e,t=this.model.toJSON().permalink||null;if(t){t=t.match(/http(?:s)?:\/\/[^\/]+\/(.*)/);e=t.length>1?t[1]:null}if(e){this.statsModel=new l;this.statsModel.fetch({blogId:this.blogId,startDate:i().startOf(this.unit).format(),endDate:i().endOf(this.unit).format(),limit:1,path:e,success:_.bind(function(e){this.loading=!1;this.fetchError=!1;this.pageviews=e.toJSON().items[0]?e.toJSON().items[0].pageviews:0;this.render()},this),error:_.bind(function(){this.loading=!1;this.fetchError=!0;this.render()},this)})}},this),error:_.bind(function(){this.fetchError=!0;this.loading=!1;this.render()},this)})},onRender:function(){this.handleRefetch()},serializeData:function(){var e=this.serializeDataInitialize();if(this.model){e=_.extend(e,this.model.toJSON());s.execute("header:render",e)}var t={day:"Today's",week:"This Week's",month:"This Month's",year:"This Year's"};e.label=t[this.unit]+" access";void 0===e.pageviews&&(e.pageviews=this.pageviews);return e}})});
define("cards/stats/view/post_header",["backbone.marionette","js/views/card/header","js/device","js/commands"],function(e,t){return t.extend({backButtonRoute:function(){return this.card.id},serializeData:function(){var e=t.prototype.serializeData.apply(this);if(this.object){e.post=this.object||{};e.shareEnabled="Publish"===e.post.status}return e}})});
define("hbs!cards/upload/templates/dashboard",["hbs","handlebars","hbs!js/views/card/partials/loading","hbs!js/views/card/partials/title","template/helpers/trans"],function(e,t){var s=t.template(function(e,t,s,i,a){function n(e,t){var i,a="";a+="\n";i=e.FileUploadSupport;i=s["if"].call(e,i,{hash:{},inverse:x.noop,fn:x.program(2,r,t)});(i||0===i)&&(a+=i);a+="\n";return a}function r(e,t){var a,n="";n+="\n";a=e;a=x.invokePartial(i.js_views_card_partials_loading,"js_views_card_partials_loading",a,s,i);(a||0===a)&&(n+=a);n+="\n";a=e;a=x.invokePartial(i.js_views_card_partials_title,"js_views_card_partials_title",a,s,i);(a||0===a)&&(n+=a);n+='\n\n<form id="upload-file-form" method="post" name="upload-file">\n<div class="content">\n  ';a=e.uploadedImages;a=s.each.call(e,a,{hash:{},inverse:x.noop,fn:x.program(3,o,t)});(a||0===a)&&(n+=a);n+="\n  ";a=e.uploadError;a=null==a||a===!1?a:a.length;a=s["if"].call(e,a,{hash:{},inverse:x.noop,fn:x.program(5,l,t)});(a||0===a)&&(n+=a);n+="\n  ";a=e.uploadError;a=null==a||a===!1?a:a.length;a=s.unless.call(e,a,{hash:{},inverse:x.noop,fn:x.program(11,p,t)});(a||0===a)&&(n+=a);n+='\n  <div class="upload-file-input-container">\n    <input type="file" id="upload-file-input" accept="image/*"/>\n  </div>\n  <div id="upload-file" class="button-container with-icon">\n    ';a=e.isLabelNeeded;a=s["if"].call(e,a,{hash:{},inverse:x.noop,fn:x.program(14,m,t)});(a||0===a)&&(n+=a);n+='\n    <span class="button-icon icon-plus"></span><span class="button">\n      ';a=e.uploadCompleted;a=s["if"].call(e,a,{hash:{},inverse:x.program(19,b,t),fn:x.program(16,f,t)});(a||0===a)&&(n+=a);n+="\n    </span>\n    ";a=e.isLabelNeeded;a=s["if"].call(e,a,{hash:{},inverse:x.noop,fn:x.program(26,I,t)});(a||0===a)&&(n+=a);n+='\n  </div>\n  <div class="button-container button-container-disabled">\n    <div id="upload-file-uploading" class="upload-file button"></div>\n  </div>\n</div>\n</form>\n';return n}function o(e){var t,s="";s+='\n  <div class="uploaded-image">\n    <img src="';t=e.url;t=typeof t===P?t():t;s+=A(t)+'">\n  </div>\n  ';return s}function l(e,t){var i,a,n="";n+='\n  <div class="error">\n    <div class="upload-image icon-upload-fail"></div>\n    <div class="message">\n      <div class="message-inner">\n        <p class="error-heading">';i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:x.noop,fn:x.program(6,c,t)}):E.call(e,"trans",i,{hash:{},inverse:x.noop,fn:x.program(6,c,t)});(i||0===i)&&(n+=i);n+="</p>\n        ";i=e.uploadError;i=s.each.call(e,i,{hash:{},inverse:x.noop,fn:x.program(8,d,t)});(i||0===i)&&(n+=i);n+="\n      </div>\n    </div>\n  </div>\n  ";return n}function c(){return"Failed Uploading"}function d(e,t){var i,a="";a+="\n          <p>";i=s["if"].call(e,e,{hash:{},inverse:x.noop,fn:x.program(9,h,t)});(i||0===i)&&(a+=i);a+="</p>\n        ";return a}function h(e){var t;t=e.message;t=typeof t===P?t():t;return A(t)}function p(e,t){var i,a="";a+="\n  ";i=e.uploadedImages;i=null==i||i===!1?i:i.length;i=s.unless.call(e,i,{hash:{},inverse:x.noop,fn:x.program(12,u,t)});(i||0===i)&&(a+=i);a+="\n  ";return a}function u(){return'\n  <div class="upload-image icon-upload"></div>\n  '}function m(){return'\n    <label for="upload-file-input">\n    '}function f(e,t){var i,a,n="";n+="\n        ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:x.noop,fn:x.program(17,v,t)}):E.call(e,"trans",i,{hash:{},inverse:x.noop,fn:x.program(17,v,t)});(i||0===i)&&(n+=i);n+="\n      ";return n}function v(){return"More Upload"}function b(e,t){var i,a="";a+="\n        ";i=e.error;i=s["if"].call(e,i,{hash:{},inverse:x.program(23,w,t),fn:x.program(20,_,t)});(i||0===i)&&(a+=i);a+="\n      ";return a}function _(e,t){var i,a,n="";n+="\n          ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:x.noop,fn:x.program(21,g,t)}):E.call(e,"trans",i,{hash:{},inverse:x.noop,fn:x.program(21,g,t)});(i||0===i)&&(n+=i);n+="\n        ";return n}function g(){return"Choose Another Files"}function w(e,t){var i,a,n="";n+="\n          ";i=e.trans;a=s.trans;i=a?a.call(e,i,{hash:{},inverse:x.noop,fn:x.program(24,y,t)}):E.call(e,"trans",i,{hash:{},inverse:x.noop,fn:x.program(24,y,t)});(i||0===i)&&(n+=i);n+="\n        ";return n}function y(){return"Choose Files"}function I(){return"\n    </label>\n    "}s=s||e.helpers;i=i||e.partials;var j,k="",P="function",A=this.escapeExpression,x=this,E=s.helperMissing;j=t.perm;j=s["if"].call(t,j,{hash:{},inverse:x.noop,fn:x.program(1,n,a)});(j||0===j)&&(k+=j);k+="\n";return k});t.registerPartial("cards_upload_templates_dashboard",s);return s});
define("cards/upload/dashboard/dashboard",["js/views/card/itemview","js/mtapi","js/device","hbs!cards/upload/templates/dashboard"],function(e,t,s,i){return e.extend({template:i,ui:{uploadForm:"#upload-file-input",uploadButton:"#upload-file",refreshButton:"#refresh"},initialize:function(){e.prototype.initialize.apply(this,Array.prototype.slice.call(arguments));this.perm=this.userIsSystemAdmin()||this.userHasPermission("upload");this.FileUploadSupport=this.checkSupport();this.supportedFileAPI=this.checkFileAPISupport();this.isLabelNeeded=this.checkNeedLabel();this.dashboardShowWithPermission(this.perm&&this.FileUploadSupport).done(_.bind(function(){this.setTranslation()},this))},upload:function(e){if(this.perm&&this.ui.uploadForm.val()){this.uploadedImages=[];this.uploadError=[];this.errorImages=[];this.uploading=!0;this.$el.addClass("now-uploading");var s=[];_.each(e,_.bind(function(e){var i=$.Deferred();s.push(i);t.api.uploadAsset(this.blogId,{file:e,autoRenameIfExists:!0,bustCache:(new Date).valueOf()},_.bind(function(t){if(t.error){this.errorImages.push(e);this.uploadError.push(t.error);i.reject()}else{i.resolve();this.uploadedImages.push(t)}this.render()},this))},this));$.when.apply(this,s).done(_.bind(function(){this.uploadError=[];this.uploadCompleted=!0},this)).always(_.bind(function(){this.$el.removeClass("now-uploading");this.uploading=!1;this.render()},this))}},onRender:function(){if(this.perm){this.ui.uploadButton.hammer(this.hammerOpts).on("tap",_.bind(function(e){this.addTapClass(e.currentTarget,_.bind(function(){this.isLabelNeeded||this.ui.uploadForm.click()},this))},this));this.ui.uploadForm.on("change",_.bind(this.handleUploadFormChange,this))}},handleUploadFormChange:function(e){this.supportedFileAPI?this.upload(e.target.files):this.upload([$("#upload-file-input").get(0)])},checkSupport:function(){return s.isIOS&&s.version&&s.version<6||s.isWindowsPhone?!1:!0},checkFileAPISupport:function(){return window.FileReader&&!s.isWindowsPhone?!0:!1},checkNeedLabel:function(){return s.isIE&&parseInt(s.browserVersion,10)<10?!0:!1},serializeData:function(){var e={};if(this.perm){e=this.serializeDataInitialize();e.title=e.name;e.FileUploadSupport=this.FileUploadSupport;e.loading=!1;e.uploadError=this.uploadError||[];e.uploading=this.uploading?!0:!1;e.uploadCompleted=this.uploadCompleted?!0:!1;e.uploadedImages=this.uploadedImages;e.supportedFileAPI=this.supportedFileAPI;e.isLabelNeeded=this.isLabelNeeded}e.perm=this.perm;e.trans=this.trans;return e}})});
define("json!cards/cards.json",function(){return[{name:"Stats",id:"stats",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout"},{id:"post",route:":blog_id/:id/:unit",view:"view/post",header:"view/post_header"}]},{name:"Acception",id:"acception",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",route:":blog_id/:id",view:"view/view",header:"view/view_header"}]},{name:"Media Upload",id:"upload",dashboard:{view:"dashboard/dashboard"}},{name:"Feedbacks",id:"feedbacks",dashboard:{view:"dashboard/dashboard"},routes:[{id:"view",view:"view/layout",route:":type/:blog_id/:id"}]}]});